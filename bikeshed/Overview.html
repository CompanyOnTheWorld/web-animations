<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Web Animations</title>
  <link href=../default.css rel=stylesheet type=text/css>
  <link href=../csslogo.ico rel="shortcut icon" type=image/x-icon>
  <link href=https://www.w3.org/StyleSheets/TR/W3C-ED rel=stylesheet type=text/css>
<link href=web-animations.css rel=stylesheet type=text/css>
<script src="MathJax/MathJax.js?config=MML_SVGorMML,local/local" type=text/javascript></script>

</head>
<body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.w3.org/>
    <img alt=W3C height=48 src=https://www.w3.org/Icons/w3c_home width=72>
</a>
</p>
  <h1 class="p-name no-ref" id=title>Web Animations</h1>
  <h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Editor’s Draft,
    <span class=dt-updated><span class=value-title title=20140724>24 July 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl>
	<dt>This version:
	<dd><a class=u-url href=http://dev.w3.org/fxtf/web-animations/>http://dev.w3.org/fxtf/web-animations/</a>
	<dt>Feedback:
	<dd><a href="mailto:public-fx@w3.org?subject=%5Bweb-animations%5D%20feedback">public-fx@w3.org</a>
            with subject line
            “<kbd>[web-animations] <var>… message topic …</var></kbd>”(<a href=http://lists.w3.org/Archives/Public/public-fx/ rel=discussion>archives</a>)
	<dt>Editors:
	<dd><dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:bbirtles@mozilla.com>Brian Birtles</a> (<span class="p-org org">Mozilla Japan</span>)
	<dd><dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:shans@google.com>Shane Stephens</a> (<span class="p-org org">Google Inc</span>)
	<dd><dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:adanilo@google.com>Alex Danilo</a> (<span class="p-org org">Google Inc</span>)
	<dd><dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:jackalmage@gmail.com>Tab Atkins</a> (<span class="p-org org">Google Inc</span>)
</dl>
</div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://www.w3.org/Consortium/Legal/ipr-notice#Copyright>Copyright</a> © 2014 <a href=http://www.w3.org/><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href=http://www.csail.mit.edu/><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href=http://www.ercim.eu/><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href=http://www.keio.ac.jp/>Keio</a>, <a href=http://ev.buaa.edu.cn/>Beihang</a>), All Rights Reserved. W3C <a href=http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer>liability</a>, <a href=http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks>trademark</a> and <a href=http://www.w3.org/Consortium/Legal/copyright-documents>document use</a> rules apply.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<div class=p-summary data-fill-with=abstract><p>This specification defines a model for synchronization and timing of

changes to the presentation of a Web page.
This specification also defines an application programming interface for
interacting with this model and it is expected that further specifications
will define declarative means for exposing these features.</p>

<a href=http://www.w3.org/TR/CSS/>CSS</a> is a language for describing the rendering of structured documents 
(such as HTML and XML) 
on screen, on paper, in speech, etc.</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is a public copy of the editors' draft. 
	It is provided for discussion only and may change at any moment. 
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.

<p>
	The (<a href=http://lists.w3.org/Archives/Public/public-fx/>archived</a>) public mailing list
	<a href="mailto:public-fx@w3.org?Subject=%5Bweb-animations%5D%20PUT%20SUBJECT%20HERE">public-fx@w3.org</a> 
	(see <a href=http://www.w3.org/Mail/Request>instructions</a>) 
	is preferred for discussion of this specification. 
	When sending e-mail, 
	please put the text “web-animations” in the subject, 
	preferably like this:
	“[web-animations] <em>…summary of comment…</em>”

<p>
	This document was produced by the <a href=http://www.w3.org/Style/CSS/members>CSS Working Group</a> 
	(part of the <a href=http://www.w3.org/Style/>Style Activity</a>) and the <a href=http://www.w3.org/Graphics/SVG/WG/>SVG Working Group</a> (part of the
	<a href=http://www.w3.org/Graphics/>Graphics Activity</a>).

<p>
	This document was produced by groups operating under 
	the <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/>5 February 2004 W3C Patent Policy</a>. 
	W3C maintains a <a href=http://www.w3.org/2004/01/pp-impl/32061/status rel=disclosure>public list of any patent disclosures (CSS)</a>
	and a <a href=http://www.w3.org/2004/01/pp-impl/19480/status rel=disclosure>public list of any patent disclosures (SVG)</a> 
	made in connection with the deliverables of each group; 
	these pages also includes instructions for disclosing a patent. 
	An individual who has actual knowledge of a patent which the individual believes contains
	<a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential>Essential Claim(s)</a> 
	must disclose the information in accordance with <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure>section 6 of the W3C Patent Policy</a>.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc>
	<li><a href=#introduction><span class=secno>1</span> Introduction</a>
		<ul class=toc>
		<li><a href=#use-cases><span class=secno>1.1</span> Use cases</a>
		<li><a href=#relationship-to-other-specifications><span class=secno>1.2</span> Relationship to other specifications</a>
		<li><a href=#overview-of-this-specification><span class=secno>1.3</span> Overview of this specification</a></ul>
	<li><a href=#web-animations-model-overview><span class=secno>2</span> Web Animations model overview</a>
	<li><a href=#timing-model><span class=secno>3</span> Timing model</a>
		<ul class=toc>
		<li><a href=#the-timing-model-at-a-glance><span class=secno>3.1</span> The timing model at a glance</a>
			<ul class=toc>
			<li><a href=#stateless><span class=secno>3.1.1</span> Stateless</a>
			<li><a href=#hierarchical><span class=secno>3.1.2</span> Hierarchical</a></ul>
		<li><a href=#timing-model-concepts><span class=secno>3.2</span> Timing model concepts</a>
		<li><a href=#the-global-clock><span class=secno>3.3</span> The global clock</a>
		<li><a href=#timelines><span class=secno>3.4</span> Timelines</a>
			<ul class=toc>
			<li><a href=#the-document-timeline><span class=secno>3.4.1</span> The document timeline</a></ul>
		<li><a href=#players><span class=secno>3.5</span> Players</a>
			<ul class=toc>
			<li><a href=#the-current-time-of-a-player><span class=secno>3.5.1</span> The current time of a player</a>
			<li><a href=#seeking-pausing-and-limiting><span class=secno>3.5.2</span> Seeking, pausing and limiting</a>
				<ul class=toc>
				<li><a href=#introduction-to-seeking><span class=secno>3.5.2.1</span> Introduction to seeking</a>
				<li><a href=#introduction-to-pausing><span class=secno>3.5.2.2</span> Introduction to pausing</a>
				<li><a href=#limiting-the-current-time><span class=secno>3.5.2.3</span> Limiting the current time</a>
				<li><a href=#seeking-pausing-and-limiting-properties><span class=secno>3.5.2.4</span> Seeking, pausing and limiting properties</a>
				<li><a href=#calculating-the-player-start-time><span class=secno>3.5.2.5</span> Calculating the player start time</a>
				<li><a href=#updating-the-player-start-time><span class=secno>3.5.2.6</span> Updating the player start time</a>
				<li><a href=#automatically-updating-the-hold-time><span class=secno>3.5.2.7</span> Automatically updating the hold time</a>
				<li><a href=#updating-the-paused-state><span class=secno>3.5.2.8</span> Updating the paused state</a>
				<li><a href=#performing-a-seek><span class=secno>3.5.2.9</span> Performing a seek</a>
				<li><a href=#limited-players><span class=secno>3.5.2.10</span> Limited players</a></ul>
			<li><a href=#speed-control><span class=secno>3.5.3</span> Speed control</a>
				<ul class=toc>
				<li><a href=#updating-the-playback-rate><span class=secno>3.5.3.1</span> Updating the playback rate</a></ul>
			<li><a href=#player-events><span class=secno>3.5.4</span> Player events</a>
				<ul class=toc>
				<li><a href=#types-of-player-events><span class=secno>3.5.4.1</span> Types of player events</a>
				<li><a href=#event-parameters><span class=secno>3.5.4.2</span> Event parameters</a>
				<li><a href=#propagation-path><span class=secno>3.5.4.3</span> Propagation path</a>
				<li><a href=#sequence-of-events><span class=secno>3.5.4.4</span> Sequence of events</a>
				<li><a href=#event-dispatch><span class=secno>3.5.4.5</span> Event dispatch</a></ul></ul>
		<li><a href=#animation-nodes><span class=secno>3.6</span> Animation nodes</a>
			<ul class=toc>
			<li><a href=#relationship-between-animation-nodes-and-players><span class=secno>3.6.1</span> Relationship between animation nodes and players</a>
			<li><a href=#types-of-animation-nodes><span class=secno>3.6.2</span> Types of animation nodes</a>
			<li><a href=#the-active-interval><span class=secno>3.6.3</span> The active interval</a>
			<li><a href=#local-time-and-inherited-time><span class=secno>3.6.4</span> Local time and inherited time</a>
			<li><a href=#animation-node-phases-and-states><span class=secno>3.6.5</span> Animation node phases and states</a></ul>
		<li><a href=#fill-behavior><span class=secno>3.7</span> Fill behavior</a>
			<ul class=toc>
			<li><a href=#fill-modes><span class=secno>3.7.1</span> Fill modes</a></ul>
		<li><a href=#repeating><span class=secno>3.8</span> Repeating</a>
			<ul class=toc>
			<li><a href=#iteration-intervals><span class=secno>3.8.1</span> Iteration intervals</a>
			<li><a href=#controlling-iteration><span class=secno>3.8.2</span> Controlling iteration</a>
			<li><a href=#iteration-time-space><span class=secno>3.8.3</span> Iteration time space</a>
			<li><a href=#interval-timing><span class=secno>3.8.4</span> Interval timing</a></ul>
		<li><a href=#animation-node-speed-control><span class=secno>3.9</span> Animation node speed control</a>
		<li><a href=#core-animation-node-calculations><span class=secno>3.10</span> Core animation node calculations</a>
			<ul class=toc>
			<li><a href=#overview><span class=secno>3.10.1</span> Overview</a>
			<li><a href=#calculating-the-active-duration><span class=secno>3.10.2</span> Calculating the active duration</a>
			<li><a href=#transforming-the-local-time><span class=secno>3.10.3</span> Transforming the local time</a>
				<ul class=toc>
				<li><a href=#calculating-the-active-time><span class=secno>3.10.3.1</span> Calculating the active time</a>
				<li><a href=#calculating-the-scaled-active-time><span class=secno>3.10.3.2</span> Calculating the scaled active time</a>
				<li><a href=#calculating-the-iteration-time><span class=secno>3.10.3.3</span> Calculating the iteration time</a></ul>
			<li><a href=#calculating-the-current-iteration><span class=secno>3.10.4</span> Calculating the current iteration</a></ul>
		<li><a href=#direction-control><span class=secno>3.11</span> Direction control</a>
			<ul class=toc>
			<li><a href=#calculating-the-directed-time><span class=secno>3.11.1</span> Calculating the directed time</a></ul>
		<li><a href=#time-transformations><span class=secno>3.12</span> Time transformations</a>
			<ul class=toc>
			<li><a href=#scaling-the-time><span class=secno>3.12.1</span> Scaling the time</a>
			<li><a href=#timing-functions><span class=secno>3.12.2</span> Timing functions</a>
			<li><a href=#scaling-using-a-cubic-bxxxzier-curve><span class=secno>3.12.3</span> Scaling using a cubic BXXXzier curve</a>
			<li><a href=#timing-in-discrete-steps><span class=secno>3.12.4</span> Timing in discrete steps</a>
			<li><a href=#calculating-the-transformed-time><span class=secno>3.12.5</span> Calculating the transformed time</a></ul>
		<li><a href=#grouping-and-synchronization><span class=secno>3.13</span> Grouping and synchronization</a>
			<ul class=toc>
			<li><a href=#relationship-of-group-time-to-child-time><span class=secno>3.13.1</span> Relationship of group time to child time</a>
			<li><a href=#the-start-time-of-children-of-an-animation-group><span class=secno>3.13.2</span> The start time of children of an animation group</a>
			<li><a href=#the-intrinsic-iteration-duration-of-an-animation-group><span class=secno>3.13.3</span> The intrinsic iteration duration of an animation group</a>
			<li><a href=#animation-sequences><span class=secno>3.13.4</span> Animation sequences</a>
				<ul class=toc>
				<li><a href=#the-start-time-of-children-of-an-animation-sequence><span class=secno>3.13.4.1</span> The start time of children of an animation sequence</a>
				<li><a href=#the-intrinsic-iteration-duration-of-an-animation-sequence><span class=secno>3.13.4.2</span> The intrinsic iteration duration of an animation sequence</a></ul></ul>
		<li><a href=#animations><span class=secno>3.14</span> Animations</a>
			<ul class=toc>
			<li><a href=#calculating-the-time-fraction><span class=secno>3.14.1</span> Calculating the time fraction</a></ul></ul>
	<li><a href=#animation-model><span class=secno>4</span> Animation Model</a>
		<ul class=toc>
		<li><a href=#animation-effects><span class=secno>4.1</span> Animation effects</a>
			<ul class=toc>
			<li><a href=#target-properties><span class=secno>4.1.1</span> Target properties</a>
			<li><a href=#procedures-for-animating-properties><span class=secno>4.1.2</span> Procedures for animating properties</a>
			<li><a href=#specific-animation-behaviors><span class=secno>4.1.3</span> Specific animation behaviors</a>
				<ul class=toc>
				<li><a href=#not-animatable><span class=secno>4.1.3.1</span> Not animatable</a>
				<li><a href=#animatable-as-string><span class=secno>4.1.3.2</span> Animatable as string</a>
				<li><a href=#animatable-as-real-number><span class=secno>4.1.3.3</span> Animatable as real number</a>
				<li><a href=#animatable-as-length-percentage-or-calc><span class=secno>4.1.3.4</span> Animatable as length, percentage, or calc</a>
				<li><a href=#animatable-as-color><span class=secno>4.1.3.5</span> Animatable as color</a>
				<li><a href=#animatable-as-transform-list><span class=secno>4.1.3.6</span> Animatable as transform list</a>
				<li><a href=#other-animation-behaviors><span class=secno>4.1.3.7</span> Other animation behaviors</a></ul>
			<li><a href=#intermediate-animation-values><span class=secno>4.1.4</span> Intermediate animation values</a></ul>
		<li><a href=#combining-animations><span class=secno>4.2</span> Combining animations</a>
			<ul class=toc>
			<li><a href=#the-animation-stack><span class=secno>4.2.1</span> The animation stack</a>
				<ul class=toc>
				<li><a href=#the-custom-player-priority><span class=secno>4.2.1.1</span> The custom player priority</a></ul>
			<li><a href=#calculating-the-result-of-an-animation-stack><span class=secno>4.2.2</span> Calculating the result of an animation stack</a>
			<li><a href=#animation-composition><span class=secno>4.2.3</span> Animation composition</a>
			<li><a href=#applying-the-composited-result><span class=secno>4.2.4</span> Applying the composited result</a>
				<ul class=toc>
				<li><a href=#applying-the-result-to-a-css-property><span class=secno>4.2.4.1</span> Applying the result to a CSS property</a>
				<li><a href=#applying-the-composited-result-to-a-dom-attribute><span class=secno>4.2.4.2</span> Applying the composited result to a DOM attribute</a></ul>
			<li><a href=#animation-accumulation><span class=secno>4.2.5</span> Animation accumulation</a></ul>
		<li><a href=#keyframe-animation-effects><span class=secno>4.3</span> Keyframe animation effects</a>
			<ul class=toc>
			<li><a href=#spacing-keyframes><span class=secno>4.3.1</span> Spacing keyframes</a>
				<ul class=toc>
				<li><a href=#applying-spacing-to-keyframes><span class=secno>4.3.1.1</span> Applying spacing to keyframes</a></ul>
			<li><a href=#the-intermediate-animation-value-of-a-keyframe-animation-effect><span class=secno>4.3.2</span> The intermediate animation value of a keyframe animation effect</a></ul>
		<li><a href=#motion-path-animation-effects><span class=secno>4.4</span> Motion path animation effects</a>
			<ul class=toc>
			<li><a href=#distance-along-a-path><span class=secno>4.4.1</span> Distance along a path</a>
			<li><a href=#spacing-motion-paths><span class=secno>4.4.2</span> Spacing motion paths</a>
				<ul class=toc>
				<li><a href=#applying-spacing-to-motion-paths><span class=secno>4.4.2.1</span> Applying spacing to motion paths</a></ul>
			<li><a href=#determining-the-path-fraction><span class=secno>4.4.3</span> Determining the path fraction</a>
			<li><a href=#the-intermediate-animation-value-of-a-motion-path-animation-effect><span class=secno>4.4.4</span> The intermediate animation value of a motion path animation effect</a></ul>
		<li><a href=#custom-effects><span class=secno>4.5</span> Custom effects</a>
			<ul class=toc>
			<li><a href=#sampling-custom-effects><span class=secno>4.5.1</span> Sampling custom effects</a>
			<li><a href=#execution-order-of-custom-effects><span class=secno>4.5.2</span> Execution order of custom effects</a></ul></ul>
	<li><a href=#programming-interface><span class=secno>5</span> Programming interface</a>
		<ul class=toc>
		<li><a href=#the-animationtimeline-interface><span class=secno>5.1</span> The <code>AnimationTimeline</code> interface</a>
		<li><a href=#the-animationplayer-interface><span class=secno>5.2</span> The <code>AnimationPlayer</code> interface</a>
		<li><a href=#the-animationnode-interface><span class=secno>5.3</span> The <code>AnimationNode</code> interface</a></ul>
	<li><a href=#conformance><span class=secno></span>  Conformance</a>
		<ul class=toc>
		<li><a href=#conventions><span class=secno></span>  Document conventions</a>
		<li><a href=#conformance-classes><span class=secno></span>  Conformance classes</a>
		<li><a href=#partial><span class=secno></span>  Partial implementations</a>
		<li><a href=#experimental><span class=secno></span>  Experimental implementations</a>
		<li><a href=#testing><span class=secno></span>  Non-experimental implementations</a></ul>
	<li><a href=#references><span class=secno></span>  References</a>
		<ul class=toc>
		<li><a href=#normative><span class=secno></span>  Normative References</a>
		<li><a href=#informative><span class=secno></span>  Informative References</a></ul>
	<li><a href=#index><span class=secno></span>  Index</a>
	<li><a href=#property-index><span class=secno></span>  Property index</a>
	<li><a href=#issues-index><span class=secno></span> Issues Index</a></ul></div>



<h2 class="heading settled heading" data-level=1 id=introduction><span class=secno>1 </span><span class=content>Introduction</span><a class=self-link href=#introduction></a></h2>
<div class=informative-bg><em>This section is non-normative</em>

<p>Web Animations defines a model for supporting animation and
synchronization on the Web platform.
It is intended that other specifications will build on this model and
expose its features through declarative means.
In addition, this specification also defines a programming interface to
the model that may be implemented by user agents that provide support
for scripting.</p>

<h3 class="heading settled heading" data-level=1.1 id=use-cases><span class=secno>1.1 </span><span class=content>Use cases</span><a class=self-link href=#use-cases></a></h3>

<p>The Web Animations model aims at two broad areas of application:</p>

<dl><dt data-md=""><p>User interface effects</p>
<dd data-md=""><p>Animation can be used to give visual clues and feedback to make
a user interface more readily comprehensible.</p>

<p>For example, a user action results in a table row being
removed to represent an item being removed from a shopping cart.cd -
In such a case, fading the row to transparent and then shifting
the subsequent rows up to fill the space over a few hundred
milliseconds provides the user with clear feedback as to the
results of their action as opposed to instantly removing the row
from the DOM.</p>

<p>To support this scenario not only are the animated effects of
fading and shifting required, but so is synchronization, both
between the animations, and between animations and scripted
actions (removing the table row from the DOM after the animations
have completed).</p>

<dt data-md=""><p>Storytelling and visualization</p>
<dd data-md=""><p>Another type of animation uses the animated effect to convey
a story or represent some information.
Unlike user interface effects which are largely a presentational
adjunct to the content, these animations form an essential part of
the content presented to the user.</p>

<p>For example, in an animated cartoon two cats fly through space
to another planet leaving a rainbow trail behind them.
After arriving at the planet a change of scene occurs and the user
should decide whether or not the cats enter a magic mountain by
selecting one of two preset destinations in the scene.</p>

<p>This scenario requires the following features:</p>

<ul><li data-md=""><p>animated effects for moving characters along a path as well as
warping a path (the rainbow trail),</p>
<li data-md=""><p>synchronization that allows some actions to happen
simultaneously (the two cats moving) and others in sequence
(the change of scene),</p>
<li data-md=""><p>play control to allow rewinding the cartoon, or changing its
playback rate to accommodate particular learning or
accessibility needs,</p>
<li data-md=""><p>the ability to trigger animations in response to user input</p>
</ul>
<p>Similar use cases in this category include visualising physical
phenomena such as spring motion for educational purposes,
or visualising data such as the prevalence of a disease over
a geographical space over a year whereby animation is used to
present the time-based component of the data.</p>
</dl>
<h3 class="heading settled heading" data-level=1.2 id=relationship-to-other-specifications><span class=secno>1.2 </span><span class=content>Relationship to other specifications</span><a class=self-link href=#relationship-to-other-specifications></a></h3>

<p>CSS Transitions [<cite><a class=bibref href=#bib-CSS3-TRANSITIONS>CSS3-TRANSITIONS</a></cite>], CSS Animations
[<cite><a class=bibref href=#bib-CSS3-ANIMATIONS>CSS3-ANIMATIONS</a></cite>], and SVG [<cite><a class=bibref href=#bib-SVG112>SVG112</a></cite>] all provide mechanisms \
that                                                                                                                                                                             
generate animated content on a Web page.                                                                                                                                         
Although the three specifications provide many similar features,                                                                                                                 
they are described in different terms.                                                                                                                                           
This specification proposes an abstract animation model that                                                                                                                     
encompasses the common features of all three specifications.                                                                                                                     
This model is backwards-compatible with the current behavior of these                                                                                                            
specifications such that they can be defined in terms of this model                                                                                                              
without any observable change.</p>

<p>The animation features in SVG 1.1 are defined in terms of SMIL
Animation [<cite><a class=bibref href=#bib-SMIL-ANIMATION>SMIL-ANIMATION</a></cite>].                                                                                        
It is intended that by defining SVG’s animation features in terms of                                                                                                             
the Web Animations model, the dependency between SVG and SMIL                                                                                                                    
Animation can be removed.</p>

<p>As with Timing control for script-based animations (commonly referred
to as “requestAnimationFrame”) <a data-biblio-type=informative data-link-type=biblio href=#biblio-raf title=biblio-RAF>[RAF]</a>,
the programming interface component of this specification allows
animations to be created from script.
The animations created using the interface defined in this
specification, however, once created, are executed entirely by the
user agent meaning they share the same performance characteristics as
animations defined by markup.
Using this interface it is possible to create animations
from script in a simpler and more performant manner.</p>

<p>The time values used within the programming interface
correspond with those used in Timing control for script-based
animations <a data-biblio-type=informative data-link-type=biblio href=#biblio-raf title=biblio-RAF>[RAF]</a> and their execution order to defined such that the
two interfaces can be used simultaneously without conflict.</p>

<p>The programming interface component of this specification makes
some additions to interfaces defined in HTML5 [<cite><a class=bibref href=#bib-HTML5>HTML5</a></cite>].</p>

<h3 class="heading settled heading" data-level=1.3 id=overview-of-this-specification><span class=secno>1.3 </span><span class=content>Overview of this specification</span><a class=self-link href=#overview-of-this-specification></a></h3>

<p>This specification begins by defining an abstract model for animation.
This is followed by a programming interface defined in terms of the                                                                                                              
abstract model.                                                                                                                                                                  
The programming interface is defined in terms of the abstract model                                                                                                              
and is only relevant to user agents that provide scripting support.</p>

</div>

<h2 class="heading settled heading" data-level=2 id=web-animations-model-overview><span class=secno>2 </span><span class=content>Web Animations model overview</span><a class=self-link href=#web-animations-model-overview></a></h2>

<div class=informative-bg><em>This section is non-normative</em>

<p>At a glance, the Web Animations model consists of two largely
independent pieces, a <em>timing model</em> and an <em>animation
model</em>.  The role of these pieces is as follows:</p>

<dl><dt data-md=""><p>Timing model</p>
<dd data-md=""><p>Takes a moment in time and converts it to a proportional distance
within a single iteration of an animation called the <em>time                                                                                                                    
fraction</em>.                                                                                                                                                                   
An <em>iteration index</em> is also generated for animations                                                                                                                     
that vary as they repeat.</p>
<dt data-md=""><p>Animation model</p>
<dd data-md=""><p>Takes the <em>time fractions</em> and <em>iteration indices</em>
produced by the timing model and converts them into a series of values                                                                                                           
to apply to the target properties and attributes.</p>
</dl>
<p>Graphically, this flow can be represented as follows:
<div class=figure>                                                                                                                                                             
<img alt="Overview of the operation of the Web Animations model." src=img/timing-and-animation-models.svg width=600>                                                         
</div>                                                                                                                                                                           
<p class=caption>                                                                                                                                                              
Overview of the operation of the Web Animations model.<br>                                                                                                                       
The current time is input to the timing model which produces a time                                                                                                              
fraction and an iteration index.<br>                                                                                                                                             
These parameters are used as input to the animation model which produces                                                                                                         
the values to apply.<br>                                                                                                                                                         
<p></p>

<p>For example, consider an animation that:</p>

<ul><li data-md=""><p>starts after 3 seconds</p>
<li data-md=""><p>runs twice,</p>
<li data-md=""><p>takes 2 seconds every time, and</p>
<li data-md=""><p>changes the width of a rectangle from 50 pixels to 100 pixels.</p>
</ul>
<p>The first three points apply to the timing model.
At a time of 6 seconds, it will calculate that the animation should be
half-way through its second iteration and produces the result 0.5.                                                                                                               
The animation model then uses that information to calculate a width</p>

<p>This specification begins with the timing model and then proceeds to
the animation model.</p>

</div>

<h2 class="heading settled heading" data-level=3 id=timing-model><span class=secno>3 </span><span class=content>Timing model</span><a class=self-link href=#timing-model></a></h2>

<p>This section describes and defines the behavior of the Web Animations
timing model.</p>

<h3 class="heading settled heading" data-level=3.1 id=the-timing-model-at-a-glance><span class=secno>3.1 </span><span class=content>The timing model at a glance</span><a class=self-link href=#the-timing-model-at-a-glance></a></h3>

<div class=informative-bg>

<p><em>This section is non-normative</em></p>

<p>Two features characterise the Web Animations timing model: it is
<em>stateless</em> and it is <em>hierarchical</em>.</p>

<h4 class="heading settled heading" data-level=3.1.1 id=stateless><span class=secno>3.1.1 </span><span class=content>Stateless</span><a class=self-link href=#stateless></a></h4>

<p>The Web Animations timing model operates by taking an input time and
producing an output time fraction.
Since the output is based solely on the input time and is independent
of previous inputs, the model may be described as stateless.
This gives the model the following properties:</p>


<dl><dt data-md=""><p>Frame-rate independent</p>
<dd data-md=""><p>Since the output is independent of previous inputs, the rate at
which the model is sampled will not affect its progress.
Provided the input times are proportional to the progress of
real-world time, animations will progress at an identical rate
regardless of the capabilities of the device running them.</p>
<dt data-md=""><p>Direction-agnostic</p>
<dd data-md=""><p>Since the sequence of inputs is insignificant, the model is
directionless.
This means that the model can be sampled in reverse or even in
a backwards and forwards pattern without requiring any specialized
handling.</p>
<dt data-md=""><p>Constant-time seeking</p>
<dd data-md=""><p>Since each input is independent of the previous input, the
processing required to perform a seek operation, even far into the
future, is at least potentially constant.</p>
</dl>
<p>There are a few exceptions to the stateless behavior of the timing
model.</p>

<p>Firstly, a number of methods defined in the <a data-section="" href=#programming-interface>programming interface</a> to the model
provide play control such as pausing an animation.
These methods are defined in terms of the time at which they are
called and are therefore stative.
These methods are provided primarily for convenience and are not part
of the core timing model but are layered on top.</p>

<p>Likewise, <a data-link-type=dfn href=#player-event title="player events">player events</a> are fired when the first sample occurs
at the limit of the <a data-link-type=dfn href=#source-content title="source content">source content</a>.
This too is stative behavior but is part of the play control layered
on top of the timing model.</p>

<p>Similarly, the <a data-section="" href=#limiting-the-current-time>limiting
behavior</a> of players means that dynamic changes to the end time of
the media (source content) of a player may produce a different result
depending on when the change occurs.
This behavior is somewhat unfortunate but has been deemed intuitive
and consistent with HTML.
As a result, the model can only truly be described as stateless
<em>in the absence of dynamic changes to its timing properties</em>.</p>

<p>Finally, each time the model is sampled, it can be considered to
establish a temporary state.
While this temporary state affects the values returned from the <a data-section="" href=#programming-interface>programming interface</a>, it has no
influence on the subsequent samples and hence does not conflict with
the stateless qualities described above.</p>

<h4 class="heading settled heading" data-level=3.1.2 id=hierarchical><span class=secno>3.1.2 </span><span class=content>Hierarchical</span><a class=self-link href=#hierarchical></a></h4>

<p>The other characteristic feature of the Web Animations timing model is
that time is inherited.
Time begins with a monotonically increasing time source and cascades
down a number of steps to each animation.
At each step, time may be shifted backwards and forwards, scaled,
reversed, paused, and repeated.</p>

<div class=figure>
  <img alt="A hierarchy of timing nodes" src=img/time-hierarchy.svg width=600>
</div>
<p class=caption>
  A hierarchy of timing nodes.
  Each node in the tree derives its time from its parent node.
  At the root of the tree is the global clock.
</p>

<p>A consequence of this hierarchical arrangement is that complex
animation arrangements can be reversed, scheduled, accelerated and so
on as a whole unit since the manipulations applied to the parent
cascade down to its <a data-link-type=dfn href=#descendant title=descendants>descendants</a>.
Furthermore, since time has a common source, it is easy to synchronize
animations.</p>

</div>

<h3 class="heading settled heading" data-level=3.2 id=timing-model-concepts><span class=secno>3.2 </span><span class=content>Timing model concepts</span><a class=self-link href=#timing-model-concepts></a></h3>

<p>In Web Animations, timing is based on a hierarchy of time relationships
between timing nodes.
Parent nodes provide timing information to their child nodes in the form
of <a data-link-type=dfn href=#time-value title="time values">time values</a>.
A <dfn data-dfn-type=dfn data-noexport="" id=time-value>time value<a class=self-link href=#time-value></a></dfn> is a real number which nominally represents
a number of milliseconds from some moment.
The connection between <a data-link-type=dfn href=#time-value title="time values">time values</a> and wall-clock milliseconds
may be obscured by any number of transformations applied to the value as
it passes through the time hierarchy.</p>

<p class=annotation>
In the future we may have timelines that are based on UI gestures in
which case the connection between time values and milliseconds will be
weakened even further.
</p>

<p>Periodically, the user agent will trigger an update to the timing model
in a process called <dfn data-dfn-type=dfn data-noexport="" id=sampling>sampling<a class=self-link href=#sampling></a></dfn>.
On each <dfn data-dfn-type=dfn data-noexport="" id=sample>sample<a class=self-link href=#sample></a></dfn> the <a data-link-type=dfn href=#time-value title="time values">time values</a> of each timing node are
updated.</p>

<p class=note>Note: A more precise definition of when the model is updated when scripting is
    involved is provided in <a data-section="" href=#script-execution-and-live-updates-to-the-model></a>.</p>

<h3 class="heading settled heading" data-level=3.3 id=the-global-clock><span class=secno>3.3 </span><span class=content>The global clock</span><a class=self-link href=#the-global-clock></a></h3>

<p>At the root of the Web Animations timing hierarchy is the <a data-link-type=dfn href=#global-clock title="global clock">global
clock</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=global-clock>global clock<a class=self-link href=#global-clock></a></dfn> is a source of monotonically increasing
<a data-link-type=dfn href=#time-value title="time values">time values</a> unaffected by adjustments to the system clock.
The <a data-link-type=dfn href=#time-value title="time values">time values</a> produced by the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> represent
wall-clock milliseconds from an unspecified historical moment.
Because the zero time of the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> is not specified,
the absolute values of the <a data-link-type=dfn href=#time-value title="time values">time values</a> produced by the <a data-link-type=dfn href=#global-clock title="global clock">global
clock</a> are not significant, only their rate of change.</p>

<p class=note>Note: The <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> is not exposed in the <a href=#programming-interface>programming interface</a> and nor is it
    expected to be exposed by markup.
    As a result the moment from which <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> <a data-link-type=dfn href=#time-value title="time values">time values</a>
    are measured, that is, the zero time of the clock, is
    implementation-dependent.
    One user agent may measure the number of milliseconds since the the user
    agent was loaded whilst another may use the time when the device was
    started.
    Both approaches are acceptable and produce no observable difference
    in the output of the model.</p>


<h3 class="heading settled heading" data-level=3.4 id=timelines><span class=secno>3.4 </span><span class=content>Timelines</span><a class=self-link href=#timelines></a></h3>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=timeline>timeline<a class=self-link href=#timeline></a></dfn> provides a source of <a data-link-type=dfn href=#time-value title="time values">time values</a> for the
purpose of synchronization.</p>

<p>Typically, a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> is tied to the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> such
that its absolute time is calculated as a fixed offset from the time of
the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a>.
This offset is established by designating some moment as the timeline’s
<dfn data-dfn-type=dfn data-noexport="" id=zero-time>zero time<a class=self-link href=#zero-time></a></dfn> and recording the <a data-link-type=dfn href=#time-value title="time value">time value</a> of the
<a data-link-type=dfn href=#global-clock title="global clock">global clock</a> at that moment.
At subsequent moments, the <a data-link-type=dfn href=#time-value title="time value">time value</a> of the timeline is
calculated as the difference between the current <a data-link-type=dfn href=#time-value title="time value">time value</a> of
the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> and the value recorded at the <a data-link-type=dfn href=#zero-time title="zero time">zero time</a>.</p>

<p class=annotation>
  Note that we anticipate that other types of timelines may be introduced
  in the future that are not tied to the global clock.
  For example, a timeline whose time values are related to the progress of
  a UI gesture.
</p>

<p>Since a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> may be defined relative to a moment that has yet
to occur, it may not always be able to return a meaningful <a data-link-type=dfn href=#time-value title="time value">time
value</a>.
A <a data-link-type=dfn href=#timeline title=timeline>timeline</a> is considered to be <dfn data-dfn-type=dfn data-noexport="" id=not-started>not started<a class=self-link href=#not-started></a></dfn> when it is
in such a state that it cannot produce a <a data-link-type=dfn href=#time-value title="time value">time value</a>.</p>

<p class=issue id=issue-855f2d0f><a class=self-link href=#issue-855f2d0f></a>Should this be renamed to something like “inactive” so we
    can accommodate possible future timelines that may, after starting,
    become unable to return a meaningful <a data-link-type=dfn href=#time-value title="time value">time value</a>?</p>

<h4 class="heading settled heading" data-level=3.4.1 id=the-document-timeline><span class=secno>3.4.1 </span><span class=content>The document timeline</span><a class=self-link href=#the-document-timeline></a></h4>

<p>Each document has a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> called the <dfn data-dfn-type=dfn data-noexport="" id=document-timeline>document
timeline<a class=self-link href=#document-timeline></a></dfn>.
The <a data-link-type=dfn href=#time-value title="time values">time values</a> of the <a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> are calculated
as a fixed offset from the <a data-link-type=dfn href=#global-clock title="global clock">global clock</a> such that the <a data-link-type=dfn href=#zero-time title="zero time">zero
time</a> corresponds to the <a href=http://www.w3.org/TR/navigation-timing/#dom-performancetiming-navigationstart>
<code>navigationStart</code></a> moment <a data-biblio-type=normative data-link-type=biblio href=#biblio-navigation-timing title=biblio-NAVIGATION-TIMING>[NAVIGATION-TIMING]</a>.
Prior to this moment, the <a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> is <a data-link-type=dfn href=#not-started title="not started">not
started</a>.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>Since the <a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> is tied to the <a data-link-type=dfn href=#global-clock title="global clock">global
clock</a> by a fixed offset, <a data-link-type=dfn href=#time-value title="time values">time values</a> reported by the
<a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> increase monotonically.
Furthermore, since no scaling is applied, these <a data-link-type=dfn href=#time-value title="time values">time values</a>
are proportional to wall-clock milliseconds.</p>

<p>Since the <a data-link-type=dfn href=#time-value title="time values">time values</a> of the <a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> are
relative to the <code>navigationStart</code> time,
<code>document.timeline.currentTime</code> will roughly correspond to
<a href=http://www.w3.org/TR/hr-time/#dom-performance-now>
<code>Performance.now()</code></a>
<a data-biblio-type=informative data-link-type=biblio href=#biblio-hr-time title=biblio-HR-TIME>[HR-TIME]</a> with the exception that
<code>document.timeline.currentTime</code> does not change within
a script execution block as defined in <a data-section="" href=#script-execution-and-live-updates-to-the-model></a>.</p>

</div>

<h3 class="heading settled heading" data-level=3.5 id=players><span class=secno>3.5 </span><span class=content>Players</span><a class=self-link href=#players></a></h3>

<div class=informative-bg><em>This section is non-normative</em>

<p>The children of a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> are called <em>players</em>.
A player takes an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> which is a static
description of some timed behavior and binds it to a <a data-link-type=dfn href=#timeline title=timeline>timeline</a>
so that it runs.
A player also allows run-time control of the connection between the
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> and its <a data-link-type=dfn href=#timeline title=timeline>timeline</a> by providing pausing,
seeking, and speed control.
The relationship between a player and an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is
analogous to that of a DVD player and a DVD.
</div><p></p>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=player>player<a class=self-link href=#player></a></dfn> connects a single <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>, called
its <dfn data-dfn-type=dfn data-noexport="" id=source-content>source content<a class=self-link href=#source-content></a></dfn>, to a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> and provides
playback control.</p>

<p>A <a data-link-type=dfn href=#player title=player>player</a>’s <dfn data-dfn-type=dfn data-noexport="" id=player-start-time title="player start time">start time<a class=self-link href=#player-start-time></a></dfn> is the
<a data-link-type=dfn href=#time-value title="time value">time value</a> of its <a data-link-type=dfn href=#timeline title=timeline>timeline</a> when its <a data-link-type=dfn href=#source-content title="source content">source content</a>
is scheduled to begin playback.</p>

<p>When a <a data-link-type=dfn href=#player title=player>player</a> is created, it is assigned a globally unique
sequence number called the <dfn data-dfn-type=dfn data-noexport="" id=player-sequence-number>player sequence number<a class=self-link href=#player-sequence-number></a></dfn>.
This number is used to resolve the sort order of players for a variety
of situations such as combining animations, queuing events, and
returning the list of current players.</p>

<h4 class="heading settled heading" data-level=3.5.1 id=the-current-time-of-a-player><span class=secno>3.5.1 </span><span class=content>The current time of a player</span><a class=self-link href=#the-current-time-of-a-player></a></h4>

<p><a data-link-type=dfn href=#player title=Players>Players</a> provide a <a data-link-type=dfn href=#time-value title="time value">time value</a> to their <a data-link-type=dfn href=#source-content title="source content">source
content</a> called the player’s <dfn data-dfn-type=dfn data-noexport="" id=current-time>current time<a class=self-link href=#current-time></a></dfn>.</p>

<p>The calculation of the <a data-link-type=dfn href=#current-time title="current time">current time</a> is as follows:</p>

<blockquote>
  <code><a data-link-type=dfn href=#current-time title="current time">current time</a> =
  (<var>timeline time</var> - <a data-link-type=dfn href=#player-start-time title="player start time">start time</a>)
  × <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a></code>
  <p>
    <em>unless</em> the <a data-link-type=dfn title="hold time">hold time</a> is <em>not</em> null, in which
    case the <a data-link-type=dfn href=#current-time title="current time">current time</a> is equal to the <a data-link-type=dfn title="hold time">hold time</a>.
  </p>
</blockquote>

<p>Where:</p>

<ul><li data-md=""><p><var>timeline time</var> is the current <a data-link-type=dfn href=#time-value title="time value">time value</a> of the
<a data-link-type=dfn href=#timeline title=timeline>timeline</a> with which this <a data-link-type=dfn href=#player title=player>player</a> is associated.</p>
<li data-md=""><p><var>start time</var> is the player’s <a data-link-type=dfn href=#player-start-time title="player start time">start time</a>.</p>
<li data-md=""><p><var>playback rate</var> is the player’s <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> value described in
<a data-section="" href=#speed-control>§3.5.3 Speed control</a>.</p>
<li data-md=""><p><a data-link-type=dfn title="hold time">hold time</a> is the value described in
<a data-section="" href=#seeking--pausing-and-limiting-properties></a>.</p>
</ul>
<p>The procedure for performing manual updates to the <a data-link-type=dfn href=#current-time title="current time">current time</a>
is defined in <a data-section="" href=#performing-a-seek>§3.5.2.9 Performing a seek</a>.</p>

<p>If the <a data-link-type=dfn href=#timeline title=timeline>timeline</a> with which the <a data-link-type=dfn href=#player title=player>player</a> is associated is
<a data-link-type=dfn href=#not-started title="not started">not started</a>, then the <a data-link-type=dfn href=#current-time title="current time">current time</a> is null.</p>

<p></p>

<p></p>

<p>It is often useful to manipulate the <a data-link-type=dfn href=#current-time title="current time">current time</a> of a player
even when its associated <a data-link-type=dfn href=#timeline title=timeline>timeline</a> is <a data-link-type=dfn href=#not-started title="not started">not started</a>.
For example, this is useful for pre-seeking a player.
For this purpose, we have the following additional definitions:</p>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=effective-timeline-time>effective timeline time<a class=self-link href=#effective-timeline-time></a></dfn></p>
<dd data-md=""><p>The current <a data-link-type=dfn href=#time-value title="time value">time value</a> of the <a data-link-type=dfn href=#timeline title=timeline>timeline</a> associated
with a <a data-link-type=dfn href=#player title=player>player</a> unless the timeline is <a data-link-type=dfn href=#not-started title="not started">not started</a>, in
which case the <var>effective timeline time</var> is zero.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=effective-current-time>effective current time<a class=self-link href=#effective-current-time></a></dfn></p>
<dd data-md="">
The result of evaluating the <a data-link-type=dfn href=#current-time title="current time">current time</a> as above
but substituting the <a data-link-type=dfn href=#effective-timeline-time title="effective timeline time">effective timeline time</a> for the
<var>timeline time</var>.
</dl>
<h4 class="heading settled heading" data-level=3.5.2 id=seeking-pausing-and-limiting><span class=secno>3.5.2 </span><span class=content>Seeking, pausing and limiting</span><a class=self-link href=#seeking-pausing-and-limiting></a></h4>

<p>Seeking, pausing and limiting a player are closely related and are
described here together.</p>

<h5 class="heading settled heading" data-level=3.5.2.1 id=introduction-to-seeking><span class=secno>3.5.2.1 </span><span class=content>Introduction to seeking</span><a class=self-link href=#introduction-to-seeking></a></h5>

<div class=informative-bg><em>This section is non-normative</em>

<p>Changing the current playback position of a player, that is, its
<a data-link-type=dfn href=#current-time title="current time">current time</a>, can be used to rewind its <a data-link-type=dfn href=#source-content title="source content">source content</a>
to its start point, fast-forward to a point in the future, or to
provide ad-hoc synchronization between players.</p>

<p>Changing the <a data-link-type=dfn href=#current-time title="current time">current time</a> of a player has the side effect of
shifting its <a data-link-type=dfn href=#player-start-time title="player start time">start time</a> as
illustrated below.</p>

<div class=figure>
<img alt="The effect of seeking a player." src=img/seeking.svg width=600>
</div>
<p class=caption>
At time <var>t</var>, a seek is performed on the player changing its
<a data-link-type=dfn href=#current-time title="current time">current time</a> from 1.5s to 2s.<br>
</p>

<p>It is possible to seek a player even if its <a data-link-type=dfn href=#timeline title=timeline>timeline</a> is
<a data-link-type=dfn href=#not-started title="not started">not started</a>.
Once the timeline begins, the player will begin playback from the
seeked time.</p>

</div>

<h5 class="heading settled heading" data-level=3.5.2.2 id=introduction-to-pausing><span class=secno>3.5.2.2 </span><span class=content>Introduction to pausing</span><a class=self-link href=#introduction-to-pausing></a></h5>

<div class=informative-bg><em>This section is non-normative</em>

<p>Pausing can be used to temporarily suspend a <a data-link-type=dfn href=#player title=player>player</a>.
Like seeking, pausing controls the <a data-link-type=dfn href=#current-time title="current time">current time</a> of
a player by updating its <a data-link-type=dfn href=#player-start-time title="player start time">start
time</a>.
The result is illustrated below.</p>

<div class=figure>
<img alt="The effect of pausing a player." src=img/pausing.svg width=600>
</div>
<p class=caption>
The effect of pausing a <a data-link-type=dfn href=#player title=player>player</a>.<br>
Whether pausing before or after a <a data-link-type=dfn href=#player title=player>player</a>’s <a data-link-type=dfn href=#player-start-time title="player start time">start time</a>,
the <a data-link-type=dfn href=#player title=player>player</a>’s <a data-link-type=dfn href=#player-start-time title="player start time">start time</a> is
delayed by the duration of the interval during which it was paused.
</p>

</div>

<h5 class="heading settled heading" data-level=3.5.2.3 id=limiting-the-current-time><span class=secno>3.5.2.3 </span><span class=content>Limiting the current time</span><a class=self-link href=#limiting-the-current-time></a></h5>

<div class=informative-bg><em>This section is non-normative</em>

<p>Players in the real world such as DVD players or cassette players
typically continue playing until they reach the end of their media
at which point they stop.
If such players are able to play in reverse, they typically stop
playing when they reach the beginning of their media.
In order to emulate this behavior and to provide consistency
with HTML’s <a href=http://www.w3.org/TR/html5/embedded-content-0.html#media-elements>media
elements</a> <a data-biblio-type=informative data-link-type=biblio href=#biblio-html5 title=biblio-HTML5>[HTML5]</a>, the <a data-link-type=dfn href=#current-time title="current time">current time</a> of Web Animations'
players do not play forwards beyond the <a data-link-type=dfn href=#end-time title="end time">end time</a> of their
<a data-link-type=dfn href=#source-content title="source content">source content</a> or play backwards past time zero.
This behavior is called <em>limiting</em>.</p>

<p>Graphically, the effect of limiting is shown below.</p>

<div class=figure>
<img alt="The effect of pausing a player." src=img/limiting.svg width=500>
</div>
<p class=caption>
The effect of limiting on a <a data-link-type=dfn href=#player title=player>player</a> with a start time of 1s,
a source content of length 3s, and a positive <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback
rate</a>.
After the <a data-link-type=dfn href=#current-time title="current time">current time</a> of the player reaches the end of the
source content, it is capped at 3s.
</p>

<p>It is possible, however, to <em>seek</em> the <a data-link-type=dfn href=#current-time title="current time">current time</a> of
a <a data-link-type=dfn href=#player title=player>player</a> to a time past the end of the <a data-link-type=dfn href=#source-content title="source content">source content</a>.
When doing so, the <a data-link-type=dfn href=#current-time title="current time">current time</a> will not progress but the
player will act as if it had been paused at the seeked time.</p>

<p>This allows, for example, seeking the <a data-link-type=dfn href=#current-time title="current time">current time</a> of
a player with <em>no</em> <a data-link-type=dfn href=#source-content title="source content">source content</a> to 5s.
If <a data-link-type=dfn href=#source-content title="source content">source content</a> with an <a data-link-type=dfn href=#end-time title="end time">end time</a> later than 5s is
later associated with the player, playback will begin from the 5s
mark.</p>

<p>Similar behavior to the above scenarios may arise when the
length of a player’s <a data-link-type=dfn href=#source-content title="source content">source content</a> changes.</p>

<p>When the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is negative, the <a data-link-type=dfn href=#current-time title="current time">current
time</a> does not progress past time zero although it may be seeked
to a negative time.</p>

<p>Limiting the <a data-link-type=dfn href=#current-time title="current time">current time</a> acts like a sort of automatic
pausing and is accomplished using the same machinery as pausing.</p>

</div>

<h5 class="heading settled heading" data-level=3.5.2.4 id=seeking-pausing-and-limiting-properties><span class=secno>3.5.2.4 </span><span class=content>Seeking, pausing and limiting properties</span><a class=self-link href=#seeking-pausing-and-limiting-properties></a></h5>

<p><a data-link-type=dfn href=#player title=Players>Players</a> track two properties related to seeking,
pausing and limiting.</p>


<dl><dt data-md=""><p>paused state</p>
<dd data-md=""><p>A boolean value that is true if the player is currently paused.
The <a data-link-type=dfn title="paused state">paused state</a> is initially false.</p>
<dt data-md=""><p>hold time</p>
<dd data-md=""><p>The <a data-link-type=dfn href=#effective-current-time title="effective current time">effective current time</a> to maintain while the player is
paused or effectively paused either because it has reached the end
of its <a data-link-type=dfn href=#source-content title="source content">source content</a> and is <a data-link-type=dfn href=#limited title=limited>limited</a>, or because it
has a zero <a data-link-type=dfn title="playback rate">playback rate</a>.
When none of these conditions apply, the <a data-link-type=dfn title="hold time">hold time</a> is
null.
The <a data-link-type=dfn title="hold time">hold time</a> is initially null.</p>
</dl>
<p>In addition to these properties, implementations are required to
keep track of the last calculated value of the <a data-link-type=dfn href=#current-time title="current time">current time</a>
in order to produce correct limiting behavior (see <a data-section="" href=#automatically-updating-the-hold-time>§3.5.2.7 Automatically updating the hold time</a>).</p>

<h5 class="heading settled heading" data-level=3.5.2.5 id=calculating-the-player-start-time><span class=secno>3.5.2.5 </span><span class=content>Calculating the player start time</span><a class=self-link href=#calculating-the-player-start-time></a></h5>

<p>The <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> value is both a stored and
a calculated value.
When a player is paused, the value is calculated from the <a data-link-type=dfn title="hold time">hold
time</a>.
When a player is not paused, the stored value is used.</p>

<p>The value of the <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> at a given moment is
based on the <a data-link-type=dfn title="paused state">paused state</a> as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn title="paused state">paused state</a> is true</p>
<dd data-md=""><p>Return the result of evaluating
<code><var>effective timeline time</var>
- <a data-link-type=dfn title="hold time">hold time</a> / <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a></code>.<br>
If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is zero, return negative infinity.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return the stored value for the <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a>.</p>
</dl>
</div>

<h5 class="heading settled heading" data-level=3.5.2.6 id=updating-the-player-start-time><span class=secno>3.5.2.6 </span><span class=content>Updating the player start time</span><a class=self-link href=#updating-the-player-start-time></a></h5>

<p>The <a data-link-type=dfn href=#player-start-time title="player start time">start time</a> of a <a data-link-type=dfn href=#player title=player>player</a>
is updated to a new time, <var>new start time</var>, as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn title="paused state">paused state</a> is true,</p>
<dd data-md=""><p>Let the <a data-link-type=dfn title="hold time">hold time</a> be the result of evaluating
<code><var>timeline time</var> - <var>new start time</var>
× <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a></code>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md="">

<ol><li data-md=""><p>Let the stored value of <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> be <var>new
start time</var>.</p>
<li data-md=""><p>Set the <a data-link-type=dfn title="hold time">hold time</a> to null.</p>
</ol></dl>
</div>

<h5 class="heading settled heading" data-level=3.5.2.7 id=automatically-updating-the-hold-time><span class=secno>3.5.2.7 </span><span class=content>Automatically updating the hold time</span><a class=self-link href=#automatically-updating-the-hold-time></a></h5>

<p>The <a data-link-type=dfn title="hold time">hold time</a> is updated prior to each time the <a data-link-type=dfn href=#current-time title="current time">current
time</a> is calculated when <em>all</em> of the following conditions
are true:</p>

<ul><li data-md=""><p>the <a data-link-type=dfn title="paused state">paused state</a> is false, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is not zero, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#timeline title=timeline>timeline</a> is <a data-link-type=dfn href=#not-started title="not started">started</a>.</p>
</ul>
<p>When all the above conditions are satisfied, the following steps are
performed:</p>

<ol><li data-md=""><p>Let the <dfn data-dfn-type=dfn data-noexport="" id=unlimited-current-time>unlimited current time<a class=self-link href=#unlimited-current-time></a></dfn> be the result of
evaluating the <a data-link-type=dfn href=#current-time title="current time">current time</a> using a <a data-link-type=dfn title="hold time">hold time</a> of
null.</p>
<li data-md=""><p>Let the <dfn data-dfn-type=dfn data-noexport="" id=source-content-end>source content end<a class=self-link href=#source-content-end></a></dfn> be the <a data-link-type=dfn href=#end-time title="end time">end time</a>
of the player’s <a data-link-type=dfn href=#source-content title="source content">source content</a>.
If the player has no <a data-link-type=dfn href=#source-content title="source content">source content</a>, let the
<em>source content end</em> be zero.</p>
<li data-md=""><p>The <a data-link-type=dfn title="hold time">hold time</a> is updated using the first matching
condition from below:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; 0 and
the <a data-link-type=dfn href=#unlimited-current-time title="unlimited current time">unlimited current time</a> ≤ 0,</p>
<dd data-md=""><p>Let the <a data-link-type=dfn title="hold time">hold time</a> be zero.</p>
<dt data-md=""><p>If the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; 0 and
the <a data-link-type=dfn href=#unlimited-current-time title="unlimited current time">unlimited current time</a> ≥ <a data-link-type=dfn href=#source-content-end title="source content end">source content
end</a>,</p>
<dd data-md=""><p>Let the <a data-link-type=dfn title="hold time">hold time</a> be the maximum value of
the last calculated value of <a data-link-type=dfn href=#current-time title="current time">current time</a>
and <a data-link-type=dfn href=#source-content-end title="source content end">source content end</a>.
If there is no previously calculated value of <a data-link-type=dfn href=#current-time title="current time">current
time</a> or it is null,
let the <a data-link-type=dfn title="hold time">hold time</a> be <a data-link-type=dfn href=#source-content-end title="source content end">source content end</a>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md="">

<ol><li data-md=""><p>If the <a data-link-type=dfn title="hold time">hold time</a> is not null,
set the stored value of the <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a>
to the result of evaluating <code><var>timeline
time</var> - <a data-link-type=dfn title="hold time">hold time</a>
/ <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a></code>.</p>
<li data-md=""><p>Let the <a data-link-type=dfn title="hold time">hold time</a> be null.</p>
</ol></dl>
</div>
</ol>
<h5 class="heading settled heading" data-level=3.5.2.8 id=updating-the-paused-state><span class=secno>3.5.2.8 </span><span class=content>Updating the paused state</span><a class=self-link href=#updating-the-paused-state></a></h5>

<p>The procedure for updating the <a data-link-type=dfn title="paused state">paused state</a> is as
follows:</p>

<ol><li data-md=""><p>Let <var>new value</var> be the new paused state to set.</p>
<li data-md=""><p>If <var>new value</var> equals the current <a data-link-type=dfn title="paused state">paused state</a>,
abort this procedure.</p>
<li data-md=""><p>The next step depends on the current <a data-link-type=dfn title="paused state">paused state</a> as
follows,</p>

<div class=switch>

<dl><dt data-md=""><p>If <a data-link-type=dfn title="paused state">paused state</a> is true and the <a data-link-type=dfn href=#player title=player>player</a> is not
<a data-link-type=dfn href=#limited title=limited>limited</a>,</p>
<dd data-md="">

<ol><li data-md=""><p>Set the <em>stored</em> value of <a data-link-type=dfn href=#player-start-time title="player start time">player start
time</a> to the <em>current calculated</em> value of
<a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> as defined in 
<a data-section="" href=#calculating-the-player-start-time>§3.5.2.5 Calculating the player start time</a></p>
<li data-md=""><p>Set the <a data-link-type=dfn title="hold time">hold time</a> to null.</p>
</ol>
<dt data-md=""><p>Otherwise if the <a data-link-type=dfn title="paused state">paused state</a> is false,</p>
<dd data-md=""><p>Record the current value of the <a data-link-type=dfn href=#effective-current-time title="effective current time">effective current time</a>
as <a data-link-type=dfn title="hold time">hold time</a>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Do nothing.</p>
</dl>
</div><li data-md=""><p>Update <a data-link-type=dfn title="paused state">paused state</a> to <var>new value</var>.</p>
</ol>
<h5 class="heading settled heading" data-level=3.5.2.9 id=performing-a-seek><span class=secno>3.5.2.9 </span><span class=content>Performing a seek</span><a class=self-link href=#performing-a-seek></a></h5>

<p><dfn data-dfn-type=dfn data-noexport="" id=seeking>Seeking<a class=self-link href=#seeking></a></dfn> is the process of updating a player’s <a data-link-type=dfn href=#current-time title="current time">current
time</a> to a desired value.
It is achieved using the following procedure:</p>

<ol><li data-md=""><p>Let <var>seek time</var> be the desired <a data-link-type=dfn href=#time-value title="time value">time value</a> for
the player’s <a data-link-type=dfn href=#current-time title="current time">current time</a>.</p>
<li data-md=""><p>If <em>any</em> of the following conditions are true:</p>

<ul><li data-md=""><p>the <a data-link-type=dfn title="paused state">paused state</a> is true, or</p>
<li data-md=""><p>the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; 0 and <var>seek
time</var> ≥ <a data-link-type=dfn href=#source-content-end title="source content end">source content end</a> (as defined in 
<a data-section="" href=#automatically-updating-the-hold-time>§3.5.2.7 Automatically updating the hold time</a>), or</p>
<li data-md=""><p>the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; 0 and <var>seek
time</var> ≤ zero, or</p>
<li data-md=""><p>the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> = 0</p>
</ul>
<p>then set <a data-link-type=dfn title="hold time">hold time</a> to <var>seek time</var>.</p>
<li data-md=""><p>If <em>all</em> of the following are true:</p>

<ul><li data-md=""><p>the <a data-link-type=dfn title="paused state">paused state</a> is false, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is not zero</p>
</ul>
<p>then:</p>

<ol><li data-md=""><p>Reset the <a data-link-type=dfn title="hold time">hold time</a> to null.</p>
<li data-md=""><p>Set the stored value of <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a>
to the result of evaluating <code><var>effective timeline
time</var> - <var>seek time</var> / <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player
playback rate</a></code>.</p>
<li data-md=""><p>Set the player’s <a data-link-type=dfn href=#finished-flag title="finished flag">finished flag</a> to false.</p>
</ol>
<p>Since <a data-link-type=dfn href=#seeking title=seeking>seeking</a> effectively updates the player’s <a data-link-type=dfn href=#current-time title="current time">current
time</a> it also causes the “previously calculated value of
<a data-link-type=dfn href=#current-time title="current time">current time</a>” as used by the procedure for updating the
<a data-link-type=dfn title="hold time">hold time</a> to be updated (see <a data-section="" href=#automatically-updating-the-hold-time>§3.5.2.7 Automatically updating the hold time</a>).</p>
</ol>
<h5 class="heading settled heading" data-level=3.5.2.10 id=limited-players><span class=secno>3.5.2.10 </span><span class=content>Limited players</span><a class=self-link href=#limited-players></a></h5>

<p>A <a data-link-type=dfn href=#player title=player>player</a> is said to be <dfn data-dfn-type=dfn data-noexport="" id=limited>limited<a class=self-link href=#limited></a></dfn> when either of the
following conditions are true:</p>

<ol><li data-md=""><p><a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; 0 and <a data-link-type=dfn href=#effective-current-time title="effective current time">effective current
time</a> ≥ the player’s <a data-link-type=dfn href=#source-content-end title="source content end">source content end</a>
(as defined in <a data-section="" href=#automatically-updating-the-hold-time>§3.5.2.7 Automatically updating the hold time</a>), or</p>
<li data-md=""><p><a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; 0 and <a data-link-type=dfn href=#effective-current-time title="effective current time">effective current
time</a> ≤ zero.</p>
</ol>
<h4 class="heading settled heading" data-level=3.5.3 id=speed-control><span class=secno>3.5.3 </span><span class=content>Speed control</span><a class=self-link href=#speed-control></a></h4>

<div class=informative-bg>

<p>The rate of play of a player can be controlled by setting its
<em>playback rate</em>.
For example, setting a playback rate of 2 will cause the player’s
<a data-link-type=dfn href=#current-time title="current time">current time</a> to increase at twice the rate of its <a data-link-type=dfn href=#timeline title=timeline>timeline</a>.
Similarly, a playback rate of -1 will cause the player’s <a data-link-type=dfn href=#current-time title="current time">current
time</a> to decrease at the same rate as the <a data-link-type=dfn href=#time-value title="time values">time values</a> from
its <a data-link-type=dfn href=#timeline title=timeline>timeline</a> increase.</p>

<p>Note that <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> also have a <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> associated
with them that behaves differently to that defined here.</p>

</div>

<p><a data-link-type=dfn href=#player title=Players>Players</a> have a <dfn data-dfn-type=dfn data-noexport="" id=player-playback-rate title="player playback
rate">playback rate<a class=self-link href=#player-playback-rate></a></dfn> that provides a scaling factor from the rate
of change of the associated <a data-link-type=dfn href=#timeline title=timeline>timeline</a>’s <a data-link-type=dfn href=#time-value title="time values">time values</a> to
the player’s <a data-link-type=dfn href=#current-time title="current time">current time</a>.
The <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> is initially 1.</p>

<p>Setting a player’s <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a>
to zero effectively pauses the player but without affecting the
player’s <a data-link-type=dfn title="paused state">paused state</a>.</p>

<h5 class="heading settled heading" data-level=3.5.3.1 id=updating-the-playback-rate><span class=secno>3.5.3.1 </span><span class=content>Updating the playback rate</span><a class=self-link href=#updating-the-playback-rate></a></h5>

<p>Changes to the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a>
trigger a compensatory seek so that that the player’s
<a data-link-type=dfn href=#current-time title="current time">current time</a> is unaffected by the change to the playback
rate.</p>

<p>The procedure is as follows:</p>

<ol><li data-md=""><p>Let <var>previous time</var> be the value of the <a data-link-type=dfn href=#effective-current-time title="effective current time">effective
current time</a> before updating the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a>.</p>
<li data-md=""><p>Update the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> to
the new value.</p>
<li data-md=""><p>Seek to <var>previous time</var> using the procedure defined in
<a data-section="" href=#performing-a-seek>§3.5.2.9 Performing a seek</a>.</p>
<li data-md=""><p>If the new value for the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> differs in sign
to the previous non-zero playback rate, set the <a data-link-type=dfn href=#finished-flag title="finished flag">finished
flag</a> to false.</p>
</ol>
<h4 class="heading settled heading" data-level=3.5.4 id=player-events><span class=secno>3.5.4 </span><span class=content>Player events</span><a class=self-link href=#player-events></a></h4>

<p>As <a data-link-type=dfn href=#player title=players>players</a> play they report changes to
their status through <dfn data-dfn-type=dfn data-noexport="" id=player-event title="player event">player events<a class=self-link href=#player-event></a></dfn>.</p>

<p><a data-link-type=dfn href=#player-event title="Player events">Player events</a> are a property of the Web Animations timing
model.
As a result they are dispatched even when the <a data-link-type=dfn href=#source-content title="source content">source content</a> of
the player is absent or has no observable result.</p>

<h5 class="heading settled heading" data-level=3.5.4.1 id=types-of-player-events><span class=secno>3.5.4.1 </span><span class=content>Types of player events</span><a class=self-link href=#types-of-player-events></a></h5>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=finish-player-event title="finish player event">finish<a class=self-link href=#finish-player-event></a></dfn></p>
<dd data-md=""><p>Queued whenever a sample occurs that causes a <a data-link-type=dfn href=#player title=player>player</a>’s
<a data-link-type=dfn href=#finished-flag title="finished flag">finished flag</a> to be newly true.</p>

<ul><li data-md=""><p>Bubbles: no</p>
<li data-md=""><p>Cancelable: no</p>
<li data-md=""><p>Context Info: currentTime, documentTime</p>
</ul></dl>
<p>To assist dispatching <a data-link-type=dfn href=#finish-player-event title="finish player event">finish
events</a>, <a data-link-type=dfn href=#player title=players>players</a> maintain a <dfn data-dfn-type=dfn data-noexport="" id=finished-flag>finished flag<a class=self-link href=#finished-flag></a></dfn> that
is initially false when the player is created.</p>

<p>During each <a data-link-type=dfn href=#sampling title=sample>sample</a>, the <a data-link-type=dfn href=#finished-flag title="finished flag">finished flag</a> is updated such
that it is set to true if the player is <a data-link-type=dfn href=#limited title=limited>limited</a> and false
otherwise.</p>

<h5 class="heading settled heading" data-level=3.5.4.2 id=event-parameters><span class=secno>3.5.4.2 </span><span class=content>Event parameters</span><a class=self-link href=#event-parameters></a></h5>

<p><a data-link-type=dfn href=#player-event title="Player events">Player events</a> have an associated <a data-link-type=dfn href=#event-current-time title="event current time">event
current time</a> and <a data-link-type=dfn href=#event-timeline-time title="event timeline time">event timeline time</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=event-current-time>event current time<a class=self-link href=#event-current-time></a></dfn> is the <a data-link-type=dfn href=#current-time title="current time">current time</a> of the
<a data-link-type=dfn href=#player title=player>player</a> that generated the event at the moment the event is
queued.
This will be null if the <a data-link-type=dfn href=#player title=player>player</a> was not associated with
a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> at the time the event was generated.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=event-timeline-time>event timeline time<a class=self-link href=#event-timeline-time></a></dfn> is the <a data-link-type=dfn href=#time-value title="time value">time value</a> of the
<a data-link-type=dfn href=#timeline title=timeline>timeline</a> with which the <a data-link-type=dfn href=#player title=player>player</a> that generated the
event is associated at the moment the event is queued.
This will be null if the <a data-link-type=dfn href=#player title=player>player</a> was not associated with
a <a data-link-type=dfn href=#timeline title=timeline>timeline</a> at the time the event was generated.</p>

<h5 class="heading settled heading" data-level=3.5.4.3 id=propagation-path><span class=secno>3.5.4.3 </span><span class=content>Propagation path</span><a class=self-link href=#propagation-path></a></h5>

<p>The <a href=http://www.w3.org/TR/DOM-Level-3-Events/#glossary-propagation-path>propagation
path</a> for a <a data-link-type=dfn href=#player-event title="player event">player event</a> generated by <var>player</var>,
is simply <var>player</var> itself.</p>

<h5 class="heading settled heading" data-level=3.5.4.4 id=sequence-of-events><span class=secno>3.5.4.4 </span><span class=content>Sequence of events</span><a class=self-link href=#sequence-of-events></a></h5>

<p>The sequence in which <a data-link-type=dfn href=#player-event title="player events">player events</a> are queued is in
ascending order by <a data-link-type=dfn href=#event-timeline-time title="event timeline time">event timeline time</a>.
If two <a data-link-type=dfn href=#player-event title="player events">player events</a> have the same <a data-link-type=dfn title="event document time">event document
time</a>, the <a data-link-type=dfn href=#player-event title="player events">player events</a> are queued in ascending order by
<a data-link-type=dfn href=#player-sequence-number title="player sequence number">player sequence number</a> of the <a data-link-type=dfn href=#player title=players>players</a> that generated
the events.</p>

<h5 class="heading settled heading" data-level=3.5.4.5 id=event-dispatch><span class=secno>3.5.4.5 </span><span class=content>Event dispatch</span><a class=self-link href=#event-dispatch></a></h5>

<p><dfn data-dfn-type=dfn data-noexport="" id=events-are-queued>Events are queued<a class=self-link href=#events-are-queued></a></dfn> whenever <a data-link-type=dfn href=#sampling title=sampling>sampling</a> regularly
occurs (that is, <em>not</em> when the timing model is evaluated due
to <a data-link-type=dfn href=#seeking title=seeking>seeking</a> or structural changes to the hierarchy of
<a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a>).</p>

<p>As a result, <a data-link-type=dfn href=#seeking title=seeking>seeking</a> a <a data-link-type=dfn href=#player title=player>player</a> to the limit of its
<a data-link-type=dfn href=#source-content title="source content">source content</a> and back to a point within its <a data-link-type=dfn href=#source-content title="source content">source
content</a> within the same script execution block will <em>not</em>
trigger a <a data-link-type=dfn href=#finish-player-event title="finish player event">finish</a> event.</p>

<h3 class="heading settled heading" data-level=3.6 id=animation-nodes><span class=secno>3.6 </span><span class=content>Animation nodes</span><a class=self-link href=#animation-nodes></a></h3>

<p>An <dfn data-dfn-type=dfn data-noexport="" id=animation-node>animation node<a class=self-link href=#animation-node></a></dfn> is an abstract term referring to an item in
the timing hierarchy.</p>

<h4 class="heading settled heading" data-level=3.6.1 id=relationship-between-animation-nodes-and-players><span class=secno>3.6.1 </span><span class=content>Relationship between animation nodes and players</span><a class=self-link href=#relationship-between-animation-nodes-and-players></a></h4>

<p>The <a data-link-type=dfn href=#source-content title="source content">source content</a> of a <a data-link-type=dfn href=#player title=player>player</a>, if set, is a type of
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.
The <a data-link-type=dfn href=#source-content title="source content">source content</a> of a <a data-link-type=dfn href=#player title=player>player</a> is said to be <dfn data-dfn-type=dfn data-noexport="" id=directly-associated-with-a-player title="directly associated with a player">directly associated<a class=self-link href=#directly-associated-with-a-player></a></dfn>
with that player.</p>

<p><a data-link-type=dfn href=#animation-node title="Animation nodes">Animation nodes</a> can be combined together into a hierarchy using
<a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> (see <a data-section="" href=#grouping-and-synchronization>§3.13 Grouping and synchronization</a>).
Only the <a data-link-type=dfn href=#root title=root>root</a> <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> of such a hierarchy can be
<a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated with a player</a>.
If an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> that has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
is designated as the <a data-link-type=dfn href=#source-content title="source content">source content</a> of a <a data-link-type=dfn href=#player title=player>player</a>, the
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is removed from its <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation
group</a> before being associated with the <a data-link-type=dfn href=#player title=player>player</a>.</p>

<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is <dfn data-dfn-type=dfn data-noexport="" id=associated-with-a-player>associated with a player<a class=self-link href=#associated-with-a-player></a></dfn> if it
is <a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated with a player</a> or if it has an
<a data-link-type=dfn href=#ancestor title=ancestor>ancestor</a> <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> that is <a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated
with a player</a>.
At a given moment, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> can be <a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated</a> with at most one
<a data-link-type=dfn href=#player title=player>player</a>.</p>

<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>, <var>node</var>, is <dfn data-dfn-type=dfn data-noexport="" id=associated-with-a-timeline>associated with
a timeline<a class=self-link href=#associated-with-a-timeline></a></dfn>, <var>timeline</var>, if <var>node</var> is
<a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated with a player</a> which, in turn, is associated with
<var>timeline</var>.</p>

<h4 class="heading settled heading" data-level=3.6.2 id=types-of-animation-nodes><span class=secno>3.6.2 </span><span class=content>Types of animation nodes</span><a class=self-link href=#types-of-animation-nodes></a></h4>

<p>This specification defines two types of <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation title=animations>animations</a>, and</p>
<li data-md=""><p><a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a>.</p>
</ul>
<p>All types of <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> define a number of common
properties which are described in the following sections.</p>

<h4 class="heading settled heading" data-level=3.6.3 id=the-active-interval><span class=secno>3.6.3 </span><span class=content>The active interval</span><a class=self-link href=#the-active-interval></a></h4>

<div class=informative-bg>

<p>The period that an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is scheduled to run is
called its <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
Each <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has only one such interval.</p>

<p>The lower bound of the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is determined by the
<a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of the
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> but may be shifted by a <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> on
the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>

<p>The upper bound of the interval is determined by the <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a>.</p>

<p>The relationship between the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a>, <a data-link-type=dfn href=#start-delay title="start delay">start
delay</a>, and <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> is illustrated below.</p>

<div class=figure>
<img alt="Examples of the effect of the start delay on the endpoints
        of the active interval" src=img/active-interval-examples.svg width=600>
</div>
<p class=caption>
Examples of the effect of the <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> on the endpoints of
the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.<br>
(a) An animation node with no delay; the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> and beginning of
the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> are coincident.<br>
(b) An animation node with a positive delay; the beginning of the
<a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is deferred by the delay.<br>
(c) An animation node with a negative delay; the beginning of the
<a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is brought forward by the delay.
</p>

<p>An <a data-link-type=dfn href=#end-delay title="end delay">end delay</a> may also be specified but is primarily only of
use when sequencing animations such as by using a <a data-link-type=dfn title="sequence animation group">sequence
animation group</a>.</p>

</div>

<p><a data-link-type=dfn href=#animation-node title="Animation nodes">Animation nodes</a> define an <dfn data-dfn-type=dfn data-noexport="" id=active-interval>active interval<a class=self-link href=#active-interval></a></dfn> which is
the period of time during which the node is scheduled to produce its
effect with the exception of <a data-link-type=dfn href=#fill-mode title="fill modes">fill modes</a> which apply outside the
<a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.</p>

<p>The lower bound of the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is defined by the
combination of the animation node’s 
<a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> and <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>.
An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s 
<dfn data-dfn-type=dfn data-noexport="" id=animation-node-start-time title="animation node start time">start time<a class=self-link href=#animation-node-start-time></a></dfn> is the moment at
which the <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>,
if any, has scheduled the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> to begin.
It is expressed in <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a>.
In most cases, including the case when the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has
no <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>,
the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> is zero.
The singular exception is <a data-link-type=dfn title="sequence animation groups">sequence animation groups</a> which set
the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start times</a> of their
children as described in <a data-section="" href=#the-start-time-of-children-of-an-animation-sequence>§3.13.4.1 The start time of children of an animation sequence</a>.</p>

<p>In addition to the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start
time</a>, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> also has a <dfn data-dfn-type=dfn data-noexport="" id=start-delay>start delay<a class=self-link href=#start-delay></a></dfn>
which is an offset from the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a>.
Unlike the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> which
is determined by the <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>, the <a data-link-type=dfn href=#start-delay title="start delay">start
delay</a> is a property of the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> itself.</p>

<p>The lower bound of the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a>, expressed in <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time
space</a>, is the sum of the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> and the <a data-link-type=dfn href=#start-delay title="start delay">start
delay</a>.</p>

<p>These definitions are incorporated in the calculation of the <a data-link-type=dfn href=#local-time title="local time">local
time</a> (see <a data-section="" href=#local-time-and-inherited-time>§3.6.4 Local time and inherited time</a>) 
and <a data-link-type=dfn href=#active-time title="active time">active time</a>.</p>

<p>The length of the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is called the <dfn data-dfn-type=dfn data-noexport="" id=active-duration>active
duration<a class=self-link href=#active-duration></a></dfn>, the calculation of which is defined in <a data-section="" href=#calculating-the-active-duration>§3.10.2 Calculating the active duration</a>.</p>

<p>Similar to the <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> also has
an <dfn data-dfn-type=dfn data-noexport="" id=end-delay>end delay<a class=self-link href=#end-delay></a></dfn> which may be used to delay the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of the <a data-link-type=dfn href=#next-sibling title="next sibling">next
sibling</a> in a <a data-link-type=dfn title="sequence animation group">sequence animation group</a>.</p>

<h4 class="heading settled heading" data-level=3.6.4 id=local-time-and-inherited-time><span class=secno>3.6.4 </span><span class=content>Local time and inherited time</span><a class=self-link href=#local-time-and-inherited-time></a></h4>

<div class=informative-bg>

<p>In Web Animations all times are relative to some point of reference.
These different points of reference produce different <em>time
spaces</em>.</p>

<p>This can be compared to coordinate spaces as used in computer
graphics.
The zero time of a time space is analogous to the origin of
a coordinate space.</p>

<p>Just as with coordinate spaces, time spaces can also be nested.
<a data-link-type=dfn href=#animation-group title="Animation groups">Animation groups</a> typically perform some
transformations on the <a data-link-type=dfn href=#time-value title="time values">time values</a> they
receive from their <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent</a> or
<a data-link-type=dfn href=#player title=player>player</a> before passing on the transformed <a data-link-type=dfn href=#time-value title="time values">time values</a>
to their children.
Child <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> then operate <em>within</em> that
transformed time space.</p>

<p>Children take the transformed time values from their
parent—called the <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a>— and add their
<a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> to establish
their own <a data-link-type=dfn href=#local-time title="local time">local time space</a> as illustrated
below.</p>

<div class=figure>
<img alt="Inherited time and local time." src=img/local-time.svg width=600>
</div>
<p class=caption>
Inherited time and local time.<br>
At time <var>t</var>, the <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> is 2.5.<br>
For <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> (a) which has a <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of 1, the
  <a data-link-type=dfn href=#local-time title="local time">local time</a> is 1.5.<br>
For <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> (b) which has a <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of 1
  and a <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> of 1,
  the <a data-link-type=dfn href=#local-time title="local time">local time</a> is also 1.5
  since <a data-link-type=dfn href=#local-time title="local time">local time</a> is based on an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s
  <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> only,
  and not on its <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>.
</p>

</div>

<p>For an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>, the <dfn data-dfn-type=dfn data-noexport="" id=inherited-time>inherited time<a class=self-link href=#inherited-time></a></dfn> at
a given moment is based on the first matching condition from the
following:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation
group</a>,</p>
<dd data-md=""><p>the inherited time is the <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>’s current
<a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>.</p>
<dt data-md=""><p>If the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is directly associated with
a <a data-link-type=dfn href=#player title=player>player</a>,</p>
<dd data-md=""><p>the inherited time is the <a data-link-type=dfn href=#current-time title="current time">current time</a> of the
<a data-link-type=dfn href=#player title=player>player</a>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>the inherited time is <code>null</code>.</p>
</dl>
</div>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=local-time>local time<a class=self-link href=#local-time></a></dfn> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is the
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> minus its <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a>.
If the <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> is <code>null</code> then the local time
is also <code>null</code>.</p>

<h4 class="heading settled heading" data-level=3.6.5 id=animation-node-phases-and-states><span class=secno>3.6.5 </span><span class=content>Animation node phases and states</span><a class=self-link href=#animation-node-phases-and-states></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>At a given moment, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may be in one of three
possible <em>phases</em>.
If an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has a <code>null</code> <a data-link-type=dfn href=#local-time title="local time">local
time</a> it will not be in any phase.</p>

<p>The different phases are illustrated below.</p>

<div class=figure>
<img alt="An example of the different phases and states used to
         describe an animation node." src=img/animation-node-phases-and-states.svg width=700>
</div>
<p class=caption>
An example of the different phases and states used to describe
an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.
</p>

<p>The phases are as follows:
:   <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>
::  The <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> falls before the
    node’s <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
:   <a data-link-type=dfn href=#active-phase title="active phase">active phase</a>
::  The <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> falls inside the
    node’s <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
:   <a data-link-type=dfn href=#after-phase title="after phase">after phase</a>
::  The <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> falls after the
    node’s <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.</p>

<p>In addition to these phases, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may also be
described as being in one of several overlapping <em>states</em>.
These states are only established for the duration of a single
sample and are primarily a convenience for describing stative parts
of the model.</p>

<p>These states and their useage within the model are summarised as
follows:</p>

<dl><dt data-md=""><p><a data-link-type=dfn href=#in-play title="in play">in play</a></p>
<dd data-md=""><p>Corresponds to an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> whose <a data-link-type=dfn href=#active-time title="active time">active time</a>
is changing on each sample.
This occurs when the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> <em>and all its
ancestors</em> are in the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a>.
<a data-link-type=dfn href=#animation title=Animations>Animations</a> only “move” when they are
<a data-link-type=dfn href=#in-play title="in play">in play</a>.</p>

<p>It is possible for an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> to be in the
<a data-link-type=dfn href=#active-phase title="active phase">active phase</a> but not <a data-link-type=dfn href=#in-play title="in play">in play</a>.
For example, if an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent
animation group</a> that causes the animation node’s <a data-link-type=dfn href=#active-interval title="active interval">active
interval</a> to be clipped and both parent and child apply the
same <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a>, the child <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may be
effectively be snapshotted within the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a>
despite no longer being <a data-link-type=dfn href=#in-play title="in play">in play</a>.</p>

<dt data-md=""><p><a data-link-type=dfn href=#current title=current>current</a></p>
<dd data-md=""><p>Corresponds to an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> that is either <a data-link-type=dfn href=#in-play title="in play">in
play</a> or may become <a data-link-type=dfn href=#in-play title="in play">in play</a> in the future.
This will be the case if the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is <a data-link-type=dfn href=#in-play title="in play">in
play</a> or in its <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>, <em>or</em> it has an
ancestor for which this is true thereby opening up the
possibility that this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> might play again
(e.g.  due to repeating).</p>

<p>This state is used in the <a href=#programming-interface>programming interface</a> to
identify all <a data-link-type=dfn href=#animation title=animations>animations</a> and <a data-link-type=dfn href=#player title=players>players</a> that are
likely to be of interest.</p>

<p>Furthermore, the <a data-link-type=dfn href=#current title=current>current</a> state provides an important
definition for managing the amount of memory required by
implementations.
Assuming a monotonically increasing <a data-link-type=dfn href=#timeline title=timeline>timeline</a> an
implementation can safely discard all <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a>
that are <em>not</em> <a data-link-type=dfn href=#current title=current>current</a> and not referenced
elsewhere provided they take care to preserve any fill values.
This is because such <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> will no longer have
any dynamic effect.</p>

<dt data-md=""><p><a data-link-type=dfn href=#in-effect title="in effect">in effect</a></p>
<dd data-md=""><p>Corresponds to an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> that has a resolved
<a data-link-type=dfn href=#active-time title="active time">active time</a>.
This occurs when either the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is in its
<a data-link-type=dfn href=#active-phase title="active phase">active phase</a> or outside the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> but at
a time where the node’s <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> (see <a data-section="" href=#fill-behavior>§3.7 Fill behavior</a>) causes its
<a data-link-type=dfn href=#active-time title="active time">active time</a> to be resolved.
Only <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> <a data-link-type=dfn href=#animation title=animations>animations</a> apply a result to
their target.</p>
</dl>
<p>The normative definition of each of these states follows.</p>

</div>

<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is in the <dfn data-dfn-type=dfn data-noexport="" id=before-phase>before phase<a class=self-link href=#before-phase></a></dfn> if the
animation node’s <a data-link-type=dfn href=#local-time title="local time">local time</a> is not <code>null</code> and is
less than the node’s <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>.</p>

<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is in the <dfn data-dfn-type=dfn data-noexport="" id=active-phase>active phase<a class=self-link href=#active-phase></a></dfn> if
<em>all</em> of the following conditions are met:</p>

<ol><li data-md=""><p>the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> is not
<code>null</code>, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> is <em>greater than
or equal</em> to its <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#local-time title="local time">local time</a> is <em>less
than</em> the sum of its <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> and <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a>.</p>
</ol>
<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is in the <dfn data-dfn-type=dfn data-noexport="" id=after-phase>after phase<a class=self-link href=#after-phase></a></dfn> if the
animation node’s <a data-link-type=dfn href=#local-time title="local time">local time</a> is not <code>null</code> and is
<em>greater than or equal</em> to the sum of its <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>
and <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>.</p>

<p>An <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is <dfn data-dfn-type=dfn data-noexport="" id=in-play>in play<a class=self-link href=#in-play></a></dfn> if <em>all</em>
of the following conditions are met:</p>

<ol><li data-md=""><p>the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is in the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a>, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> that
is <a data-link-type=dfn href=#in-play title="in play">in play</a> or else is <a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated with
a player</a> that is not <a data-link-type=dfn href=#limited title=limited>limited</a>.</p>
</ol>
<p>An animation node is <dfn data-dfn-type=dfn data-noexport="" id=current>current<a class=self-link href=#current></a></dfn> if it <em>any</em> of the
following conditions is true:</p>

<ul><li data-md=""><p>it is in the <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>, or</p>
<li data-md=""><p>it is <a data-link-type=dfn href=#in-play title="in play">in play</a>, or</p>
<li data-md=""><p>it has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> and the
<a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> is <a data-link-type=dfn href=#current title=current>current</a>.</p>
</ul>
<p>An animation node is <dfn data-dfn-type=dfn data-noexport="" id=in-effect>in effect<a class=self-link href=#in-effect></a></dfn> if its <a data-link-type=dfn href=#active-time title="active time">active time</a> as
calculated according to the procedure in <a data-section="" href=#calculating-the-active-time>§3.10.3.1 Calculating the active time</a> is not
<code>null</code>.</p>

<h3 class="heading settled heading" data-level=3.7 id=fill-behavior><span class=secno>3.7 </span><span class=content>Fill behavior</span><a class=self-link href=#fill-behavior></a></h3>

<p>The effect of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> when it is not <a data-link-type=dfn href=#in-play title="in play">in play</a> is
determined by its <dfn data-dfn-type=dfn data-noexport="" id=fill-mode>fill mode<a class=self-link href=#fill-mode></a></dfn>.</p>

<p>The possible <a data-link-type=dfn href=#fill-mode title="fill modes">fill modes</a> are:</p>

<ul><li data-md=""><p>none,</p>
<li data-md=""><p>forwards,</p>
<li data-md=""><p>backwards, and</p>
<li data-md=""><p>both.</p>
</ul>
<p>The normative definition of these modes is incorporated in the
calculation of the <a data-link-type=dfn href=#active-time title="active time">active time</a> in <a data-section="" href=#calculating-the-active-time>§3.10.3.1 Calculating the active time</a>.</p>

<h4 class="heading settled heading" data-level=3.7.1 id=fill-modes><span class=secno>3.7.1 </span><span class=content>Fill modes</span><a class=self-link href=#fill-modes></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>The effect of each <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> is as follows:</p>

<dl><dt data-md=""><p>none</p>
<dd data-md=""><p>The animation node has no effect when it is not <a data-link-type=dfn href=#in-play title="in play">in play</a>.</p>
<dt data-md=""><p>forwards</dt><p></p>
<dd data-md=""><p>When the animation node is in the <a data-link-type=dfn href=#after-phase title="after phase">after phase</a>,
or when the animation node is in the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a> but an
<a data-link-type=dfn href=#ancestor title=ancestor>ancestor</a> is in its <a data-link-type=dfn href=#after-phase title="after phase">after phase</a>,
the animation node will produce the same <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time value</a> as the last
moment it is scheduled to be <a data-link-type=dfn href=#in-play title="in play">in play</a>.</p>

<p>For all other times that the animation node is not <a data-link-type=dfn href=#in-play title="in play">in play</a>,
it will have no effect.</p>
<dt data-md=""><p>backwards</p>
<dd data-md=""><p>When the animation node is in the <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>,
or when the animation node is in the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a> but an
<a data-link-type=dfn href=#ancestor title=ancestor>ancestor</a> is in its <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>,
the animation node will produce the same <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time value</a> as the earliest
moment that it is scheduled to be <a data-link-type=dfn href=#in-play title="in play">in play</a>.</p>

<p>For all other times that the animation node is not <a data-link-type=dfn href=#in-play title="in play">in play</a>,
it will have no effect.</p>
<dt data-md=""><p>both</dt><p></p>
<dd data-md=""><p>When the animation node or an <a data-link-type=dfn href=#ancestor title=ancestor>ancestor</a> is in its <a data-link-type=dfn href=#before-phase title="before phase">before
phase</a>, <span class=prop-value>backwards</span> fill behavior
is used.</p>

<p>When the animation node or an <a data-link-type=dfn href=#ancestor title=ancestor>ancestor</a> is in its <a data-link-type=dfn href=#after-phase title="after phase">after
phase</a>, <span class=prop-value>forwards</span> fill behavior is
used.</p>
</dl>
<p>Some examples of the these fill modes are illustrated below.</p>

<div class=figure>
  <img alt="Examples of various fill modes and the states produced." src=img/animation-state-and-fill-behavior.svg width=600>
</div>
<p class=caption>
  Examples of various fill modes and the states produced.<br>
  (a) fill mode ‘none’. The animation node has no effect
      outside its active interval.<br>
  (b) fill mode ‘forwards’. After the active interval has
      finished, the timed value continues to maintain a fill value.<br>
  (c) fill mode ‘backwards’. The animation node produces
      a fill value until the start of the active interval.<br>
  (d) fill mode ‘both’. Both before and after the active
      interval the animation node produces a fill value.
</p> 

<p class=note>Note: setting a fill mode has no bearing on the endpoints of the
    <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
    However, the fill mode <em>does</em> have an effect on various other
    properties of the timing model since the <a data-link-type=dfn href=#active-time title="active time">active time</a> of an
    animation node is only defined (that is, not <code>null</code>) inside
    the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> <em>or</em> when a fill is applied.</p>

<div class=issue id=issue-e084f67b><a class=self-link href=#issue-e084f67b></a>
Currently <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> that generate results outside the
range [0, 1] will behave unexpectedly when applied to animation
groups, as children will increase iterations or enter into fill mode
rather than continuing to extrapolate along their defined behavior
(which is what they would do if the timing function applied to them
directly).

<p>To fix this it is possible we will wish to introduce <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-overflow-3/#overflow0 title=overflow>overflow</a> fill
modes that respond to time values larger than or smaller than the
active time range by extrapolating rather than filling.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html>section
15 (Overflowing fill) of minuted discussion from Tokyo 2013 F2F</a>.
</div><p></p>

</div>

<h3 class="heading settled heading" data-level=3.8 id=repeating><span class=secno>3.8 </span><span class=content>Repeating</span><a class=self-link href=#repeating></a></h3>

<h4 class="heading settled heading" data-level=3.8.1 id=iteration-intervals><span class=secno>3.8.1 </span><span class=content>Iteration intervals</span><a class=self-link href=#iteration-intervals></a></h4>

<p>It is possible to specify that an animation node should repeat
a fixed number of times or indefinitely.
This repetition occurs <em>within</em> the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
The span of time during which a single repetition takes place is
called an <dfn data-dfn-type=dfn data-noexport="" id=iteration-interval>iteration interval<a class=self-link href=#iteration-interval></a></dfn>.</p>

<p>Unlike the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>, an animation node can have multiple
<a data-link-type=dfn href=#iteration-interval title="iteration intervals">iteration intervals</a> although typically only the interval
corresponding to the <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a> is of interest.</p>

<p>The length of a single iteration is called the <dfn data-dfn-type=dfn data-noexport="" id=iteration-duration>iteration
duration<a class=self-link href=#iteration-duration></a></dfn>.
The initial <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> of an animation node is simply
its <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=intrinsic-iteration-duration>intrinsic iteration duration<a class=self-link href=#intrinsic-iteration-duration></a></dfn> of an animation node is
zero, however some specific types of animation node such as
<a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> override this behavior and provide an
alternative intrinsic duration (see <a data-section="" href=#the-intrinsic-iteration-duration-of-an-animation-group>§3.13.3 The intrinsic iteration duration of an animation group</a> and <a data-section="" href=#the-intrinsic-iteration-duration-of-an-animation-sequence>§3.13.4.2 The intrinsic iteration duration of an animation sequence</a>).</p>

<p>The <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may be set
by the author to represent a value other than the <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic
iteration duration</a>.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>Comparing the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> and the <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a> we have:</p>

<dl><dt data-md=""><p>Iteration duration</p>
<dd data-md=""><p>The time taken for a single iteration of the animation node to
complete.</p>
<dt data-md=""><p>Active duration</p>
<dd data-md=""><p>The time taken for the entire animation node to complete,
including repetitions.
This may be longer or shorter than the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>.</p>
</dl>
<p>The relationship between the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> and <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a> is illustrated below.</p>

<div class=figure>
  <img alt="Comparison of the iteration duration and active time." src=img/iteration-intervals.svg width=600>
</div>
<p class=caption>
  A comparison of the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> and <a data-link-type=dfn href=#active-duration title="active duration">active
  duration</a> of an animation node with an <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> of
  2.5.
  Note that the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> for the final iteration does
  not change, it is simply cut-off by the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>.
</p>

</div>

<h4 class="heading settled heading" data-level=3.8.2 id=controlling-iteration><span class=secno>3.8.2 </span><span class=content>Controlling iteration</span><a class=self-link href=#controlling-iteration></a></h4>

<p>The number of times an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> repeats is called its
<dfn data-dfn-type=dfn data-noexport="" id=iteration-count>iteration count<a class=self-link href=#iteration-count></a></dfn>.
The <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> is a real number greater than or equal to
zero.
The <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> may also be positive infinity to represent
that the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> repeats indefinitely.</p>

<p>In addition to the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a>, <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> also
have an <dfn data-dfn-type=dfn data-noexport="" id=iteration-start>iteration start<a class=self-link href=#iteration-start></a></dfn> property which specifies an offset
into the series of iterations at which the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>
should begin.
The <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> is a finite real number greater than or
equal to zero.</p>

<p>The behavior of these parameters is defined in the calculations in <a data-section="" href=#core-animation-node-calculations>§3.10 Core animation node calculations</a>.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>The effect of the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> and <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a>
parameters is illustrated below.</p>

<div class=figure>
  <img alt="The effect of the iteration count and iteration start parameters" src=img/iteration-count-and-start.svg width=600>
</div>
<p class=caption>
  The effect of the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> and <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a>
  parameters.<br>
  In the first case the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> is 2.5 resulting in the
  third iteration being cut-off half way through its <a data-link-type=dfn href=#iteration-interval title="iteration interval">iteration
  interval</a>.<br>
  The second case is the same but with an <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> of
  0.5.
  This causes the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> to begin half way through the
  first iteration.
</p>

<p>Unlike the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> parameter, the <a data-link-type=dfn href=#iteration-start title="iteration start">iteration
start</a> parameter does not effect the length of the <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a>.</p>

<p>Note that values of <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> greater than or equal to
one are generally not useful unless used in combination with an
<a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> that has an <a data-link-type=dfn href=#iteration-composite-operation title="iteration composite operation">iteration composite
operation</a> of 
<a data-link-type=dfn href=#iteration-composite-operation-accumulate title="iteration composite operation accumulate">accumulate</a>.</p>

</div>

<h4 class="heading settled heading" data-level=3.8.3 id=iteration-time-space><span class=secno>3.8.3 </span><span class=content>Iteration time space</span><a class=self-link href=#iteration-time-space></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>We have already encountered different time spaces in describing
<a data-link-type=dfn href=#local-time title="local time">local time</a> and <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> (see <a data-section="" href=#local-time-and-inherited-time>§3.6.4 Local time and inherited time</a>).
Repetition introduces yet another time space: the iteration time
space.</p>


<p><em>Iteration time space</em> is a time space whose zero time is the
beginning of an animation node’s current iteration.</p>


<p>Within the Web Animations model we also refer to <a data-link-type=dfn href=#active-time title="active time">active
time</a> which is a time relative to the beginning of the active
interval.
This time space, however, is internal to the model and not exposed in
the programming interface or in markup.</p>


<p>These time spaces are illustrated below.</p>

<div class=figure>
  <img alt="A comparison of local time, active time, and iteration time." src=img/time-spaces.svg width=600>
</div>
<p class=caption>
A comparison of local time, active time, and iteration time for an
animation with a iteration duration of 1s and an iteration count of
2.5.
</p>

<p class=note>Note: While the time spaces themselves are not bounded, Web
    Animations defines <a data-link-type=dfn href=#active-time title="active time">active time</a> and <a data-link-type=dfn href=#iteration-time title="iteration time">iteration
    time</a> such that they are clamped to a set range as shown in the
    diagram.
    For example, whilst a time of -1 second is a valid time in
    <em>active time space</em>, the procedure for calculating the
    <a data-link-type=dfn href=#active-time title="active time">active time</a> defined in <a data-section="" href=#calculating-the-active-time>§3.10.3.1 Calculating the active time</a> will
    never return a negative value.</p>

<p>In addition to these time spaces we can also refer to the
<em>document time space</em> which is time space of the <a data-link-type=dfn href=#time-value title="time values">time
values</a> of the <a data-link-type=dfn href=#document-timeline title="document timeline">document timeline</a> of the <a href=http://www.w3.org/TR/html5/browsers.html#active-document>active
document</a>.</p>

</div>

<h4 class="heading settled heading" data-level=3.8.4 id=interval-timing><span class=secno>3.8.4 </span><span class=content>Interval timing</span><a class=self-link href=#interval-timing></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>When an animation node repeats we must define the behavior at the
iteration boundaries.
For this and indeed for all interval-timing, Web Animations uses an
endpoint-exclusive timing model.
This means that whilst the begin time of an interval
is included in the interval, the end time time is not.
In interval notation this can written <code>[begin, end)</code>.
This model provides sensible behavior when intervals are repeated and
sequenced since there is no overlap between the intervals.</p>


<p>In the examples below, for the repeated node, at local time 1s,
the iteration time is 0.
For the sequenced nodes, at inherited time 1s, only node B will be
<a data-link-type=dfn href=#in-play title="in play">in play</a>; there is no overlap.</p>

<div class=figure>
  <img alt="Illustration of end-point exclusive timing." src=img/endpoint-exclusive-timing.svg width=600>
</div>
<p class=caption>
  Illustration of end-point exclusive timing. For both repeated and
  sequenced animation nodes there is no overlap at the boundaries
  between intervals.
</p>

<p>An exception to this behavior is that when performing a <a href=#fill-behavior>fill</a>, if the fill begins at an
interval endpoint, the endpoint is used.
This behavior falls out of the algorithm given in <a data-section="" href=#calculating-the-iteration-time>§3.10.3.3 Calculating the iteration time</a> and is illustrated below.</p>

<div class=figure>
  <img alt="Effect of iterations and fill on iteration time." src=img/endpoint-exclusive-timing-and-fill.svg width=600>
</div>
<p class=caption>
  After one iteration, the iteration time is 0, but after two iterations
  (and thereonwards), the iteration time is equal to the iteration
  duration due to the special behavior defined when an animation node
  fills.
</p>

</div>

<h3 class="heading settled heading" data-level=3.9 id=animation-node-speed-control><span class=secno>3.9 </span><span class=content>Animation node speed control</span><a class=self-link href=#animation-node-speed-control></a></h3>

<p>Like <a data-link-type=dfn href=#player title=players>players</a>, <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> also have a <dfn data-dfn-type=dfn data-noexport="" id=animation-node-playback-rate title="animation node playback rate">playback rate<a class=self-link href=#animation-node-playback-rate></a></dfn> parameter.
The <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> of
an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is a finite real number that acts as
a multiplier when calculating the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#transformed-time title="transformed time">transformed
time</a> from its <a data-link-type=dfn href=#local-time title="local time">local time</a>.</p>

<p>The effect of setting the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> differs from the
setting the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> on
a player.  Its behavior is defined in the timing calculations given in
<a data-section="" href=#core-animation-node-calculations>§3.10 Core animation node calculations</a>.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>In summary, the behavior of the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is as follows:</p>

<ul><li data-md=""><p>The <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> is
applied only to the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> and not to the time while it is <a data-link-type=dfn href=#start-delay title="start delay">delayed</a> or <a data-link-type=dfn href=#fill-mode title="fill mode">filling</a>.</p>

<li data-md=""><p>Setting a negative <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> on an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> causes the <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> to begin at the end of its <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
This differs from the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback
rate</a> on a <a data-link-type=dfn href=#player title=player>player</a>.
Setting a <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> on
a <a data-link-type=dfn href=#player title=player>player</a> to a negative value at a moment before the
<a data-link-type=dfn href=#player title=player>player</a>’s source content has begun, will result in the
<a data-link-type=dfn href=#source-content title="source content">source content</a> never playing.</p>

<li data-md=""><p>Setting the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> affects the calculated value of
the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> (see <a data-section="" href=#calculating-the-active-duration>§3.10.2 Calculating the active duration</a>).</p>

<li data-md=""><p>Changing the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> whose <a data-link-type=dfn href=#local-time title="local time">local time</a> is
within its <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> will cause it to jump.
This is because the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> will be updated but the
<a data-link-type=dfn href=#local-time title="local time">local time</a> will not.</p>

<p>Furthermore, if other <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> depend on the
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>, such as sibling
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> in a <a data-link-type=dfn title="sequence animation group">sequence animation group</a>, they
too may jump as a result of setting the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a>.</p>

<p>For runtime speed control the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> of the
<a data-link-type=dfn href=#player title=player>player</a> should be used.</p>
</ul>
</div>

<h3 class="heading settled heading" data-level=3.10 id=core-animation-node-calculations><span class=secno>3.10 </span><span class=content>Core animation node calculations</span><a class=self-link href=#core-animation-node-calculations></a></h3>

<h4 class="heading settled heading" data-level=3.10.1 id=overview><span class=secno>3.10.1 </span><span class=content>Overview</span><a class=self-link href=#overview></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>At the core of the Web Animations timing model is the process that
takes an <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> value and converts it to an
<a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a>.</p>


<p>Following this further transformations are applied before resulting at
a final <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>.</p>


<p>The first step in this process is to calculate the bounds of the
<a data-link-type=dfn href=#active-interval title="active interval">active interval</a> which is determined by the <a data-link-type=dfn href=#active-duration title="active duration">active
duration</a>.</p>

<p>This process is illustrated below.</p>

<div class=figure>
  <img alt="Calculation of the active duration." src=img/active-duration-calculation.svg width=650>
</div>
<p class=caption>
  Calculation of the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> is based on
  multiplying the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> by the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration
  count</a> and then dividing by the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a>.
</p>
<p>
  The process for calculating the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> is normatively
  defined in <a data-section="" href=#calculating-the-active-duration>§3.10.2 Calculating the active duration</a>.
</p>
<p>
  Having established the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>, the process for
  transforming an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> into its
  <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> is illustrated below.
</p>
<div class=figure>
  <img alt="An overview of timing model calculations." src=img/time-calculations.svg width=650>
</div>
<p class=caption>
  An overview of timing model calculations.<br>
  (1) The <a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> is converted into a <a data-link-type=dfn href=#local-time title="local time">local time</a> by
  incorporating the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start
  time</a>.<br>
  (2) The <a data-link-type=dfn href=#local-time title="local time">local time</a> is converted into an <a data-link-type=dfn href=#active-time title="active time">active time</a> by
  incorporating the <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>.<br>
  (3) The <a data-link-type=dfn title="playback rate">playback rate</a> and <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> properties are
  applied to the <a data-link-type=dfn href=#active-time title="active time">active time</a> to produce the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active
  time</a>.<br>
  (4) The <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> is then converted to an offset
  within a single iteration: the <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a>.<br>
  (5) The <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a> is converted into a <a data-link-type=dfn href=#directed-time title="directed time">directed time</a>
  by incorporating the <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a>.<br>
  (6) Finally, a timing function is applied to the <a data-link-type=dfn href=#directed-time title="directed time">directed
  time</a> to produce the <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>.
</p>

<p>The first step, calculating the <a data-link-type=dfn href=#local-time title="local time">local time</a> is described in <a data-section="" href=#local-time-and-inherited-time>§3.6.4 Local time and inherited time</a>.
Steps 2 to 4 in the diagram are described in the following sections.
Steps 5 and 6 are described in
<a data-section="" href=#calculating-the-directed-time>§3.11.1 Calculating the directed time</a>
and
<a data-section="" href=#calculating-the-transformed-time>§3.12.5 Calculating the transformed time</a>
respectively.</p>

</div>


<h4 class="heading settled heading" data-level=3.10.2 id=calculating-the-active-duration><span class=secno>3.10.2 </span><span class=content>Calculating the active duration</span><a class=self-link href=#calculating-the-active-duration></a></h4>

<p>In order to calculate the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> we first define the
<a data-link-type=dfn href=#repeated-duration title="repeated duration">repeated duration</a> as follows:</p>

<blockquote>
  <dfn data-dfn-type=dfn data-noexport="" id=repeated-duration>repeated duration<a class=self-link href=#repeated-duration></a></dfn> =
    <code><a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> ×
          <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a></code>
    <p>
      If either the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> or <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a>
      are zero, the <a data-link-type=dfn href=#repeated-duration title="repeated duration">repeated duration</a> is zero.
    </p>
    <p class=note>
      This clarification is needed since the result of infinity
      multiplied by zero is undefined according to IEEE 754-2008.
    </p>
</blockquote>

<p>The <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> is calculated according to the following
steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> is
  zero, return <code>Infinity</code>.</p>
<li data-md=""><p>Otherwise, return <code><a data-link-type=dfn href=#repeated-duration title="repeated duration">repeated duration</a> / abs(<a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a>)</code>.</p>
</ol>
<h4 class="heading settled heading" data-level=3.10.3 id=transforming-the-local-time><span class=secno>3.10.3 </span><span class=content>Transforming the local time</span><a class=self-link href=#transforming-the-local-time></a></h4>

<h5 class="heading settled heading" data-level=3.10.3.1 id=calculating-the-active-time><span class=secno>3.10.3.1 </span><span class=content>Calculating the active time</span><a class=self-link href=#calculating-the-active-time></a></h5>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=active-time>active time<a class=self-link href=#active-time></a></dfn> is based on the <a data-link-type=dfn href=#local-time title="local time">local time</a>
and <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>.
However, it is only defined when the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> should
produce an output and hence depends on its <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> and
phase as well as the phase of its <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>, if
any, as follows,</p>

<div class=switch>

<dl><dt data-md=""><p>If the animation node is in the <a data-link-type=dfn href=#before-phase title="before phase">before phase</a>,</p>
<dd data-md=""><p>The result depends on the first matching condition from the
following,</p>

<div class=switch>

<dl><dt data-md=""><p>If the animation node has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
and that parent animation group is in the <a data-link-type=dfn href=#after-phase title="after phase">after
phase</a>,</p>
<dd data-md=""><p>Return <code>null</code>.</p>
<dt data-md=""><p>If the <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> is <span class=prop-mode>backwards</span> or <span class=prop-mode>both</span>,</p>
<dd data-md=""><p>Return zero.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return <code>null</code>.</p>
</dl>
</div>

<dt data-md=""><p>If the animation node is in the <a data-link-type=dfn href=#active-phase title="active phase">active phase</a>,</p>
<dd data-md=""><p>The result depends on the first matching condition from the
following,</p>

<div class=switch>

<dl><dt data-md=""><p>If the animation node has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
and that parent animation group is in the <a data-link-type=dfn href=#before-phase title="before phase">before
phase</a>, and the <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> of this animation node
is <span class=prop-value>none</span> or <span class=prop-value>forwards,</span></p>
<dd data-md=""><p>Return <code>null</code>.</p>
<dt data-md=""><p>If the animation node has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
and that parent animation group is in the <a data-link-type=dfn href=#after-phase title="after phase">after
phase</a>, and the <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> of this animation node
is <span class=prop-value>none</span> or <span class=prop-value>backwards,</span></p>
<dd data-md=""><p>Return <code>null</code>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return <code><a data-link-type=dfn href=#local-time title="local time">local time</a> - <a data-link-type=dfn href=#start-delay title="start delay">start delay</a></code>.</p>
</dl>
</div>

<dt data-md=""><p>If the animation node is in the <a data-link-type=dfn href=#after-phase title="after phase">after phase</a>,</p>
<dd data-md=""><p>The result depends on the first matching condition from the
following,</p>

<div class=switch>

<dl><dt data-md=""><p>If the animation node has a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
and that parent animation group is in the <a data-link-type=dfn href=#before-phase title="before phase">before
phase</a>,</p>
<dd data-md=""><p>Return <code>null</code>.</p>
<dt data-md=""><p>If the <a data-link-type=dfn href=#fill-mode title="fill mode">fill mode</a> is <span class=prop-mode>forwards</span> or <span class=prop-mode>both</span>,</p>
<dd data-md=""><p>Return the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return <code>null</code>.</p>
</dl>
</div>

<dt data-md=""><p>Otherwise (the <a data-link-type=dfn href=#local-time title="local time">local time</a> is <code>null</code>),</p>
<dd data-md=""><p>Return <code>null</code>.</p>
</dl>
</div>

<h5 class="heading settled heading" data-level=3.10.3.2 id=calculating-the-scaled-active-time><span class=secno>3.10.3.2 </span><span class=content>Calculating the scaled active time</span><a class=self-link href=#calculating-the-scaled-active-time></a></h5>

<p>Before the <a data-link-type=dfn href=#active-time title="active time">active time</a> can be converted to an <a data-link-type=dfn href=#iteration-time title="iteration time">iteration
time</a> we must factor in the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> and
<a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a>.
The result is called the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a>.</p>

<p>In order to calculate the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> we first
define the <a data-link-type=dfn href=#start-offset title="start offset">start offset</a> as follows:</p>

<blockquote>
  <dfn data-dfn-type=dfn data-noexport="" id=start-offset>start offset<a class=self-link href=#start-offset></a></dfn> =
    <code><a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> ×
          <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a></code>

<p>If the <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> is zero, the <a data-link-type=dfn href=#start-offset title="start offset">start offset</a>
  is zero.</p>

<p class=note>Note: This clarification is needed since the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>
      may be infinity and the result of infinity multiplied by zero is
      undefined according to IEEE 754-2008.</p>

</blockquote>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=scaled-active-time>scaled active time<a class=self-link href=#scaled-active-time></a></dfn> is calculated according to
the following steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#active-time title="active time">active time</a> is <code>null</code>, return
<code>null</code>.</p>

<li data-md=""><p>Return the scaled active time based on the
<a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback rate</a> as
follows,</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> is less than zero,</p>
<dd data-md=""><p>Return <code>(<a data-link-type=dfn href=#active-time title="active time">active time</a> -
            <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>)
× <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a>
+ <a data-link-type=dfn href=#start-offset title="start offset">start offset</a></code>.</p>

<dt data-md=""><p>If the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> is zero,</p>
<dd data-md=""><p>Return <a data-link-type=dfn href=#start-offset title="start offset">start offset</a>.</p>

<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return <code><a data-link-type=dfn href=#active-time title="active time">active time</a>
× <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> + <a data-link-type=dfn href=#start-offset title="start offset">start offset</a></code>.</p>
</dl>
</div>
</ol>
<h5 class="heading settled heading" data-level=3.10.3.3 id=calculating-the-iteration-time><span class=secno>3.10.3.3 </span><span class=content>Calculating the iteration time</span><a class=self-link href=#calculating-the-iteration-time></a></h5>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=iteration-time>iteration time<a class=self-link href=#iteration-time></a></dfn> is calculated according to the
following steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> is <code>null</code>,
return <code>null</code>.</p>

<li data-md=""><p>If the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is zero, return zero.</p>

<li data-md=""><p>If <code><a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> - <a data-link-type=dfn href=#start-offset title="start offset">start
offset</a></code> is equal to the <a data-link-type=dfn href=#repeated-duration title="repeated duration">repeated duration</a>,
and <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> is not zero,
and <code>(<a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> + <a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a>)
% 1</code> is zero,
return the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>.</p>

<li data-md=""><p>Otherwise, return <code><a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a>
% <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a></code>.</p>
</ol>
<h4 class="heading settled heading" data-level=3.10.4 id=calculating-the-current-iteration><span class=secno>3.10.4 </span><span class=content>Calculating the current iteration</span><a class=self-link href=#calculating-the-current-iteration></a></h4>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=current-iteration>current iteration<a class=self-link href=#current-iteration></a></dfn> can be calculated using the
following steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> is <code>null</code>, return
<code>null</code>.</p>

<li data-md=""><p>If the <a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> is zero, return zero.</p>

<li data-md=""><p>If the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is zero, return
<code>ceil(<a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a> + <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a>) -
1</code>.</p>

<li data-md=""><p>If the <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a> equals the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration
duration</a>, return <code><a data-link-type=dfn href=#iteration-start title="iteration start">iteration start</a>
+ <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> - 1</code>.</p>

<li data-md=""><p>Return <code>floor(<a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> /
<a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>)</code>.
<p class=note>
  If the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is infinite, the
  result of <code>floor(<a data-link-type=dfn href=#scaled-active-time title="scaled active time">scaled active time</a> /
  <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>)</code> will be zero as defined by
  IEEE 754-2008.</p>
</ol>
<h3 class="heading settled heading" data-level=3.11 id=direction-control><span class=secno>3.11 </span><span class=content>Direction control</span><a class=self-link href=#direction-control></a></h3>

<p><a data-link-type=dfn href=#animation-node title="Animation nodes">Animation nodes</a> may also be configured to run iterations in
alternative directions using direction control.
For this purpose, <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> have a <dfn data-dfn-type=dfn data-noexport="" id=playback-direction>playback
direction<a class=self-link href=#playback-direction></a></dfn> parameter which takes one of the following values:</p>

<ul><li data-md=""><p>normal,</p>
<li data-md=""><p>reverse,</p>
<li data-md=""><p>alternate, or</p>
<li data-md=""><p>alternate-reverse.</p>
</ul>
<p>The semantics of these values are incorporated into the calculation of
the <a data-link-type=dfn href=#directed-time title="directed time">directed time</a> which follows.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>A non-normative definition of these values is as follows:</p>

<dl><dt data-md=""><p>normal</p>
<dd data-md=""><p>All iterations are played as specified.</p>

<dt data-md=""><p>reverse</p>
<dd data-md=""><p>All iterations are played in the reverse direction from the way
they are specified.</p>

<dt data-md=""><p>alternate</p>
<dd data-md=""><p>Even iterations are played as specified, odd iterations are played
in the reverse direction from the way they are specified.</p>

<dt data-md=""><p>alternate-reverse</p>
<dd data-md=""><p>Even iterations are played in the reverse direction from the way
they are specified, odd iterations are played as specified.</p>
</dl>
</div>

<h4 class="heading settled heading" data-level=3.11.1 id=calculating-the-directed-time><span class=secno>3.11.1 </span><span class=content>Calculating the directed time</span><a class=self-link href=#calculating-the-directed-time></a></h4>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=directed-time>directed time<a class=self-link href=#directed-time></a></dfn> is calculated from the <a data-link-type=dfn href=#iteration-time title="iteration time">iteration
  time</a> using the following steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a> is <code>null</code>, return
<code>null</code>.</p>

<li data-md=""><p>Calculate the <var>current direction</var> using the first
matching condition from the following list:
<div class=switch><p></p>

<dl><dt data-md=""><p>If <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a> is <code>normal</code>,</p>
<dd data-md=""><p>Let the <var>current direction</var> be forwards.</p>

<dt data-md=""><p>If <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a> is <code>reverse</code>,</p>
<dd data-md=""><p>Let the <var>current direction</var> be reverse.</p>

<dt data-md=""><p>Otherwise,</p>
<dd data-md="">

<ol><li data-md=""><p>Let <var>d</var> be the <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a>.</p>

<li data-md=""><p>If <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a> is
  <code>alternate-reverse</code> increment
  <var>d</var> by 1.</p>

<li data-md=""><p class=issue id=issue-eb1151df><a class=self-link href=#issue-eb1151df></a>There used to be a step here which seemed to be adding
  special handling for filling when the node ends on
  a repeat boundary but it seems like that is taken care
  of by the calcuation of <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a> and
  <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a>.
  Is anything actually needed here?</p>

<li data-md=""><p>If <code><var>d</var> % 2 == 0</code>, let the
  <var>current direction</var> be forwards, otherwise let
  the <var>current direction</var> be reverse.</p>
</ol></dl>
</div>

<li data-md=""><p>If the <var>current direction</var> is forwards then return
the <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a>.</p>

<p>Otherwise, return the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>
- <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a>.</p>
</ol>
<h3 class="heading settled heading" data-level=3.12 id=time-transformations><span class=secno>3.12 </span><span class=content>Time transformations</span><a class=self-link href=#time-transformations></a></h3>

<h4 class="heading settled heading" data-level=3.12.1 id=scaling-the-time><span class=secno>3.12.1 </span><span class=content>Scaling the time</span><a class=self-link href=#scaling-the-time></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>It is often desirable to control the rate at which an <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> progresses.
For example, easing the rate of animation can create a sense of
momentum and produce a more natural effect.
Conversely, in other situations such as when modelling a discrete
change, a smooth transition is undesirable and instead it is necessary
for the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> to progress in a series of distinct
steps.</p>

<p>For such situations Web Animations provides <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a>
that scale the progress of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>

<p><a data-link-type=dfn href=#timing-function title="Timing functions">Timing functions</a> take an input time fraction and produce
a scaled output time fraction.</p>

<div class=figure>
  <img alt="Example of a timing function that produces an ease-in effect." src=img/timing-function-example.svg width=350>
</div>
<p class=caption>
  Example of a timing function that produces an ease-in effect.
  Given an input timing fraction of 0.7, the timing function scales the
  value to produce an output time fraction of 0.52.<br>
  By applying this timing function, time will appear to progress more
  slowly at first but then gradually progress more quickly.
</p>

<p><a data-link-type=dfn href=#timing-function title="Timing functions">Timing functions</a> are applied to an iteration of an <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a>.</p>

</div>

<h4 class="heading settled heading" data-level=3.12.2 id=timing-functions><span class=secno>3.12.2 </span><span class=content>Timing functions</span><a class=self-link href=#timing-functions></a></h4>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=timing-function>timing function<a class=self-link href=#timing-function></a></dfn> takes an input time fraction in the range
[0, 1] and produces an output time fraction whose range is unbounded
(i.e. positive and negative infinity are permitted).</p>

<p><a data-link-type=dfn href=#animation-node title="Animation nodes">Animation nodes</a> have one <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> associated with
them.
The default <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> is the <dfn data-dfn-type=dfn data-noexport="" id=linear-timing-function>linear timing
function<a class=self-link href=#linear-timing-function></a></dfn> whose output is identical to its input.
The <a data-link-type=dfn href=#linear-timing-function title="linear timing function">linear timing function</a> can be represented by the string
“linear”.</p>

<p>The range of timing functions that may be applied to a given
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> depends on the type of the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>

<div class=issue id=issue-058d14db><a class=self-link href=#issue-058d14db></a>
Currently, the set of <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> allowed on
an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> is not restricted.
This has raised concern about complexity of implementation and also
complexity of behavior with regards to fill modes.
As a result, allowing the full set of timing functions on animation
groups is considered <strong>at risk</strong>.

<p>Alternatives are to either restrict timing functions on animation
groups to the <a data-link-type=dfn href=#linear-timing-function title="linear timing function">linear timing function</a> or to a set of
“simple” timing functions that have properties that
alleviate some of the concerns with the more complex timing
functions.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013JulSep/0076.html>section
2 of the discussion from August 2013</a>.
</div><p></p>

<h4 class="heading settled heading" data-level=3.12.3 id=scaling-using-a-cubic-bxxxzier-curve><span class=secno>3.12.3 </span><span class=content>Scaling using a cubic BXXXzier curve</span><a class=self-link href=#scaling-using-a-cubic-bxxxzier-curve></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>A common method of producing easing effects is to use a cubic BXXXier
curve to scale the time.
The endpoints of the curve are fixed at (0, 0) and (1, 1) while two
control points <var>P1</var> and <var>P2</var> define the shape of
the curve.
Provided the <var>x</var> values of <var>P1</var> and <var>P2</var>
lie within the range [0, 1] such a curve produces a function that is
used to map input times (the <var>x</var> values) onto output times
(the <var>y</var> values).
This arrangement is illustrated below.</p>

<div class=figure>
  <img alt="A cubic Bezier curve used as a timing function." src=img/cubic-bezier-timing-curve.svg width=500>
</div>
<p class=caption>
  A cubic BXXXier curve used as a timing function.<br>
  The shape of the curve is determined by the location of the control
  points <var>P1</var> and <var>P2</var>.<br>
  Input time fractions serve as <var>x</var> values of the curve,
  whilst the <var>y</var> values are the output time fractions.
</p>

<p>Some example cubic BXXXzier timing functions are illustrated below.</p>

<div class=figure>
  <img alt="The timing functions produced by keyword values." src=img/curve-keywords.svg width=500>
</div>
<p class=caption>
  The timing functions produced by each of the keyword values
  associated with cubic BXXXier timing functions accepted by the
  <a class=idlType href=#widl-AnimationTiming-easing><code>AnimationTiming.easing</code></a>
  member from the <a href=#programming-interface>programming
  interface</a>.
</p>
</div>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=cubic-bxxxzier-timing-function>cubic BXXXzier timing function<a class=self-link href=#cubic-bxxxzier-timing-function></a></dfn> is a type of <a data-link-type=dfn href=#timing-function title="timing function">timing
function</a> defined by four real numbers that specify the two control
points, <var>P1</var> and <var>P2</var>, of a cubic BXXXier curve whose
end points are fixed at (0, 0) and (1, 1).
The x coordinates of <var>P1</var> and <var>P2</var> are
restricted to the range [0, 1].</p>

<p>The evaluation of this curve is covered in many sources such as
<a data-biblio-type=informative data-link-type=biblio href=#biblio-fund-comp-graphics title=biblio-FUND-COMP-GRAPHICS>[FUND-COMP-GRAPHICS]</a>.</p>

<p>A <a data-link-type=dfn title="cubic BXXXier timing function">cubic BXXXier timing function</a> may be specified as a string
using the following syntax (using notation from <a data-biblio-type=normative data-link-type=biblio href=#biblio-css3-values title=biblio-CSS3-VALUES>[CSS3-VALUES]</a>):
<blockquote>
  <div class=production><dfn class=css-code data-dfn-type=type data-export="" id=typedef-cubic-bezier-timing-function>&lt;cubic-bezier-timing-function&gt;<a class=self-link href=#typedef-cubic-bezier-timing-function></a></dfn> =
    ease | ease-in | ease-out | ease-in-out |
    <span class=atom>cubic-bezier(&lt;number&gt;, &lt;number&gt;,
      &lt;number&gt;, &lt;number&gt;)</span></div>
</blockquote><p></p>

<p>The meaning of each value is as follows:</p>

<dl><dt data-md=""><p>ease</p>
<dd data-md=""><p>Equivalent to cubic-bezier(0.25, 0.1, 0.25, 1).</p>
<dt data-md=""><p>ease-in</p>
<dd data-md=""><p>Equivalent to cubic-bezier(0.42, 0, 1, 1).</p>
<dt data-md=""><p>ease-out</p>
<dd data-md=""><p>Equivalent to cubic-bezier(0, 0, 0.58, 1).</p>
<dt data-md=""><p>ease-in-out</p>
<dd data-md=""><p>Equivalent to cubic-bezier(0.42, 0, 0.58, 1).</p>
<dt data-md=""><p>cubic-bezier(&lt;number&gt; &lt;number&gt; &lt;number&gt; &lt;number&gt;)</p>
<dd data-md=""><p>Specifies a <a data-link-type=dfn title="cubic BXXXier timing function">cubic BXXXier timing function</a>.
The four numbers specify points <var>P1</var> and <var>P2</var> of
the curve as (x1, y1, x2, y2).
Both x values must be in the range [0, 1] or the definition is
invalid.</p>
</dl>
<div class=issue id=issue-63ea6fd5><a class=self-link href=#issue-63ea6fd5></a>
It has been proposed to extend <code>cubic-bezier</code> to allow
multiple segments, using syntax such as the following:

<pre><code>cubic-bezier( [ &lt;number&gt;{6} ; ]* &lt;number&gt;{4} )</code>
</pre>

<p>(i.e. the curve starts at (0, 0); each segment is defined by six
numbers where the start point is the end of the previous segment and
the numbers define the two control points and the end point. The
last segment is defined by four numbers since the end point is fixed
at (1, 1).)</p>

<p>This would provide a simple and compact syntax for tools trying to
map arbitrary curves (e.g. bounce functions) to timing functions.
</div><p></p>

<h4 class="heading settled heading" data-level=3.12.4 id=timing-in-discrete-steps><span class=secno>3.12.4 </span><span class=content>Timing in discrete steps</span><a class=self-link href=#timing-in-discrete-steps></a></h4>

<div class=informative-bg><em>This section is non-normative</em>
It is possible to scale an animation node’s timing so that the animation node
occurs in a series of discrete steps using a stepping function.

<p>Some example step timing functions are illustrated below.</p>

<div class=figure>
  <img alt="Example step timing functions." src=img/step-timing-func-examples.svg width=700>
</div>
<p class=caption>
  Example step timing functions.
  In each case the domain is the input time fraction whilst the range
  represents the output time fraction produced by the step
  function.<br>
  The first row shows the function for each transition point when only
  one step is specified whilst the second row shows the same for three
  steps.
</p>

</div>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=step-timing-function>step timing function<a class=self-link href=#step-timing-function></a></dfn> is a type of <a data-link-type=dfn href=#timing-function title="timing function">timing function</a>
that divides the input time into a specified number of intervals that
are equal in duration.
The output time, starting at zero, rises by an amount equal to the
interval duration once during each interval at the transition point
which may be either the start, midpoint, or end of the interval.</p>

<p>In keeping with Web Animations' model of endpoint exclusive
interval timing (see <a data-section="" href=#interval-timing>§3.8.4 Interval timing</a>), the output time at the transition point is
the time <em>after</em> applying the increase (i.e. the top of the
step) with the following exception.</p>

<p>When a transition point coincides with the end of the <a data-link-type=dfn href=#active-interval title="active interval">active
interval</a> extra care must be taken to produce the correct result
when performing a <a data-link-type=dfn href=#fill-mode title="fill mode">fill</a>.
To achieve this, when a <a data-link-type=dfn href=#step-timing-function title="step timing function">step timing function</a> is
applied to an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> or applied to an <a data-link-type=dfn href=#animation-effect title="animation effect">animation
effect</a> associated with an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>, an additional
<dfn data-dfn-type=dfn data-noexport="" id=before-flag>before flag<a class=self-link href=#before-flag></a></dfn> is passed.
The value of the <a data-link-type=dfn href=#before-flag title="before flag">before flag</a> is determined as follows:</p>


<ol><li data-md=""><p>If the <a data-link-type=dfn href=#active-time title="active time">active time</a> of the animation node is null, the
<a data-link-type=dfn href=#before-flag title="before flag">before flag</a> is not set and these steps should be aborted.</p>
<li data-md=""><p>Determine the <var>current direction</var> using the procedure
defined in <a data-section="" href=#calculating-the-directed-time>§3.11.1 Calculating the directed time</a>.</p>
<li data-md=""><p>If either the <var>current direction</var> is <span class=prop-value>forwards</span> or the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">animation node
playback rate</a> ≥ 0 (but <em>not</em> when both conditions
are true),
let <var>going forwards</var> be true, otherwise it is false.</p>
<li data-md=""><p>The <a data-link-type=dfn href=#before-flag title="before flag">before flag</a> is set if the animation node is in the
<a data-link-type=dfn href=#before-phase title="before phase">before phase</a> and <var>going forwards</var> is true;
or if the animation node is in the <a data-link-type=dfn href=#after-phase title="after phase">after phase</a> and
<var>going forwards</var> is false.</p>
</ol>
<p>When a step timing function is evaluated at a transition point, if
the <a data-link-type=dfn href=#before-flag title="before flag">before flag</a> is set the result is the value <em>before</em>
applying the increase.</p>

<p>A <a data-link-type=dfn href=#step-timing-function title="step timing function">step timing function</a> may be specified as a string
using the following syntax:</p>

<blockquote>
  <div class=production><dfn class=css-code data-dfn-type=type data-export="" id=typedef-step-timing-function>&lt;step-timing-function&gt;<a class=self-link href=#typedef-step-timing-function></a></dfn> =
    step-start | step-middle | step-end |
    <span class=atom>steps(&lt;integer&gt;[,
                       [ start | middle | end ] ]?)</span></div>
</blockquote>

<p>The meaning of each value is as follows:</p>

<dl><dt data-md=""><p>step-start</p>
<dd data-md=""><p>Equivalent to steps(1, start);</p>
<dt data-md=""><p>step-middle</p>
<dd data-md=""><p>Equivalent to steps(1, middle);</p>
<dt data-md=""><p>step-end</p>
<dd data-md=""><p>Equivalent to steps(1, end);</p>
<dt data-md=""><p>steps(&lt;integer&gt;[, [ start | middle | end ] ]?)</p>
<dd data-md=""><p>Specifies a <a data-link-type=dfn href=#step-timing-function title="step timing function">step timing function</a>.
The first parameter specifies the number of intervals in the
function.
It must be a positive integer (greater than 0).
The second parameter, which is optional, specifies the point at
which the change of values occur within the interval.
If the second parameter is omitted, it is given the value <span class=prop-value>end</span>.</p>
</dl>
<h4 class="heading settled heading" data-level=3.12.5 id=calculating-the-transformed-time><span class=secno>3.12.5 </span><span class=content>Calculating the transformed time</span><a class=self-link href=#calculating-the-transformed-time></a></h4>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=transformed-time>transformed time<a class=self-link href=#transformed-time></a></dfn> is calculated from the
<a data-link-type=dfn href=#directed-time title="directed time">directed time</a> using the following steps:</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#directed-time title="directed time">directed time</a> is <code>null</code>,
return <code>null</code>.</p>
<li data-md=""><p>If the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is infinity,
return the <a data-link-type=dfn href=#directed-time title="directed time">directed time</a>.</p>
<li data-md=""><p>Let <var>iteration fraction</var> be the result of
evaluating <code><a data-link-type=dfn href=#directed-time title="directed time">directed time</a> / <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration
duration</a></code> unless <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is
zero, in which case let <var>iteration fraction</var> be
zero.</p>
<li data-md=""><p>Let <var>scaled fraction</var> be the result of
evaluating the <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#timing-function title="timing function">timing function</a>
with <var>iteration fraction</var> as the input time
fraction.</p>
<li data-md=""><p>Return the result of evaluating <code><var>scaled
fraction</var> × <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a></code>.
If the <var>scaled fraction</var> is zero, let the result be
zero.</p>

<p class=note>Note: This clarification is needed since the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>
    may be infinity and the result of infinity multiplied by zero is
    undefined according to IEEE 754-2008.</p>
</ol>

<h3 class="heading settled heading" data-level=3.13 id=grouping-and-synchronization><span class=secno>3.13 </span><span class=content>Grouping and synchronization</span><a class=self-link href=#grouping-and-synchronization></a></h3>

<div class=informative-bg><em>This section is non-normative</em>

<p>While it is possible to set the timing properties of <a data-link-type=dfn href=#animation-node title="animation nodes">animation
nodes</a> individually, it is often useful to synchronize <a data-link-type=dfn href=#animation-node title="animation nodes">animation
nodes</a> so that they share common timing properties and maintain
their temporal relationship.  This is achieved using an <a data-link-type=dfn href=#animation-group title="animation group">animation
group</a>.</p>

<p>A simple example is illustrated below.</p>

<div class=figure>
  <img alt="Using groups to share common timing properties." src=img/grouping-delay.svg width=800>
</div>
<p class=caption>
  Using groups to share common timing properties.<br>
  (a) Shows setting a delay of 5 seconds on individual animations.<br>
  (b) Produces the same effect by setting the delay on the group.
</p>

<p>When an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> is <a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated with
a player</a>, the <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> associated with the
<a data-link-type=dfn href=#animation-group title="animation group">animation group</a> can be seeked, paused, and stopped as a unit.
<p></p>

</div>

<p>An <dfn data-dfn-type=dfn data-noexport="" id=animation-group>animation group<a class=self-link href=#animation-group></a></dfn> is a type of <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> that
contains an ordered sequence of zero or more <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a>
known as <dfn data-dfn-type=dfn data-noexport="" id=child-animation-node title="child animation node">child animation nodes<a class=self-link href=#child-animation-node></a></dfn>.</p>

<p>At a given moment, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may be a <a data-link-type=dfn href=#child-animation-node title="child animation node">child animation
node</a> of at most one <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> known as the <dfn data-dfn-type=dfn data-noexport="" id=parent-animation-group>parent
animation group<a class=self-link href=#parent-animation-group></a></dfn>.
The <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> cannot be the same <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> as the <a data-link-type=dfn href=#child-animation-node title="child animation node">child animation node</a> itself.</p>

<p>By nesting <a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> it is possible to create hierarchical
tree structures.
The following terms are used to describe the parts and properties of
such structures and are defined in <a data-biblio-type=normative data-link-type=biblio href=#biblio-dom4 title=biblio-DOM4>[DOM4]</a>:</p>

<ul><li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=tree-order><a href=http://www.w3.org/TR/dom/#concept-tree-order>
tree order</a><a class=self-link href=#tree-order></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=root><a href=http://www.w3.org/TR/dom/#concept-tree-root>
root</a><a class=self-link href=#root></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=ancestor><a href=http://www.w3.org/TR/dom/#concept-tree-ancestor>
ancestor</a><a class=self-link href=#ancestor></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=descendant><a href=http://www.w3.org/TR/dom/#concept-tree-descendant>
descendant</a><a class=self-link href=#descendant></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=inclusive-ancestor><a href=http://www.w3.org/TR/dom/#concept-tree-inclusive-ancestor>
inclusive ancestor</a><a class=self-link href=#inclusive-ancestor></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=inclusive-descendant><a href=http://www.w3.org/TR/dom/#concept-tree-inclusive-descendant>
inclusive descendant</a><a class=self-link href=#inclusive-descendant></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=next-sibling><a href=http://www.w3.org/TR/dom/#concept-tree-next-sibling>
next sibling</a><a class=self-link href=#next-sibling></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=previous-sibling><a href=http://www.w3.org/TR/dom/#concept-tree-previous-sibling>
previous sibling</a><a class=self-link href=#previous-sibling></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=first-child><a href=http://www.w3.org/TR/dom/#concept-tree-first-child>
first child</a><a class=self-link href=#first-child></a></dfn></p>
<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=last-child><a href=http://www.w3.org/TR/dom/#concept-tree-last-child>
last child</a><a class=self-link href=#last-child></a></dfn></p>
</ul>
<p class=note>Note: in applying these definitions to <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a>, the
    term <em>parent</em> refers exclusively to a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation
    group</a> and does <em>not</em> include the <a data-link-type=dfn href=#player title=player>player</a> which with
    an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> may be <a data-link-type=dfn href=#directly-associated-with-a-player title="directly associated with a player">directly associated</a>
    despite the fact that conceptually the <a data-link-type=dfn href=#player title=player>player</a> acts as a parent
    time source.</p>

<p>The temporal relationship between a <a data-link-type=dfn href=#child-animation-node title="child animation node">child animation node</a> and its
<a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> is incorporated in the definition of
<a data-link-type=dfn href=#inherited-time title="inherited time">inherited time</a> (see <a data-section="" href=#local-time-and-inherited-time>§3.6.4 Local time and inherited time</a>).</p>

<h4 class="heading settled heading" data-level=3.13.1 id=relationship-of-group-time-to-child-time><span class=secno>3.13.1 </span><span class=content>Relationship of group time to child time</span><a class=self-link href=#relationship-of-group-time-to-child-time></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>The timing of the children of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> is based on
the timing of the group.
Specifically, times for the children are based on the parent’s
<a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>.
With regards to repetition, this means the children operate
<em>inside</em> an iteration of the parent.</p>

<p>For example, if an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> has an <a data-link-type=dfn href=#iteration-count title="iteration count">iteration
count</a> of 2, then the children of of the group will all play twice
since they effectively play <em>inside</em> the group’s iterations.</p>

<div class=figure>
  <img alt="The effect of multiple iterations on the children of a group." src=img/grouping-repetition.svg width=600>
</div>
<p class=caption>
  Since children of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> base their timing on the
  group’s <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>, when the group repeats, the
  children play again.
</p>

<p>Note that even in this case, the child <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> still
have only <em>one</em> <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
However, as a result of the parent’s timing, the <a data-link-type=dfn href=#active-interval title="active interval">active
interval</a> is played twice.</p>

<p>If an <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> is specified for the children of a group
as well as for the group itself, the effect is as if the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration
count</a> of the group was multiplied with the <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a>
of the children.</p>

<div class=figure>
  <img alt="Iteration counts are multiplicative." src=img/grouping-repetition-and-animation-repetition.svg width=600>
</div>
<p class=caption>
  Specifying an <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> of 2 on an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a>
  and an <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a> of 3 on one of its children results in
  that child playing 6 times.
</p>

<p>A further result of the children of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> basing
their timing on the group’s <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> is that they
cannot animate outside of the group’s <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
This is because the <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> of a group will not
change outside its <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
This allows groups to <em>clip</em> the playback of their children.</p>

<div class=figure>
  <img alt="Groups clip the active interval of contained children." src=img/grouping-clipping.svg width=600>
</div>
<p class=caption>
  In the first instance, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> has a negative delay
  and an infinite <a data-link-type=dfn href=#iteration-count title="iteration count">iteration count</a>.<br>
  However, when a similar <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is placed inside
  an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> with a specified <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>
  it has the effect of clipping the child <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s
  <a data-link-type=dfn href=#active-interval title="active interval">active interval</a>.
</p>

<p>Some further consequences of <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> children basing
their timing on their parent group’s <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> are:</p>

<ul><li data-md=""><p>Setting the <a data-link-type=dfn href=#animation-node-playback-rate title="animation node playback rate">playback
rate</a> of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> will speed up or slow down all
children.</p>

<li data-md=""><p>Changing the <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a> of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a>
will change the direction of all children.</p>

<li data-md=""><p>Applying a <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> to an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> will
affect the progress of all children.</p>
</ul>
</div>

<h4 class="heading settled heading" data-level=3.13.2 id=the-start-time-of-children-of-an-animation-group><span class=secno>3.13.2 </span><span class=content>The start time of children of an animation group</span><a class=self-link href=#the-start-time-of-children-of-an-animation-group></a></h4>

<p>The <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of a <a data-link-type=dfn href=#child-animation-node title="child animation node">child
animation node</a> of an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> is zero.</p>

<p>Note that specific types of <a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> may override
this definition to provide other kinds of synchronization behavior.</p>

<h4 class="heading settled heading" data-level=3.13.3 id=the-intrinsic-iteration-duration-of-an-animation-group><span class=secno>3.13.3 </span><span class=content>The intrinsic iteration duration of an animation group</span><a class=self-link href=#the-intrinsic-iteration-duration-of-an-animation-group></a></h4>

<p>The <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> of an <a data-link-type=dfn href=#animation-group title="animation group">animation
group</a> is based on the time when the last <a data-link-type=dfn href=#child-animation-node title="child animation node">child animation
node</a> completes its <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> and is calculated using
the following procedure.</p>

<ol><li data-md=""><p>Define the <a data-link-type=dfn href=#end-time title="end time">end time</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> as:</p>

<blockquote>
  <dfn data-dfn-type=dfn data-noexport="" id=end-time>end time<a class=self-link href=#end-time></a></dfn> =
  <code><a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> +
  <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> + <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> + <a data-link-type=dfn href=#end-delay title="end delay">end
  delay</a></code>
</blockquote>

<li data-md=""><p>The <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> depends on the number of
<a data-link-type=dfn href=#child-animation-node title="child animation nodes">child animation nodes</a> as follows,
<div class=switch><p></p>

<dl><dt data-md=""><p>If the group has no <a data-link-type=dfn href=#child-animation-node title="child animation nodes">child animation nodes</a>,</p>
<dd data-md=""><p>the <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> is zero.</p>

<dt data-md=""><p>Otherwise,</dt><p></p>
<dd data-md="">

<ol><li data-md=""><p>Let <var>maximum end time</var> be the maximum value
  after calculating the <a data-link-type=dfn href=#end-time title="end time">end time</a> of each <a data-link-type=dfn href=#child-animation-node title="child animation node">child
  animation node</a> in the group.</li><p></p>
<li data-md=""><p>The <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> is the result of
  evaluating <code>max(0, <var>maximum end
  time</var>)</code>.</li>
</ol></dl></div><p></p>
</ol>
<p>This definition of the <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> may be
overridden by specific types of <a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a>.</p>

<h4 class="heading settled heading" data-level=3.13.4 id=animation-sequences><span class=secno>3.13.4 </span><span class=content>Animation sequences</span><a class=self-link href=#animation-sequences></a></h4>

<div class=informative-bg><em>This section is non-normative</em>

<p>Specific types of <a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> can be used to provide
different kinds of synchronization behavior for their children.
This specification defines one additional type of <a data-link-type=dfn href=#animation-group title="animation group">animation
group</a>: an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a>.
<a data-link-type=dfn href=#animation-sequence title="Animation sequences">Animation sequences</a> arrange the start times of their
children so that they run one at a time, in turn.</p>

<p>Compare the two arrangements illustrated below:</p>

<div class=figure>
  <img alt="Animation groups and animation sequences." src=img/grouping-types.svg width=600>
</div>
<p class=caption>
  Animation groups and animation sequences.<br>
  (a) is a regular <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> where all the children run
      simultaneously.<br>
  (b) is an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> where the children run in turn.
</p>

<p>Since <a data-link-type=dfn href=#animation-group title="animation groups">animation groups</a> can also contain other <a data-link-type=dfn href=#animation-group title="animation groups">animation
groups</a>, complex synchronization is possible by combining
different types of groups as illustrated below.</p>

<div class=figure>
  <img alt="Nesting of animation groups." src=img/grouping-nesting.svg width=600>
</div>
<p class=caption>
  An <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> that contains a regular <a data-link-type=dfn href=#animation-group title="animation group">animation
  group</a> as a child.<br>
  The <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> waits for the previous child of the
  <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> to finish, and then the children of the
  <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> play simultaneously.
  After they have finished the next child of the <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation
  sequence</a> plays.
</p>

</div>

<p>An <dfn data-dfn-type=dfn data-noexport="" id=animation-sequence>animation sequence<a class=self-link href=#animation-sequence></a></dfn> is a type of <a data-link-type=dfn href=#animation-group title="animation group">animation group</a>
that schedules its <a data-link-type=dfn href=#child-animation-node title="child animation nodes">child animation nodes</a> such that they play in
turn following their order in the group.
This sequencing is achieved by adjusting the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of each <a data-link-type=dfn href=#child-animation-node title="child animation node">child
animation node</a> in the group.</p>

<h5 class="heading settled heading" data-level=3.13.4.1 id=the-start-time-of-children-of-an-animation-sequence><span class=secno>3.13.4.1 </span><span class=content>The start time of children of an animation sequence</span><a class=self-link href=#the-start-time-of-children-of-an-animation-sequence></a></h5>

<p>The <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of
a <a data-link-type=dfn href=#child-animation-node title="child animation node">child animation node</a> of an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> is the
<a data-link-type=dfn href=#end-time title="end time">end time</a> of the child’s <a data-link-type=dfn href=#previous-sibling title="previous sibling">previous sibling</a>.
If the child has no <a data-link-type=dfn href=#previous-sibling title="previous sibling">previous sibling</a> the start time is zero.</p>

<div class=note>
When the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> is positive infinity the behavior
for calculating the <a data-link-type=dfn href=#end-time title="end time">end time</a> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>
and the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of
subsequent children follows the usual behavior defined by IEEE
754-2008.
As a result, if any of the children of an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation
sequence</a> has an infinite <a data-link-type=dfn href=#active-duration title="active duration">active duration</a>, any children
that occur later in the sequence will not play.

<p>Similarly, the above definition does not restrict
<a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start times</a> to positive
values and hence some children may not play due to a negative
<a data-link-type=dfn href=#start-delay title="start delay">start delay</a> on children that occur earlier in the group
since their <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> may end before the group’s <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a>.
</div><p></p>

<div class=informative-bg><em>This section is non-normative</em>

<p>Because the start of the <a data-link-type=dfn href=#active-interval title="active interval">active interval</a> is based on the
sum of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>’s <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> <em>and</em>
<a data-link-type=dfn href=#start-delay title="start delay">start delay</a>, the <a data-link-type=dfn href=#active-interval title="active intervals">active intervals</a> of
children of an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> need not run in strict
sequence but can be shifted back and forth by using the <a data-link-type=dfn href=#start-delay title="start delay">start
delay</a> as shown in the following diagram.</p>

<div class=figure>
  <img alt="Using negative start delays to overlap children of seq
        groups" src=img/sequence-groups-and-start-delays.svg width=600>
</div>
<p class=caption>
  Example of using the <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> on children of an
  <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> to shift their timing so that they
  overlap (a negative delay) or are spaced apart (a positive delay).
</p>

<p>A negative <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> can be used to cause the <a data-link-type=dfn href=#active-interval title="active interval">active
interval</a> of two children to overlap.
Note that the <a data-link-type=dfn href=#start-delay title="start delay">start delay</a> affects the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of subsequent
children in the group.</p>

</div>

<h5 class="heading settled heading" data-level=3.13.4.2 id=the-intrinsic-iteration-duration-of-an-animation-sequence><span class=secno>3.13.4.2 </span><span class=content>The intrinsic iteration duration of an animation sequence</span><a class=self-link href=#the-intrinsic-iteration-duration-of-an-animation-sequence></a></h5>

<p>The <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> of an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation
sequence</a> is equivalent to the <a data-link-type=dfn href=#animation-node-start-time title="animation node start time">start time</a> of a hypothetical
<a data-link-type=dfn href=#child-animation-node title="child animation node">child animation node</a> appended to the group’s children
calculated according to the definition in <a data-section="" href=#the-start-time-of-children-of-an-animation-sequence>§3.13.4.1 The start time of children of an animation sequence</a> unless that produces a negative value, in
which case the <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> is zero.</p>

<p>As a result, if the <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation sequence</a> has no <a data-link-type=dfn href=#child-animation-node title="child animation nodes">child
animation nodes</a> the <a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a> will be
zero.</p>

<h3 class="heading settled heading" data-level=3.14 id=animations><span class=secno>3.14 </span><span class=content>Animations</span><a class=self-link href=#animations></a></h3>

<p><dfn data-dfn-type=dfn data-noexport="" id=animation title=animation>Animations<a class=self-link href=#animation></a></dfn> are a kind of <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> that apply an <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> or a <a data-link-type=dfn href=#custom-effect title="custom effect">custom effect</a>
to an element or pseudo-element such as <code>::before</code> and
<code>::first-line</code> <a data-biblio-type=normative data-link-type=biblio href=#biblio-select title=biblio-SELECT>[SELECT]</a> referred to as the <dfn data-dfn-type=dfn data-noexport="" id=animation-target>animation
target<a class=self-link href=#animation-target></a></dfn>.</p>

<h4 class="heading settled heading" data-level=3.14.1 id=calculating-the-time-fraction><span class=secno>3.14.1 </span><span class=content>Calculating the time fraction</span><a class=self-link href=#calculating-the-time-fraction></a></h4>

<p>Before passing the <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> of an <a data-link-type=dfn href=#animation title=animation>animation</a> to
its <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> it is converted to a <em>time
fraction</em>.
The <dfn data-dfn-type=dfn data-noexport="" id=time-fraction>time fraction<a class=self-link href=#time-fraction></a></dfn> of an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is calculated
according to the following steps:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> is zero,</p>
<dd data-md=""><p>the <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> is as follows,</p>

<div class=switch>

<dl><dt data-md=""><p>If <a data-link-type=dfn href=#local-time title="local time">local time</a> &lt; <a data-link-type=dfn href=#start-delay title="start delay">start delay</a>,</p>
<dd data-md=""><p>Return the result of recalculating the <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a>
using an <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> of 1.</p>

<dt data-md=""><p>Otherwise,</p>
<dd data-md="">

<ol><li data-md=""><p>Let <var>normalized active duration</var> be the result of
recalculating the <a data-link-type=dfn href=#active-duration title="active duration">active duration</a> using an
<a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> of 1.</p>
<li data-md=""><p>Return the result of recalculating the <a data-link-type=dfn href=#transformed-time title="transformed time">transformed
time</a> using a <a data-link-type=dfn href=#local-time title="local time">local time</a> of <code><a data-link-type=dfn href=#start-delay title="start delay">start
delay</a> + <var>normalized active duration</var></code>
and an <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> of 1.</p>
</ol></dl>
</div>

<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Return <a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> / <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a> unless
<a data-link-type=dfn href=#transformed-time title="transformed time">transformed time</a> is <code>null</code>, in which case return
<code>null</code>.</p>
</dl>
</div>

<p class=note>Note: Since <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> are allowed to produce output times
    outside the range [0, 1] it is possible that the value calculated for
    a <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> also lies outside this range.</p>





<h2 class="heading settled heading" data-level=4 id=animation-model><span class=secno>4 </span><span class=content>Animation Model</span><a class=self-link href=#animation-model></a></h2>

<div class=informative-bg><em>This section is non-normative</em>

<p>The Web Animations <em>animation model</em> takes the <a data-link-type=dfn href=#time-fraction title="time fractions">time
fractions</a> and <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a> values produced by the                                                                                                                
<em>timing model</em> for a given <a data-link-type=dfn href=#animation title=animation>animation</a> and applies it as                                                                                                             
the input to the <a data-link-type=dfn href=#animation title=animation>animation</a>’s <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>.</p>

<p>The output of each <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> is then combined with other
<a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a> using an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> before being                                                                                                            
applied to the target properties (see <a data-section="" href=#combining-animations>§4.2 Combining animations</a>).</p>

</div>

<h3 class="heading settled heading" data-level=4.1 id=animation-effects><span class=secno>4.1 </span><span class=content>Animation effects</span><a class=self-link href=#animation-effects></a></h3>

<p>An <dfn data-dfn-type=dfn data-noexport="" id=animation-effect>animation effect<a class=self-link href=#animation-effect></a></dfn> takes a <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and
a <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a> value and uses them to calculate an
<a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> for its <a data-link-type=dfn href=#target-property title="target property">target properties</a>.  Each <a data-link-type=dfn href=#animation title=animation>animation</a>
may have at most one <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> associated with it.</p>

<p>Since the result of an <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> is based on the
<a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a> value, it is updated
whenever the timing model is <a data-link-type=dfn href=#sampling title=sampling>sampled</a>.</p>

<h4 class="heading settled heading" data-level=4.1.1 id=target-properties><span class=secno>4.1.1 </span><span class=content>Target properties</span><a class=self-link href=#target-properties></a></h4>

<p>Each <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> can have zero or more associated
<dfn data-dfn-type=dfn data-noexport="" id=target-property title="target property">target properties<a class=self-link href=#target-property></a></dfn>.</p>

<p><a data-link-type=dfn href=#target-property title="target property">Target properties</a> may be CSS properties
or DOM attributes.
If a given <a data-link-type=dfn href=#animation-target title="animation target">animation target</a> has an attribute with the same name
as a CSS property, any <a data-link-type=dfn href=#target-property title="target property">target property</a> of that name is taken to
refer to to the CSS property.</p>

<p class=note>Note: If there ever exists a situation where we need to animate an attribute
      with the same name as a property (other than a <a href=http://www.w3.org/TR/SVG2/intro.html#TermPresentationAttribute>presentation
      attribute</a> <a data-biblio-type=informative data-link-type=biblio href=#biblio-svg2 title=biblio-SVG2>[SVG2]</a>) then we will need to introduce
      a disambiguation strategy. Generally, however, such naming should be
      avoided.</p>

<h4 class="heading settled heading" data-level=4.1.2 id=procedures-for-animating-properties><span class=secno>4.1.2 </span><span class=content>Procedures for animating properties</span><a class=self-link href=#procedures-for-animating-properties></a></h4>

<p>In order to animate a <a data-link-type=dfn href=#target-property title="target property">target property</a>, the following procedures
must be defined.</p>

<ul><li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=animation-interpolation title="animation interpolation">interpolation<a class=self-link href=#animation-interpolation></a></dfn> —
given two target property values <var>V</var><sub>start</sub> and
<var>V</var><sub>end</sub>, produces an intermediate value
<var>V</var><sub>res</sub> at a distance of <var>p</var> along the
interval between <var>V</var><sub>start</sub> and
<var>V</var><sub>end</sub> such that
<var>p</var> = 0 produces <var>V</var><sub>start</sub> and
<var>p</var> = 1 produces <var>V</var><sub>end</sub>.
The range of <var>p</var> is (−∞, ∞) due to the
effect of <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a>.
As a result, this procedure must also define extrapolation
behavior for <var>p</var> outside [0, 1].</p>

<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=animation-addition title="animation addition">addition<a class=self-link href=#animation-addition></a></dfn> — given two
target property values
<var>V</var><sub>a</sub> and <var>V</var><sub>b</sub>, returns the
sum of the two properties, <var>V</var><sub>result</sub>.
For addition that is not commutative (for example, matrix
multiplication) <var>V</var><sub>a</sub> represents the first term
of the operation and <var>V</var><sub>b</sub> represents the
second.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>While <a data-link-type=dfn href=#animation-addition title="animation addition">addition</a> can often be
expressed in terms of the same weighted sum function used to
define <a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>,
this is not always the case.
For example, interpolation of transform matrices involves
decomposing and interpolating the matrix components whilst
addition relies on matrix multiplication.</p>

</div>

<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=animation-accumulation0 title="animation accumulation">accumulation<a class=self-link href=#animation-accumulation0></a></dfn> —
given two target property values
<var>V</var><sub>a</sub> and <var>V</var><sub>b</sub>, returns the
result, <var>V</var><sub>result</sub>, of combining
the two operands such that <var>V</var><sub>b</sub> is treated as
a <em>delta</em> from <var>V</var><sub>a</sub>.
For accumulation that is not commutative (for example,
accumulation of mismatched transform lists)
<var>V</var><sub>a</sub> represents the first term of the
operation and <var>V</var><sub>b</sub> represents the second.</p>

<div class=informative-bg><em>This section is non-normative</em>

<p>For many types of animation such as numbers or lengths, <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation</a> is defined to
be identical to <a data-link-type=dfn href=#animation-addition title="animation addition">addition</a>.</p>

</div>

<p>A common case where the definitions differ is for list-based
types where <a data-link-type=dfn href=#animation-addition title="animation addition">addition</a> may be
defined as appending to a list
whilst <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation</a> may
be defined as component-based addition.
For example, the filter list values "blur(2)" and
"blur(3)", when <a data-link-type=dfn href=#animation-addition title="animation addition">added</a>
together may produce "blur(2) blur(3)", but when
<a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulated</a>,
may produce "blur(5)".</p>

<li data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=distance-computation>distance computation<a class=self-link href=#distance-computation></a></dfn> — given two target property
values <var>V</var><sub>start</sub> and
<var>V</var><sub>end</sub>, calculates some notion of scalar
distance between the values, <var>distance</var>.</p>
</ul>
<h4 class="heading settled heading" data-level=4.1.3 id=specific-animation-behaviors><span class=secno>4.1.3 </span><span class=content>Specific animation behaviors</span><a class=self-link href=#specific-animation-behaviors></a></h4>

<p>The specific procedures used for animating a given <a data-link-type=dfn href=#target-property title="target property">target
property</a> are referred to as the property’s <dfn data-dfn-type=dfn data-noexport="" id=animation-behavior>animation
behavior<a class=self-link href=#animation-behavior></a></dfn>.</p>

<p>The <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> of CSS properties is defined by the
"Animatable:" line in the summary of the property’s definition or in
<a data-biblio-type=informative data-link-type=biblio href=#biblio-css3-transitions title=biblio-CSS3-TRANSITIONS>[CSS3-TRANSITIONS]</a> for properties that lack a such a line.</p>

<p class=issue id=issue-48287af4><a class=self-link href=#issue-48287af4></a>The default <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> for CSS properties is "as
       string".  Should this be defined here or in CSS Animations Level 4?</p>

<p>For DOM attributes, the <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> is defined alongside
the attribute definition.
Unlike CSS properties, if such a definition is not provided the
default <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> is “<a data-link-type=dfn href=#not-animatable0 title="not animatable">not
animatable</a>”.</p>

<p>Following is a series of pre-defined <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a>.
<a data-biblio-type=informative data-link-type=biblio href=#biblio-css3-transitions title=biblio-CSS3-TRANSITIONS>[CSS3-TRANSITIONS]</a> provides further CSS-specific <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation
behaviors</a>.</p>

<p>For <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a> that do not define a specific procedure
for <a data-link-type=dfn href=#animation-addition title="animation addition">addition</a> or which are defined as
<dfn data-dfn-type=dfn data-noexport="" id=not-additive>not additive<a class=self-link href=#not-additive></a></dfn>, the <a data-link-type=dfn href=#animation-addition title="animation addition">addition procedure</a> is simply
<var>V</var><sub>res</sub> = <var>V</var><sub>b</sub>.</p>

<p>For <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a> that do not define a specific procedure
for <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation</a>, the <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation procedure</a> is identical
to the <a data-link-type=dfn href=#animation-addition title="animation addition">addition procedure</a> for that
behavior.</p>

<p>For <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a> that do not define a specific procedure
for <a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a> or which are defined as <dfn data-dfn-type=dfn data-noexport="" id=not-paceable>not
paceable<a class=self-link href=#not-paceable></a></dfn>, the <a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a> procedure is simply
<var>distance</var> = 1.</p>

<h5 class="heading settled heading" data-level=4.1.3.1 id=not-animatable><span class=secno>4.1.3.1 </span><span class=content>Not animatable</span><a class=self-link href=#not-animatable></a></h5>

<p>Some properties are specifically defined as <dfn data-dfn-type=dfn data-noexport="" id=not-animatable0>not
animatable<a class=self-link href=#not-animatable0></a></dfn>.
For example, properties defining animation parameters are <a data-link-type=dfn href=#not-animatable0 title="not animatable">not
animatable</a> since doing so would create complex recursive
behavior.</p>

<p>Unlike other <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a>, no procedures for
<a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>,
<a data-link-type=dfn href=#animation-addition title="animation addition">addition</a> and <a data-link-type=dfn href=#distance-computation title="distance computation">distance
computation</a> are defined for properties whose <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation
behavior</a> is <a data-link-type=dfn href=#not-animatable0 title="not animatable">not animatable</a> since these properties should
not be modified.</p>

<p>An <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> that targets a property that is
<a data-link-type=dfn href=#not-animatable0 title="not animatable">not animatable</a> will still exhibit the usual behavior for
an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> such as occupying time in an <a data-link-type=dfn href=#animation-sequence title="animation sequence">animation
sequence</a> and delaying the firing of a <a data-link-type=dfn href=#player title=player>player</a>’s <a data-link-type=dfn href=#finish-player-event title="finish player event">finish event</a>.</p>

<h5 class="heading settled heading" data-level=4.1.3.2 id=animatable-as-string><span class=secno>4.1.3.2 </span><span class=content>Animatable as string</span><a class=self-link href=#animatable-as-string></a></h5>

<p>A <a data-link-type=dfn href=#target-property title="target property">target property</a> that is <dfn data-dfn-type=dfn data-noexport="" id=animatable-as-string0>animatable as string<a class=self-link href=#animatable-as-string0></a></dfn>
has the following <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>:
<div aria-describedby=math-string-interpolation role=math style="display: inline">
<math xmlns=http://www.w3.org/1998/Math/MathML>
  <msub><mi>V</mi><mn>res</mn></msub><mo>=</mo>
  <mrow>
    <mfenced close="" open={>
      <mtable>
        <mtr>
          <mtd columnalign=left>
            <msub><mi>V</mi><mn>start</mn></msub>
          </mtd>
          <mtd columnalign=left>
            <mtext>if </mtext><mi>p</mi>
            <mo>&lt;</mo><mn>0.5</mn>
          </mtd>
        </mtr>
        <mtr>
          <mtd columnalign=left>
            <msub><mi>V</mi><mn>end</mn></msub>
          </mtd>
          <mtd columnalign=left>
            <mtext>if </mtext><mi>p</mi>
            <mo>≥</mo><mn>0.5</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
<div id=math-string-interpolation>
  <var>V</var><sub>res</sub> =
    <var>V</var><sub>start</sub>, if <var>p</var> &lt; 0.5 or
    <var>V</var><sub>end</sub>, if <var>p</var> ≥ 0.5
</div>
</div><p></p>
</ul>
<h5 class="heading settled heading" data-level=4.1.3.3 id=animatable-as-real-number><span class=secno>4.1.3.3 </span><span class=content>Animatable as real number</span><a class=self-link href=#animatable-as-real-number></a></h5>

<p>A <a data-link-type=dfn href=#target-property title="target property">target property</a> that is <dfn data-dfn-type=dfn data-noexport="" id=animatable-as-real-number0>animatable as real
number<a class=self-link href=#animatable-as-real-number0></a></dfn> has the following <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>:
<var>V</var><sub>res</sub> =
  (1 - <var>p</var>) × <var>V</var><sub>start</sub>
  + <var>p</var> × <var>V</var><sub>end</sub></p>
<li data-md=""><p><a data-link-type=dfn href=#animation-addition title="animation addition">addition</a>:
  <var>V</var><sub>a</sub> + <var>V</var><sub>b</sub></p>
<li data-md=""><p><a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a>:
<var>distance</var> = |<var>V</var><sub>end</sub>
                       - <var>V</var><sub>start</sub>|</p>
</ul>
<h5 class="heading settled heading" data-level=4.1.3.4 id=animatable-as-length-percentage-or-calc><span class=secno>4.1.3.4 </span><span class=content>Animatable as length, percentage, or calc</span><a class=self-link href=#animatable-as-length-percentage-or-calc></a></h5>

<p>A <a data-link-type=dfn href=#target-property title="target property">target property</a> that is <dfn data-dfn-type=dfn data-noexport="" id=animatable-as-length-percentage-or-calc0>animatable as length,
percentage, or calc<a class=self-link href=#animatable-as-length-percentage-or-calc0></a></dfn> has the following <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation
behavior</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>:
as defined in <a data-biblio-type=informative data-link-type=biblio href=#biblio-css3-transitions title=biblio-CSS3-TRANSITIONS>[CSS3-TRANSITIONS]</a>.</p>
<li data-md=""><p><a data-link-type=dfn href=#animation-addition title="animation addition">addition</a>:
calc(<var>V</var><sub>a</sub> + <var>V</var><sub>b</sub>)<br>
(Nested <code>calc()</code> functions are expanded when
determining the computed value as defined in <a href=http://www.w3.org/TR/css3-values/#calc-computed-value>CSS
Values and Units</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-css3-values title=biblio-CSS3-VALUES>[CSS3-VALUES]</a>.)</p>
<li data-md=""><p><a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a>: as with <a data-link-type=dfn href=#animatable-as-real-number0 title="animatable as real number">animatable as real
number</a> but using the <a href=http://www.w3.org/TR/CSS2/cascade.html#used-value>used
value</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-css21 title=biblio-CSS21>[CSS21]</a> for <var>V</var><sub>start</sub> and
<var>V</var><sub>end</sub>.</p>
</ul>
<h5 class="heading settled heading" data-level=4.1.3.5 id=animatable-as-color><span class=secno>4.1.3.5 </span><span class=content>Animatable as color</span><a class=self-link href=#animatable-as-color></a></h5>

<p>A <a data-link-type=dfn href=#target-property title="target property">target property</a> that is <dfn data-dfn-type=dfn data-noexport="" id=animatable-as-color0>animatable as color<a class=self-link href=#animatable-as-color0></a></dfn> has
the following <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>:
as defined in <a data-biblio-type=informative data-link-type=biblio href=#biblio-css3-transitions title=biblio-CSS3-TRANSITIONS>[CSS3-TRANSITIONS]</a>.</p>
<li data-md=""><p><a data-link-type=dfn href=#animation-addition title="animation addition">addition</a>:
as with <a data-link-type=dfn href=#animatable-as-real-number0 title="animatable as real number">animatable as real number</a> but performed on each
RGBA color component in premultiplied space.</p>

<p class=note>Note: Since negative color is not currently supported, clamping of
      the channel values may be performed upon each addition or once
      when <a data-link-type=dfn title=composition>composition</a> is complete.
<p></p>
<li data-md=""><p><a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a>:
<div aria-describedby=math-color-distance role=math>
  <math xmlns=http://www.w3.org/1998/Math/MathML>
  <mrow>
    <mi>distance</mi><mo>=</mo>
    <msqrt>
      <msup>
        <mrow>
          <mfenced close=) open=( separators=,>
            <mrow><msub><mi>R</mi><mn>end</mn></msub>
                  <mo>-</mo>
                  <msub><mi>R</mi><mn>start</mn></msub></mrow>
          </mfenced>
        </mrow><mn>2</mn>
      </msup>
      <mo>+</mo>
      <msup>
        <mrow>
          <mfenced close=) open=( separators=,>
            <mrow><msub><mi>G</mi><mn>end</mn></msub>
                  <mo>-</mo>
                  <msub><mi>G</mi><mn>start</mn></msub></mrow>
          </mfenced>
        </mrow><mn>2</mn>
      </msup>
      <mo>+</mo>
      <msup>
        <mrow>
          <mfenced close=) open=( separators=,>
            <mrow><msub><mi>B</mi><mn>end</mn></msub>
                  <mo>-</mo>
                  <msub><mi>B</mi><mn>start</mn></msub></mrow>
            </mfenced>
        </mrow><mn>2</mn>
      </msup>
      <mo>+</mo>
      <msup>
        <mrow>
          <mfenced close=) open=( separators=,>
            <mrow><msub><mi>A</mi><mn>end</mn></msub>
                  <mo>-</mo>
                  <msub><mi>A</mi><mn>start</mn></msub></mrow>
          </mfenced>
        </mrow><mn>2</mn>
      </msup>
    </msqrt>
  </mrow>
  </math><p></p>

  <div id=math-color-distance>
  distance = sqrt((R<sub>end</sub> - R<sub>start</sub>)^2 + (G<sub>end</sub> - G<sub>start</sub>)^2 + (B<sub>end</sub> - B<sub>start</sub>)^2 + (A<sub>end</sub> - A<sub>start</sub>)^2)
  </div>

</div>

<p>where &lt;<var>R|G|B|A</var><sub>start|end</sub>&gt;
represents the red, green, blue, or alpha channel of
<var>V</var><sub>start</sub> or <var>V</var><sub>end</sub>
respectively.
Each value is normalized to the [0.0, 1.0] range and expressed
in premultiplied color space.</p>
</ul>
<p class=issue id=issue-63f8b8b1><a class=self-link href=#issue-63f8b8b1></a>Should we call this “animatable as premultiplied RGBA additive
color in sRGB color space” instead?</p>

<h5 class="heading settled heading" data-level=4.1.3.6 id=animatable-as-transform-list><span class=secno>4.1.3.6 </span><span class=content>Animatable as transform list</span><a class=self-link href=#animatable-as-transform-list></a></h5>

<p>A <a data-link-type=dfn href=#target-property title="target property">target property</a> that is <dfn data-dfn-type=dfn data-noexport="" id=animatable-as-transform-list0>animatable as transform
list<a class=self-link href=#animatable-as-transform-list0></a></dfn> has the following <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>:</p>

<ul><li data-md=""><p><a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation</a>:
as defined in <a href=http://www.w3.org/TR/css3-transforms/#interpolation-of-transforms>Interpolation
of Transforms</a> <a data-biblio-type=informative data-link-type=biblio href=#biblio-css3-transforms title=biblio-CSS3-TRANSFORMS>[CSS3-TRANSFORMS]</a>.</p>

<li data-md=""><p><a data-link-type=dfn href=#animation-addition title="animation addition">addition</a>: performed by
concatenating transform lists as 
‘<var>V</var><sub>a</sub> <var>V</var><sub>b</sub>’.</p>

<li data-md=""><p><a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation</a>:</p>

<ol><li data-md=""><p>Beginning at the end of each list, <var>V</var><sub>a</sub>
and <var>V</var><sub>b</sub>,
find the largest contiguous portion of each list where the
corresponding list elements from each list have the same
transform type.
Call the matching portions from <var>V</var><sub>a</sub> and
<var>V</var><sub>b</sub>, <var>V</var><sub>matching-a</sub>
and
<var>V</var><sub>matching-b</sub> respectively and likewise
<var>V</var><sub>remainder-a</sub> and
<var>V</var><sub>remainder-b</sub> for the non-matching
parts.
<p class=issue id=issue-3540bd4c><a class=self-link href=#issue-3540bd4c></a>
  We should probably expand 2d functions to their 3d
  equivalents before matching?
<p></p>
<li data-md=""><p>Let <var>V</var><sub>combined</sub> be a transform list
combining <var>V</var><sub>matching-a</sub> and
<var>V</var><sub>matching-b</sub> by adding the numeric
components of each corresponding function.
<p class=issue id=issue-7c98bbea><a class=self-link href=#issue-7c98bbea></a>
  This needs to be more specific, e.g. when combining
  <code>translate(20px)</code> and <code>translate(30px
  10px)</code> we have to expand the first function to
  <code>translate(20px 0px)</code> first.
  Probably need to define unit conversion too.
<p></p>
<li data-md=""><p>The result of accumulation is a transform list created by <a data-link-type=dfn href=#animation-addition title="animation addition">adding</a> the combined result
with the non-matching portions of the two lists as follows:
‘<var>V</var><sub>remainder-a</sub> 
<var>V</var><sub>remainder-b</sub>
<var>V</var><sub>combined</sub>’.</p>
</ol>
<li data-md=""><p><a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a>: <span class=todo>See issue
below</span></p>
</ul>
<div class=issue id=issue-b82dbcbe><a class=self-link href=#issue-b82dbcbe></a>

<p>For <a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a> we previously defined it as follows:</p>

<ol><li data-md=""><p>Look only at the first component of the two lists</p>
<li data-md=""><p>If both are translate → euclidean distance</p>
<li data-md=""><p>If both are scale → absolute difference</p>
<li data-md=""><p>If both are rotate → absolute difference</p>
<li data-md=""><p>If both match but are something else → use linear</p>
<li data-md=""><p>If they don’t match → use matrix decomposition and
euclidean distance between translate components</p>
</ol>
<p>This seems really arbitrary, especially part 5.</p>

<p>Also, looking at only the first component seems odd.
    Going through each component, working out the distance and then
    getting the square of the distance also seems much more consistent
    with what we do elsewhere.</p>

</div>

<h5 class="heading settled heading" data-level=4.1.3.7 id=other-animation-behaviors><span class=secno>4.1.3.7 </span><span class=content>Other animation behaviors</span><a class=self-link href=#other-animation-behaviors></a></h5>

<p>The set of <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a> defined here may be extended
by other specifications.
For example, properties with using the &lt;image&gt; type are
animated using the interpolation behavior defined in <a href=http://dev.w3.org/csswg/css-images-4/#interpolation>CSS Image
Values and Replaced Content</a>
<a data-biblio-type=informative data-link-type=biblio href=#biblio-css4-images title=biblio-CSS4-IMAGES>[CSS4-IMAGES]</a>.</p>

<div class=issue id=issue-2b25d150><a class=self-link href=#issue-2b25d150></a>

<p>There are a bunch of CSS properties for which distance (and in
    some cases addition) is not defined or which need special
    handling.</p>

<p>For example,</p>

<ul><li data-md=""><p>font-stretch (an enum but handled like an integer)</p>
<li data-md=""><p>visibility (0 or 1 depending on if endpoints match or not)</p>
<li data-md=""><p>flex-grow and flex-shrink which allow animation only if one of
the endpoints is 0)</p>
<li data-md=""><p>value pairs, triples (use square distance)</p>
<li data-md=""><p>rects (use square distance)</p>
<li data-md=""><p>dash arrays (square distance but a bit weird due to
percentages)</p>
<li data-md=""><p>shadows (square distance of components)</p>
<li data-md=""><p>filters (undefined)</p>
<li data-md=""><p>background-position (special list handling needed)</p>
<li data-md=""><p>pair lists</p>
</ul>
<p>Should we define these here or in the CSS Animation 4 spec?</p>

</div>

<h4 class="heading settled heading" data-level=4.1.4 id=intermediate-animation-values><span class=secno>4.1.4 </span><span class=content>Intermediate animation values</span><a class=self-link href=#intermediate-animation-values></a></h4>

<p>Given a <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a>, a <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a>, and an
<a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a>, an <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> produces
an <dfn data-dfn-type=dfn data-noexport="" id=intermediate-animation-value>intermediate animation value<a class=self-link href=#intermediate-animation-value></a></dfn> for each <a data-link-type=dfn title=animatable>animatable</a>
<a data-link-type=dfn href=#target-property title="target property">target property</a>.
The procedure for calculating this value depends on the specific
type of <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> and is defined subsequently (see <a data-section="" href=#the-intermediate-animation-value-of-a-keyframe-animation-effect>§4.3.2 The intermediate animation value of a keyframe animation effect</a> and <a data-section="" href=#the-intermediate-animation-value-of-a-motion-path-animation-effect>§4.4.4 The intermediate animation value of a motion path animation effect</a>).</p>

<p>Before being applied to the <a data-link-type=dfn href=#target-property title="target property">target
properties</a>,
these <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> are composed together using
the process defined in <a data-section="" href=#combining-animations>§4.2 Combining animations</a>.</p>

<h3 class="heading settled heading" data-level=4.2 id=combining-animations><span class=secno>4.2 </span><span class=content>Combining animations</span><a class=self-link href=#combining-animations></a></h3>
<div class=informative-bg><em>This section is non-normative</em>

<p>After calculating the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> for an
<a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>, they are applied to the <a data-link-type=dfn href=#animation-effect title="animation effect">animation
effect</a>’s <a data-link-type=dfn href=#target-property title="target property">target properties</a>.</p>

<p>Since it is possible for multiple <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> <a data-link-type=dfn href=#animation title=animation>animations</a> to target the same property it is
often necessary to combine the results of several <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a> together.
This process is called <em>compositing</em> and is based on
establishing an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> for each property targetted by
an <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>.</p>

<p>After compositing the results of <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a> together, the composited result is combined with other
values specified for the <a data-link-type=dfn href=#target-property title="target property">target property</a>.</p>

<p>For a CSS <a data-link-type=dfn href=#target-property title="target property">target property</a> the arrangement is illustrated below:</p>

<div class=figure>
<img alt="Overview of the application of intermediate animation values
to their target properties" src=img/animation-cascade.svg width=450>
</div>
<p class=caption>
Overview of the application of <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> to
their <a data-link-type=dfn href=#target-property title="target properties">target properties</a>.<br>
The results of <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a> targetting the same property
are composited together using an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a>.<br>
The result of this composition is written to an animation stylesheet
that is more important than other stylesheets but less than any
<code>!important</code> rules.
</p>

<p>For a <a data-link-type=dfn href=#target-property title="target property">target property</a> that specifies a DOM attribute, the
composited result is combined with the value of the attribute
specified in the DOM or the lacuna value for that attribute if it is
not specified.</p>

<p>For the first part of this operation—combining <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate
animation values</a> that target the same <a data-link-type=dfn href=#target-property title="target property">property</a>— it is necessary to
determine both
<em>how</em> the <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a>
associated with the <a data-link-type=dfn href=#animation title=animations>animations</a> are combined
with one another,
as well as the <em>order</em> in which they are applied, that is,
their relative <em>priority</em>.</p>

<p>The matter of <em>how</em> <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> are
combined is governed by the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of
the corresponding <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a>.
The relative <em>priority</em> of <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a>
is determined by an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> established for each
animated property.
</div><p></p>

<h4 class="heading settled heading" data-level=4.2.1 id=the-animation-stack><span class=secno>4.2.1 </span><span class=content>The animation stack</span><a class=self-link href=#the-animation-stack></a></h4>

<p>Associated with each property <a data-link-type=dfn href=#target-property title="target property">targetted</a>
by one or more <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a> is an <dfn data-dfn-type=dfn data-noexport="" id=animation-stack>animation
stack<a class=self-link href=#animation-stack></a></dfn> that establishes the relative priority of the <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a>.</p>

<p>The relative priority of any two <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a>, <var>A</var> and <var>B</var>, within an <a data-link-type=dfn href=#animation-stack title="animation stack">animation
stack</a> is established by comparing the properties of the
<a data-link-type=dfn href=#animation title=animations>animations</a> applying <var>A</var> and <var>B</var> as follows:</p>

<ol><li data-md=""><p>Let the <dfn data-dfn-type=dfn data-noexport="" id=associated-player-of-an-animation-effect>associated player of an animation effect<a class=self-link href=#associated-player-of-an-animation-effect></a></dfn>
be the <a data-link-type=dfn href=#player title=player>player</a> <a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated</a> with the
<a data-link-type=dfn href=#animation title=animation>animation</a> that is applying the <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> to
the property with which this <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> is
associated.</p>
<li data-md=""><p>Sort <var>A</var> and <var>B</var> by applying the following
conditions in turn until the order is resolved,</p>

<ol><li data-md=""><p>Sort <var>A</var> and <var>B</var> using any <a data-link-type=dfn href=#custom-player-priority title="custom player priority">custom
player priority</a> specified for the <a data-link-type=dfn href=#associated-player-of-an-animation-effect title="associated player of an animation effect">associated
player</a> of each of <var>A</var> and
<var>B</var> so that lower priorities sort first.</p>
<li data-md=""><p>Sort by the <a data-link-type=dfn href=#player-sequence-number title="player sequence number">player sequence number</a> so that lower
sequence numbers sort first.</p>
<li data-md=""><p>Sort <var>A</var> and <var>B</var> in <a data-link-type=dfn href=#tree-order title="tree order">tree order</a>.
(By this point, <var>A</var> and <var>B</var> must have the
same <a data-link-type=dfn href=#player title=player>player</a> since otherwise the order would have been
resolved in the previous step.)</p>
</ol></ol>
<p><a data-link-type=dfn href=#animation-effect title="Animation effects">Animation effects</a> that sort earlier have <em>lower</em>
priority.</p>

<h5 class="heading settled heading" data-level=4.2.1.1 id=the-custom-player-priority><span class=secno>4.2.1.1 </span><span class=content>The custom player priority</span><a class=self-link href=#the-custom-player-priority></a></h5>

<p>Each <a data-link-type=dfn href=#player title=player>player</a> has an associated numeric <dfn data-dfn-type=dfn data-noexport="" id=custom-player-priority>custom player
priority<a class=self-link href=#custom-player-priority></a></dfn> that is used to provide high-level control of
animation priority for specifications layered on top of Web
Animations.
The initial value of the <a data-link-type=dfn href=#custom-player-priority title="custom player priority">custom player priority</a> is zero.</p>

<div class=note>
Note: the <a data-link-type=dfn href=#custom-player-priority title="custom player priority">custom player priority</a> is primarily
    intended to be used to prioritize animations at
    a high-level, such as to prioritize animations <em>by type</em>.
    For example, it can be used to ensure that CSS Animations always
    override CSS Transitions.

<p>It is possible to control animation priority at a lower-level by
    setting the <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> appropriately,
    (possibly after making compensatory adjustments to the <a data-link-type=dfn href=#start-delay title="start delay">start
    delay</a> of the <a data-link-type=dfn href=#source-content title="source content">source content</a>) or influencing the
    <a data-link-type=dfn href=#player-sequence-number title="player sequence number">player sequence number</a> by controlling when <a data-link-type=dfn href=#player title=players>players</a>
    are created.</p>
</div>

<h4 class="heading settled heading" data-level=4.2.2 id=calculating-the-result-of-an-animation-stack><span class=secno>4.2.2 </span><span class=content>Calculating the result of an animation stack</span><a class=self-link href=#calculating-the-result-of-an-animation-stack></a></h4>

<p>In order to calculate the final value of an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a>,
the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> of each
<a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> in the stack are combined in order of priority
from lowest to highest priority.</p>

<p>Each step in the process of evaluating an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> takes
an <dfn data-dfn-type=dfn data-noexport="" id=underlying-value>underlying value<a class=self-link href=#underlying-value></a></dfn> as input.</p>

<p>For each <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> in the stack, the appropriate
<a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> from the <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>
is combined with the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> to produce a new value.
This resulting value becomes the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> for combining
the next <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> in the stack.</p>

<p>The final value of an <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a>, called the
<dfn data-dfn-type=dfn data-noexport="" id=composited-value>composited value<a class=self-link href=#composited-value></a></dfn>, is simply the result of combining the
<a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> of the final (highest priority)
<a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> in the stack with the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a>
at that point.</p>

<h4 class="heading settled heading" data-level=4.2.3 id=animation-composition><span class=secno>4.2.3 </span><span class=content>Animation composition</span><a class=self-link href=#animation-composition></a></h4>

<p>The specific operation used to combine an <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation
value</a> with an <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> is determined by the
<dfn data-dfn-type=dfn data-noexport="" id=composite-operation>composite operation<a class=self-link href=#composite-operation></a></dfn> of the <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a> that
produced the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a>.</p>

<p>This specification defines three <a data-link-type=dfn href=#composite-operation title="composite operations">composite operations</a> as
follows:</p>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=composite-operation-replace title="composite operation replace">replace<a class=self-link href=#composite-operation-replace></a></dfn></p>
<dd data-md=""><p>The result of compositing the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a>
with the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> is simply the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate
animation value</a>.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=composite-operation-add title="composite operation add">add<a class=self-link href=#composite-operation-add></a></dfn></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> is <a data-link-type=dfn href=#animation-addition title="animation addition">added</a> to the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying
value</a>.
For <a data-link-type=dfn href=#animation-behavior title="animation behaviors">animation behaviors</a> where the
<a data-link-type=dfn href=#animation-addition title="animation addition">addition operation</a> is defined
such that it is not commutative, the order of the operands is
<code><a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> + <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation
value</a></code>.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=composite-operation-accumulate title="composite operation accumulate">accumulate<a class=self-link href=#composite-operation-accumulate></a></dfn></dt><p></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> is <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulated</a>
onto the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a>.
For <a data-link-type=dfn title="animation behaviours">animation behaviours</a> where the
<a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation operation</a> is
defined such that it is not commutative, the order of the operands
is <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> followed by <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation
value</a>.</p>
</dl>
<h4 class="heading settled heading" data-level=4.2.4 id=applying-the-composited-result><span class=secno>4.2.4 </span><span class=content>Applying the composited result</span><a class=self-link href=#applying-the-composited-result></a></h4>

<p>The process for a applying a <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> depends on if the
<a data-link-type=dfn href=#target-property title="target property">target property</a> refers to a CSS property or a DOM attribute.</p>

<h5 class="heading settled heading" data-level=4.2.4.1 id=applying-the-result-to-a-css-property><span class=secno>4.2.4.1 </span><span class=content>Applying the result to a CSS property</span><a class=self-link href=#applying-the-result-to-a-css-property></a></h5>

<p>Applying a <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> to a CSS <a data-link-type=dfn href=#target-property title="target property">target property</a>
depends on establishing an <a data-link-type=dfn href=#animation-stylesheet title="animation stylesheet">animation stylesheet</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=animation-stylesheet>animation stylesheet<a class=self-link href=#animation-stylesheet></a></dfn> contains
<a data-link-type=dfn href=#composited-value title="composited value">composited animation values</a>
and acts with a higher priority than all other stylesheets.
However, <code>!important</code> rules from all other stylesheets
act with a higher priority than the <a data-link-type=dfn href=#animation-stylesheet title="animation stylesheet">animation stylesheet</a>.
The <a data-link-type=dfn href=#animation-stylesheet title="animation stylesheet">animation stylesheet</a> is regenerated each time the
<a data-link-type=dfn title="animation model">animation model</a> is updated (see <a data-section="" href=#animation-effects>§4.1 Animation effects</a>).</p>

<p>The <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> calculated for a CSS <a data-link-type=dfn href=#target-property title="target property">target
property</a> is applied using the following process.</p>

<ol><li data-md=""><p>Calculate the <var>base value</var> of the property as
the value generated for that property by computing the <a href=http://www.w3.org/TR/CSS2/cascade.html#used-value>used
value</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-css21 title=biblio-CSS21>[CSS21]</a> for that property in the absence of the
<a data-link-type=dfn href=#animation-stylesheet title="animation stylesheet">animation stylesheet</a>.</p>
<li data-md=""><p>Establish the <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> for the property (see <a data-section="" href=#the-animation-stack>§4.2.1 The animation stack</a>).</p>
<li data-md=""><p>Calculate the <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> of the <a data-link-type=dfn href=#animation-stack title="animation stack">animation
stack</a> passing in the <var>base value</var> of the property
as the initial <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> (see <a href=#calculating-the-result-of-an-animation-stack sectionU00022=""></a>).</p>
<li data-md=""><p>Insert the <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> into the <a data-link-type=dfn href=#animation-stylesheet title="animation stylesheet">animation
stylesheet</a>.</p>
</ol>
<h5 class="heading settled heading" data-level=4.2.4.2 id=applying-the-composited-result-to-a-dom-attribute><span class=secno>4.2.4.2 </span><span class=content>Applying the composited result to a DOM attribute</span><a class=self-link href=#applying-the-composited-result-to-a-dom-attribute></a></h5>

<p>DOM attributes are, unless otherwise specified, <a data-link-type=dfn href=#not-animatable0 title="not animatable">not
animatable</a>.
For each attribute that has a specific <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>
associated with it, an attribute value to use when the attribute is
not specified or in error must be defined, referred to as the
<dfn data-dfn-type=dfn data-noexport="" id=lacuna-value>lacuna value<a class=self-link href=#lacuna-value></a></dfn>.
For example, SVG2 (<a data-biblio-type=informative data-link-type=biblio href=#biblio-svg2 title=biblio-SVG2>[SVG2]</a>) defines <a href=http://www.w3.org/TR/SVG2/intro.html#TermLacunaValue>lacunae
values</a> for its attributes.</p>

<p>The <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> calculated for a DOM attribute <a data-link-type=dfn href=#target-property title="target property">target
property</a> is applied using the following process.</p>

<ol><li data-md=""><p>Let the <var>base value</var> of the property be the value
specified for attribute in the DOM or,
if the attribute value is not specified in the DOM, the
<a data-link-type=dfn href=#lacuna-value title="lacuna value">lacuna value</a> for that attribute.</p>
<li data-md=""><p>Establish the <a data-link-type=dfn href=#animation-stack title="animation stack">animation stack</a> for the property (see <a data-section="" href=#the-animation-stack>§4.2.1 The animation stack</a>).</li><p></p>
<li data-md=""><p>Calculate the <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> of the <a data-link-type=dfn href=#animation-stack title="animation stack">animation
stack</a> passing in the <var>base value</var> of the attribute
as the initial <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> (see <a data-section="" href=#calculating-the-result-of-an-animation-stack>§4.2.2 Calculating the result of an animation stack</a>).</li><p></p>
<li data-md=""><p>Record the <a data-link-type=dfn href=#composited-value title="composited value">composited value</a> as the <dfn data-dfn-type=dfn data-noexport="" id=animated-attribute-value>animated
attribute value<a class=self-link href=#animated-attribute-value></a></dfn> of the attribute.</p>
</ol>
<p>The <a data-link-type=dfn href=#animated-attribute-value title="animated attribute value">animated attribute value</a> does not replace the value of
the attribute in the DOM although it may be accessible via some
other interface.
For all intents and purposes other than interaction with DOM
interfaces, user agents must treat the <a data-link-type=dfn href=#animated-attribute-value title="animated attribute value">animated attribute
value</a> as the attribute value.</p>

<h4 class="heading settled heading" data-level=4.2.5 id=animation-accumulation><span class=secno>4.2.5 </span><span class=content>Animation accumulation</span><a class=self-link href=#animation-accumulation></a></h4>

<p>Similar to the compositing performed between <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation
values</a> (see <a data-section="" href=#animation-composition>§4.2.3 Animation composition</a>), the <dfn data-dfn-type=dfn data-noexport="" id=iteration-composite-operation>iteration composite operation<a class=self-link href=#iteration-composite-operation></a></dfn>
determines how values are combined between successive iterations of
the same <a data-link-type=dfn href=#animation title=animation>animation</a>.</p>

<p>This specification defines two <a data-link-type=dfn href=#iteration-composite-operation title="iteration composite operations">iteration composite operations</a>
as follows:</p>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=iteration-composite-operation-replace title="iteration composite operation replace">replace<a class=self-link href=#iteration-composite-operation-replace></a></dfn></p>
<dd data-md=""><p>Each successive iteration is calculated independently of previous
iterations.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=iteration-composite-operation-accumulate title="iteration composite operation accumulate">accumulate<a class=self-link href=#iteration-composite-operation-accumulate></a></dfn></p>
<dd data-md=""><p>Successive iterations of the animation are <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulated</a> with the
final value of the previous iteration.</p>

<p>The application of the <a data-link-type=dfn href=#iteration-composite-operation title="iteration composite operation">iteration composite operation</a> is
incorporated in the calculation of the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation
value</a> for each type of <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>.</p>
</dl>
<h3 class="heading settled heading" data-level=4.3 id=keyframe-animation-effects><span class=secno>4.3 </span><span class=content>Keyframe animation effects</span><a class=self-link href=#keyframe-animation-effects></a></h3>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=keyframe-animation-effect>keyframe animation effect<a class=self-link href=#keyframe-animation-effect></a></dfn> is an <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>
that produces <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation values">intermediate animation values</a> for its <a data-link-type=dfn href=#target-property title="target properties">target
properties</a> by interpolating between a series of property values
positioned at fractional offsets.</p>

<p>Each set of property values indexed by an offset is called
a <dfn data-dfn-type=dfn data-noexport="" id=keyframe>keyframe<a class=self-link href=#keyframe></a></dfn>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=keyframe-offset title="keyframe offset">offset of a keyframe<a class=self-link href=#keyframe-offset></a></dfn> is a value
in the range [0, 1] or the special value null.
The list of <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> for a <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a> is
<dfn data-dfn-type=dfn data-noexport="" id=loosely-sorted-by-offset>loosely sorted by offset<a class=self-link href=#loosely-sorted-by-offset></a></dfn> which means that for each
<a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in the list that has a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> that is
not null, the offset is greater than or equal to the offset of the
previous <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in the list with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> that
is not null, if any.</p>

<p>The behavior when <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> overlap or have unsupported values
is defined in <a data-section="" href=#the-intermediate-animation-value-of-a-keyframe-animation-effect>§4.3.2 The intermediate animation value of a keyframe animation effect</a>.</p>

<p>Each keyframe also has a <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> associated with it
that is applied to the period of time between the keyframe on which it
is specified and the <em>next</em> keyframe in the list.
The <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> specified on the last keyframe in the
list is never applied.</p>

<p>In addition to the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> specified on the
<a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>, each <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> may also have an
associated <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> that is applied to all values
specified in that <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a>.
If no <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> is specified for a <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a>,
the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> specified for the <a data-link-type=dfn href=#animation-effect title="animation effect">animation
effect</a> is used.</p>

<h4 class="heading settled heading" data-level=4.3.1 id=spacing-keyframes><span class=secno>4.3.1 </span><span class=content>Spacing keyframes</span><a class=self-link href=#spacing-keyframes></a></h4>
<div class=informative>

<p>It is often useful to be able to provide a series of property values
without having calculate the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of each value in
time but instead to rely on some automatic spacing.</p>

<p>For example, rather than typing:</p>

<pre class="example sh_javascript">elem.animate([ { color: 'blue', offset: 0 },
               { color: 'green', offset: 1/3 },
               { color: 'red', offset: 2/3 },
               { color: 'yellow', offset: 1 } ], 2000);
</pre>

<p>It should be possible to type the following and allow the user agent
to calculate the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">offset</a> of each
keyframe:</p>

<pre class="example sh_javascript">elem.animate([ { color: 'blue' },
               { color: 'green' },
               { color: 'red' },
               { color: 'yellow' } ], 2000);
</pre>

<p>Web Animations provides spacing modes for this purpose. The default
spacing mode for keyframe animation effects is
“<a data-link-type=dfn href=#distribute-keyframe-spacing-mode title="distribute keyframe spacing mode">distribute</a>” which
produces the result described above.</p>

<p>The other spacing mode, “<a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a>”, is useful when
it is desirable to maintain an even rate of change such as for <a href=#motion-path-animation-effects>motion path animation</a>.</p>

<p>For example, consider the following animation:</p>

<pre class="example sh_javascript">elem.animate([ { left: '0px' },
               { left: '-20px' },
               { left: '100px' },
               { left: '50px' } ], 1000);
</pre>

<p>The resulting value of the <span class=prop-name>left</span>
property is illustrated below:</p>

<div class=figure>
<img alt="The animated value of the left property over time when applying the distribute spacing mode.
The values are evenly spaced in time but the rate of change differs for each segment as indicated the varying slope of the graph." src=img/spacing-distribute.svg width=350>
</div>
<p class=caption>
The animated value of the left property over time when applying the
<a data-link-type=dfn href=#distribute-keyframe-spacing-mode title="distribute keyframe spacing mode">distribute</a> spacing
mode.
The values are evenly spaced in time but the rate of change differs
for each segment as indicated the varying slope of the graph.
</p>

<p>We can use the <a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a>
spacing mode as follows:</p>

<pre class="example sh_javascript">elem.animate(
  new KeyframeEffect([ { left: '0px' },
                       { left: '-20px' },
                       { left: '100px' },
                       { left: '50px' } ], { spacing: "paced" }), 1000);
</pre>

<p>The result is illustrated below:</p>

<div class=figure>
<img alt="The animated value of the left property over time when applying the paced spacing mode.
The absolute value of the slope is graph is equal for all segments of the animation indicating a constant rate of change." src=img/spacing-paced.svg width=350>
</div>
<p class=caption>
The animated value of the left property over time when applying the
<a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a> spacing mode.
The absolute value of the slope is graph is equal for all segments
of the animation indicating a constant rate of change.
</p>

<p>It is also possible to combine fixed <a data-link-type=dfn href=#keyframe-offset title="keyframe offsets">keyframe offsets</a> with
spacing modes as follows:</p>

<pre class="example sh_javascript">elem.animate(
  new KeyframeEffect([ { left: '0px' },
                       { left: '-20px' },
                       { left: '100px', offset: 0.5 },
                       { left: '50px' } ], { spacing: "paced" }), 1000);
</pre>

<p>The result is illustrated below:</p>

<div class=figure>
<img alt="The animated value of the left property over time when applying the paced spacing mode and a fixed offset that puts the 100px value at 0.5.
The slope of the graph is equal for the first two segments but changes for the last segment in order to accommodate the fixed offset." src=img/spacing-paced-with-offset.svg width=350>
</div>
<p class=caption>
The animated value of the left property over time when applying the
<a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a> spacing mode and
a fixed <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> that
puts the 100px value at 0.5.
The slope of the graph is equal for the first two segments but
changes for the last segment in order to accommodate the fixed
offset.
</p>
</div>

<p>Before calculating animation values from a <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation
effect</a>, an absolute value must be computed for the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe
offset</a> of each <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> with a null offset.
The values computed depend on the <dfn data-dfn-type=dfn data-noexport="" id=keyframe-spacing-mode>keyframe spacing mode<a class=self-link href=#keyframe-spacing-mode></a></dfn>
specified for the <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a>.
The keyframe spacing modes are:</p>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=distribute-keyframe-spacing-mode title="distribute keyframe spacing mode">distribute<a class=self-link href=#distribute-keyframe-spacing-mode></a></dfn></dt><p></p>
<dd data-md=""><p>Indicates that <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> with a null <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a>
null are positioned so that the difference between subsequent
<a data-link-type=dfn href=#keyframe-offset title="keyframe offsets">keyframe offsets</a> are equal.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced<a class=self-link href=#paced-keyframe-spacing-mode></a></dfn></dt><p></p>
<dd data-md=""><p>Indicates that <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> with a null <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a>
null are positioned so that the <em>distance</em> between subsequent
values of a specified <dfn data-dfn-type=dfn data-noexport="" id=paced-property>paced property<a class=self-link href=#paced-property></a></dfn> are equal.
The distance is calculated using the <a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a>
procedure defined by the <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> associated
with the <a data-link-type=dfn href=#paced-property title="paced property">paced property</a>.</p>
</dl>
<h5 class="heading settled heading" data-level=4.3.1.1 id=applying-spacing-to-keyframes><span class=secno>4.3.1.1 </span><span class=content>Applying spacing to keyframes</span><a class=self-link href=#applying-spacing-to-keyframes></a></h5>

<p>We define a generic procedure for <dfn data-dfn-type=dfn data-noexport="" id=evenly-distributing-a-keyframe>evenly distributing
a keyframe<a class=self-link href=#evenly-distributing-a-keyframe></a></dfn>, <var>keyframe</var>, between two reference
keyframes, <var>start</var> and <var>end</var>, whose <a data-link-type=dfn href=#keyframe-offset title="keyframe offsets">keyframe
offsets</a> are <em>not</em> null, as follows:</p>

<ol><li data-md=""><p>Let <dfn data-dfn-type=dfn data-noexport="" id=offsetk>offset<sub><var>k</var></sub><a class=self-link href=#offsetk></a></dfn> be the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe
offset</a> of a <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> <var>k</var>.</p>
<li data-md=""><p>Let <var>n</var> be the number of keyframes <em>between</em> and
including <var>start</var> and <var>end</var> minus 1.</p>
<li data-md=""><p>Let <var>index</var> refer to the position of
<var>keyframe</var> in the sequence of keyframes between
<var>start</var> and <var>end</var> such that the first keyframe
after <var>start</var> has an <var>index</var> of 1.</p>
<li data-md=""><p>Set the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of <var>keyframe</var> to
<a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>start</var></sub> +
(<a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>end</var></sub> −
 <a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>start</var></sub>)
× <var>index</var> / <var>n</var>.</p>
</ol>
<p>The computed <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> values of each <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a>
with a null keyframe offset are determined using the following
procedure.</p>

<ol><li data-md=""><p>Let <var>keyframes</var> refer to the list of <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a>
associated with the <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a>.</p>
<li data-md=""><p>If <var>keyframes</var> contains more than one
<a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> and the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
the first <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>keyframes</var> is null,
set the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
the first <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> to 0.</p>
<li data-md=""><p>If the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of the last <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in
<var>distributed keyframes</var> is null, set its
<a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> to 1.</p>
<li data-md=""><p>For each pair of <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> <var>A</var> and <var>B</var>
where:</p>

<ol><li data-md=""><p><var>A</var> appears before <var>B</var> in
<var>keyframes</var>, and</p>
<li data-md=""><p><var>A</var> and <var>B</var> have a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe
offset</a> that is not null, and</p>
<li data-md=""><p>all <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> between <var>A</var> and <var>B</var>
have a null <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a>,</p>
</ol>
<p>calculate the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
each <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> between <var>A</var> and <var>B</var>
depending on the <a data-link-type=dfn href=#keyframe-spacing-mode title="keyframe spacing mode">keyframe spacing mode</a> as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#keyframe-spacing-mode title="keyframe spacing mode">spacing mode</a>
is <a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a>,</dt><p></p>
<dd data-md="">

<ol><li data-md=""><p>Define a keyframe as <dfn data-dfn-type=dfn data-noexport="" id=paceable>paceable<a class=self-link href=#paceable></a></dfn> if it
contains a value for the <a data-link-type=dfn href=#paced-property title="paced property">paced property</a>.</p>
<li data-md=""><p>Let <var>paced A</var> be the first keyframe in the
range [<var>A</var>, <var>B</var>] that is
<a data-link-type=dfn href=#paceable title=paceable>paceable</a>, if any.</p>
<li data-md=""><p>Let <var>paced B</var> be the last keyframe in the
range [<var>A</var>, <var>B</var>] that is
<a data-link-type=dfn href=#paceable title=paceable>paceable</a>, if any.</p>
<li data-md=""><p>If there is no <var>paced A</var> or <var>paced
B</var> let both refer to <var>B</var>.

<span>Note that in this case, the spacing
behavior degenerates to <a data-link-type=dfn href=#distribute-keyframe-spacing-mode title="distribute keyframe spacing mode">distribute</a>
spacing.</span></p>
<li data-md=""><p>For each keyframe in the range
(<var>A</var>, <var>paced A</var>] and
[<var>paced B</var>, <var>B</var>),
apply the procedure for <a data-link-type=dfn href=#evenly-distributing-a-keyframe title="evenly distributing a keyframe">evenly distributing
a keyframe</a> using <var>A</var> and <var>B</var> as
the <var>start</var> and <var>end</var> keyframes
respectively.</p>

<div class=annotation>
Yes, this is correct.
We want, <var>index</var> and <var>n</var> in that
procedure to reflect <em>all</em> the keyframes
between <var>A</var> and <var>B</var>, not just the
keyframes between, for example, <var>A</var> and
<var>spaced A</var>.
</div>

<li data-md=""><p>For each keyframe in the range
(<var>paced A</var>, <var>paced B</var>) that is
<a data-link-type=dfn href=#paceable title=paceable>paceable</a>:</p>

<ol><li data-md=""><p>Let
<dfn data-dfn-type=dfn data-noexport="" id=distk>dist<sub><var>k</var></sub><a class=self-link href=#distk></a></dfn>
represent the cumulative distance to a keyframe
<var>k</var> from <var>paced A</var>
as calculated by applying the <a data-link-type=dfn href=#distance-computation title="distance computation">distance
computation</a> defined by the <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation
behavior</a> of the <a data-link-type=dfn href=#paced-property title="paced property">paced property</a> to the
values of the <a data-link-type=dfn href=#paced-property title="paced property">paced property</a> on each pair of
successive <a data-link-type=dfn href=#paceable title=paceable>paceable</a> keyframes in the range
[<var>paced A</var>, <var>k</var>].</p>
<li data-md=""><p>Set the offset of <var>k</var> to
<a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>paced
  A</var></sub>
+
(<a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>paced
  B</var></sub>
− 
<a data-link-type=dfn href=#offsetk title=offsetk>offset</a><sub><var>paced
  A</var></sub>)
×
<a data-link-type=dfn href=#distk title=distk>dist</a><sub><var>k</var></sub>
/
<a data-link-type=dfn href=#distk title=distk>dist</a><sub><var>paced
  B</var></sub></p>
</ol><li data-md=""><p>For each keyframe in the range (<var>paced A</var>,
<var>paced B</var>) that still has
a null <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> (because it is not
<a data-link-type=dfn href=#paceable title=paceable>paceable</a>), apply the procedure
for <a data-link-type=dfn href=#evenly-distributing-a-keyframe title="evenly distributing a keyframe">evenly distributing a keyframe</a> using
the nearest <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> before and after the
keyframe in question in <var>keyframes</var> that has
a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> that is not null, as the
<var>start</var> and <var>end</var> keyframes
respectively.</p>
</ol><dt data-md=""><p>Otherwise,</dt><p></p>
<dd data-md=""><p>Apply the procedure for <a data-link-type=dfn href=#evenly-distributing-a-keyframe title="evenly distributing a keyframe">evenly distributing
a keyframe</a> to each keyframe in the range (<var>A</var>,
<var>B</var>) using <var>A</var> and <var>B</var> as the
<var>start</var> and <var>end</var> keyframes respectively.</p>
</dl>
</div>
</ol>
<p class=note>Note: although the above procedure defines computing keyframe
    offsets in terms of overwriting null values, user agents that
    implement the <a href=#programming-interface>programming
    interface</a> are required to maintain the original null values as
    well as calculating the computed offsets.
    This is because the <code>getFrames</code> method of the
    <a data-link-type=dfn title=KeyframeEffect>KeyframeEffect</a> interface returns keyframe offsets both
    before and after applying spacing.</p>

<p class=issue id=issue-867fbc9b><a class=self-link href=#issue-867fbc9b></a>The above algorithm is quite complex.
    It attempts to cover all possible combinations of input where
    keyframe offsets and or paced property values may be missing.
    Furthermore, it attempts to do this in a way that degenerates
    consistently and also allows the author to combine fixed offsets
    with either pacing or distribute spacing.
    We await implementation experience to determine if the complexity
    is justified.</p>

<h4 class="heading settled heading" data-level=4.3.2 id=the-intermediate-animation-value-of-a-keyframe-animation-effect><span class=secno>4.3.2 </span><span class=content>The intermediate animation value of a keyframe animation effect</span><a class=self-link href=#the-intermediate-animation-value-of-a-keyframe-animation-effect></a></h4>

<p>The <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> of a single property
referenced by a <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a> as one of its
<a data-link-type=dfn href=#target-property title="target property">target properties</a>, for a given
<var>time fraction</var>, <var>current iteration</var> and
<var>underlying value</var> is calculated as follows.</p>

<ol><li data-md=""><p>Let <var>target property</var> be the property for which the
<a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> is to be calculated.</p>
<li data-md=""><p>If <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> of the <var>target property</var> is
<a data-link-type=dfn href=#not-animatable0 title="not animatable">not animatable</a> abort this procedure since the effect cannot
be applied.</p>
<li data-md=""><p>Define the <dfn data-dfn-type=dfn data-noexport="" id=neutral-value-for-composition>neutral value for composition<a class=self-link href=#neutral-value-for-composition></a></dfn> as a value
which, when combined with an <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a> using the <a data-link-type=dfn href=#composite-operation-add title="composite operation add">add</a> <a data-link-type=dfn href=#composite-operation title="composite operation">composite
operation</a>, produces the <a data-link-type=dfn href=#underlying-value title="underlying value">underlying value</a>.</p>
<li data-md=""><p>Let <var>property-specific keyframes</var> be a copy of the list
of <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> specified on the effect.</p>
<li data-md=""><p>Remove any <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> from <var>property-specific
keyframes</var> that do not have a property value for
<var>target property</var>.</p>
<li data-md=""><p>If <var>property-specific keyframes</var> is empty, return
<var>underlying value</var>.</p>
<li data-md=""><p>If there is no <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
0, create a new <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
0, a property value set to the <a data-link-type=dfn href=#neutral-value-for-composition title="neutral value for composition">neutral value for
composition</a>, and a <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of <a data-link-type=dfn href=#composite-operation-add title="composite operation add">add</a>, and prepend it to the
beginning of <var>property-specific keyframes</var>.</p>
<li data-md=""><p>Similarly, if there is no <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in
<var>property-specific keyframes</var> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe
offset</a> of 1,
create a new <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of 1,
a property value set to the <a data-link-type=dfn href=#neutral-value-for-composition title="neutral value for composition">neutral value for composition</a>,
and a <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of <a data-link-type=dfn href=#composite-operation-add title="composite operation add">add</a>, and append it to the
end of <var>property-specific keyframes</var>.</p>
<li data-md=""><p>Let <var>interval endpoints</var> be an empty sequence of
keyframes.</p>
<li data-md=""><p>Populate <var>interval points</var> by following the steps from
the first matching condition from below:</p>

<div class=switch>

<dl><dt data-md=""><p>If <var>time fraction</var> &lt; 0 and there is more
than one <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
0,</p>
<dd data-md=""><p>Add the first <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> to <var>interval endpoints</var>.</p>
<dt data-md=""><p>If <var>time fraction</var> ≥ 1 and there is more
than one <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> with a <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
1,</p>
<dd data-md=""><p>Add the last <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> to <var>interval endpoints</var>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md="">

<ol><li data-md=""><p>Append to <var>interval endpoints</var> the last
<a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific
keyframes</var> whose <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> is less than
or equal to <var>time fraction</var> and less than 1.  If
there is no such <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> (because, for example,
the <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> is negative), add the last
<a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> whose <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> is 0.</p>
<li data-md=""><p>Append to <var>interval endpoints</var> the next
<a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>property-specific keyframes</var>
after the one added in the previous step.</p>
</ol></dl>
</div>

<li data-md=""><p>For each <var>keyframe</var> in <var>interval endpoints</var>:</p>

<ol><li data-md=""><p>If <var>keyframe</var> has a <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a>
that is <em>not</em> <a data-link-type=dfn href=#composite-operation-replace title="composite operation replace">replace</a>, or
<var>keyframe</var> has no <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a>
and the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of this <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe
animation effect</a> is <em>not</em> <a data-link-type=dfn href=#composite-operation-replace title="composite operation replace">replace</a>, then
perform the following steps:</p>

<ol><li data-md=""><p>Let <var>composite operation to use</var> be the
<a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of <var>keyframe</var>, or if
it has none, the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of this
<a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a>.</p>
<li data-md=""><p>Let <var>value to combine</var> be the property value of
<var>target property</var> specified on
<var>keyframe</var>.</p>
<li data-md=""><p>Replace the property value of <var>target property</var>
on <var>keyframe</var> with the result of combining
<var>underlying value</var> (<var>V</var><sub>a</sub>) and
<var>value to combine</var> (<var>V</var><sub>b</sub>)
using the <var>composite operation to use</var>
procedure defined by the <var>target property</var>’s
<a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a>.</p>
</ol>
<li data-md=""><p>If this <a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effect">keyframe animation effect</a> has an <a data-link-type=dfn href=#iteration-composite-operation title="iteration composite operation">iteration
composite operation</a> of <a data-link-type=dfn href=#iteration-composite-operation-accumulate title="iteration composite operation accumulate">accumulate</a>,
apply the following step <var>current iteration</var> times:</p>

<ul><li data-md=""><p>replace the property value of <var>target property</var>
on <var>keyframe</var> with the result of combining the
property value (<var>V</var><sub>a</sub>) with the
property value on the final keyframe in
<var>property-specific keyframes</var>
(<var>V</var><sub>b</sub>) using the <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation procedure</a>
defined for <var>target property</var>.</p>
</ul>
<p class=issue id=issue-8b7cca9f><a class=self-link href=#issue-8b7cca9f></a>It seems like this could be done as a separate step at the end
    and applied to all types of animation effects consistently.</p>
</ol>
<li data-md=""><p>If there is only one keyframe in <var>interval endpoints</var>
return the property value of <var>target property</var> on that
keyframe.</p>
<li data-md=""><p>Let <var>start offset</var> be the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of the
first keyframe in <var>interval endpoints</var>.</p>
<li data-md=""><p>Let <var>end offset</var> be the <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> of
last keyframe in <var>interval endpoints</var>.</p>
<li data-md=""><p>Let <var>interval distance</var> be the result of evaluating
<code>(<var>time fraction</var> - <var>start offset</var>) /
(<var>end offset</var> - <var>start offset</var>)</code></p>
<li data-md=""><p>Return the result of applying the <a data-link-type=dfn href=#animation-interpolation title="animation interpolation">interpolation procedure</a> defined
by the <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> of the <var>target property</var>,
to the values of the <var>target property</var> specified on the
two keyframes in <var>interval endpoints</var> taking the first such
value as <var>V</var><sub>start</sub> and the second as
<var>V</var><sub>end</sub> and using <var>interval
distance</var> as the interpolation parameter <var>p</var>.</p>
</ol>
<div class=note>
    Note that this procedure assumes the following about the list of
    <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> specified on the effect:<p></p>

<ul><li data-md=""><p>Each <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> has a specified <a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a> in
the range [0, 1].</p>
<li data-md=""><p>The list of <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a> is sorted in ascending order by
<a data-link-type=dfn href=#keyframe-offset title="keyframe offset">keyframe offset</a>.</p>
<li data-md=""><p>Each specified property value is a valid and supported value.</p>
<li data-md=""><p>For a given property, there is a most one specified property
value on each keyframe.</p>
</ul>
<p>It is the responsibility of the user of the model (for example,
    a declarative markup or programming interface) to ensure these
    conditions are met.</p>

<p>For example, for the <a href=#programming-interface>programming
    interface</a> defined by this specification, these conditions are
    met by applying the normalization defined in <a data-section="" href=#normalizing-a-sequence-of-keyframes></a>
    and resolving <code>null</code> <a data-link-type=dfn href=#keyframe-offset title="keyframe offsets">keyframe offsets</a> by
    applying <a href=#spacing-keyframes>spacing behavior</a>.</p>
</div>

<p class=note>Note: this procedure permits overlapping <a data-link-type=dfn href=#keyframe title=keyframes>keyframes</a>.
    The behavior is that at the point of overlap the output value jumps to
    the value of the last defined <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> at that offset.
    For overlapping frames at 0 or 1, the output value for <a data-link-type=dfn href=#time-fraction title="time fraction">time fractions</a> less than 0 or greater than
    or equal to 1 is the value of the first <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> or the last
    <a data-link-type=dfn href=#keyframe title=keyframe>keyframe</a> in <var>keyframes</var> respectively.</p>

<div class=issue id=issue-73bc0c24><a class=self-link href=#issue-73bc0c24></a>
    In the presence of certain timing functions, the input time
    fraction to an animation effect is not limited to the range [0, 1].
    Currently, however, keyframe offsets <em>are</em> limited to the
    range [0, 1] and property values are simply extrapolated for input
    time fractions outside this range.

<p>We have considered removing this restriction since some cases exist
    where it is useful to be able to specify non-linear
    changes in property values at time fractions outside the range
    [0, 1].
    One example is an animation that interpolates from green to yellow
    but has an overshoot timing function that makes it temporarily
    interpolate ‘beyond’ yellow to red before settling back
    to yellow.</p>

<p>While this effect could be achieved by modification of the keyframes
    and timing function, this approach seems to break the model’s
    separation of timing concerns from animation effects.</p>

<p>It is not clear how this effect should be achieved but we note that
    allowing keyframe offsets outside [0, 1] may make the currently
    specified behavior where keyframes at offset 0 and 1 are synthesized
    as necessary, inconsistent.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html>section
    4 (Keyframe offsets outside [0, 1]) of minuted discussion from Tokyo
      2013 F2F</a>.</p>
</div>

<h3 class="heading settled heading" data-level=4.4 id=motion-path-animation-effects><span class=secno>4.4 </span><span class=content>Motion path animation effects</span><a class=self-link href=#motion-path-animation-effects></a></h3>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=motion-path-animation-effect>motion path animation effect<a class=self-link href=#motion-path-animation-effect></a></dfn> is an <a data-link-type=dfn href=#animation-effect title="animation effect">animation effect</a>
that produces <a data-link-type=dfn title="animation values">animation values</a> for the transform <a data-link-type=dfn href=#target-property title="target property">target
property</a> of an <a data-link-type=dfn href=#animation-target title="animation target">animation target</a> such that it follows
a geometric curve commonly referred to as a “motion path”.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=motion-path>motion path<a class=self-link href=#motion-path></a></dfn> of a <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path animation effect</a> is
defined by an SVG Path, as specified by SVG <a data-biblio-type=normative data-link-type=biblio href=#biblio-svg2 title=biblio-SVG2>[SVG2]</a>.
A <a data-link-type=dfn href=#motion-path title="motion path">motion path</a> consists of a list of <dfn data-dfn-type=dfn data-noexport="" id=path-command title="path command">path commands<a class=self-link href=#path-command></a></dfn> (see <a href=http://www.w3.org/TR/SVG2/paths.html#PathData>path data</a>
<a data-biblio-type=normative data-link-type=biblio href=#biblio-svg2 title=biblio-SVG2>[SVG2]</a>).</p>

<p>Amongst the different types of path commands, we define
<dfn data-dfn-type=dfn data-noexport="" id=orientation-path-command title="orientation path command">orientation path commands<a class=self-link href=#orientation-path-command></a></dfn> as
<a href=http://www.w3.org/TR/SVG2/paths.html#PathDataMovetoCommands>moveto</a>
commands and <a href=http://www.w3.org/TR/SVG2/paths.html#PathDataBearingCommands>bearing</a>
commands.
All types of path commands that are <em>not</em> <a data-link-type=dfn href=#orientation-path-command title="orientation path commands">orientation
path commands</a> are referred to as <dfn data-dfn-type=dfn data-noexport="" id=drawing-path-command title="drawing path command">drawing path commands<a class=self-link href=#drawing-path-command></a></dfn>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=automatic-rotation-flag>automatic rotation flag<a class=self-link href=#automatic-rotation-flag></a></dfn> of a <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path animation
effect</a>, if set, specifies that the <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation
value</a> generated by the <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path animation effect</a> produces
a rotation that matches the directional tangent vector of the
<a data-link-type=dfn href=#motion-path title="motion path">motion path</a>.</p>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=rotation-angle>rotation angle<a class=self-link href=#rotation-angle></a></dfn> parameter of a <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path animation
effect</a> specifies a constant rotation that applies to the target
transform in addition to any rotation generated by setting the
<a data-link-type=dfn href=#automatic-rotation-flag title="automatic rotation flag">automatic rotation flag</a>.</p>

<h4 class="heading settled heading" data-level=4.4.1 id=distance-along-a-path><span class=secno>4.4.1 </span><span class=content>Distance along a path</span><a class=self-link href=#distance-along-a-path></a></h4>

<p>The procedure used for calculating the length of a path or
a subsection is provided by the definition of <a href=http://www.w3.org/TR/SVG2/paths.html#DistanceAlongAPath><dfn data-dfn-type=dfn data-noexport="" id=distance-along-a-path0>distance
along a path</dfn></a> in SVG <a data-biblio-type=normative data-link-type=biblio href=#biblio-svg2 title=biblio-SVG2>[SVG2]</a>.</p>

<h4 class="heading settled heading" data-level=4.4.2 id=spacing-motion-paths><span class=secno>4.4.2 </span><span class=content>Spacing motion paths</span><a class=self-link href=#spacing-motion-paths></a></h4>

<p>The following properties control the rate of progress of a <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion
path animation effect</a>:</p>

<dl><dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=motion-path-spacing-mode title="motion path spacing mode">spacing mode<a class=self-link href=#motion-path-spacing-mode></a></dfn></p>
<dd data-md=""><p>Specifies the strategy used for determining the offset of each
<a data-link-type=dfn href=#spacing-point title="spacing point">spacing point</a> or <a data-link-type=dfn href=#path-command title="path command">path command</a> when not specified by
a <a data-link-type=dfn href=#point-offset title="point offset">point offset</a>.
The possible spacing modes are identical to those defined for
<a data-link-type=dfn href=#keyframe-animation-effect title="keyframe animation effects">keyframe animation effects</a> (see <a data-section="" href=#spacing-keyframes>§4.3.1 Spacing keyframes</a>).</p>

<p>Note that a spacing mode of <a data-link-type=dfn href=#distribute-keyframe-spacing-mode title="distribute keyframe spacing mode">distribute</a> has no
effect if <a data-link-type=dfn href=#point-offset title="point offsets">point offsets</a> are specified.
This is because spacing <em>between</em> <a data-link-type=dfn href=#point-offset title="point offsets">point offsets</a>
always uses <a data-link-type=dfn href=#paced-keyframe-spacing-mode title="paced keyframe spacing mode">paced</a>
spacing mode.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=spacing-point title="spacing point">spacing points<a class=self-link href=#spacing-point></a></dfn></p>
<dd data-md=""><p>An optional sequence of real numbers in the range [0.0, 1.0] that
correspond to fractions of the total path length.
The animation effect produces animation values such that the
<a data-link-type=dfn href=#animation-target title="animation target">animation target</a> moves backwards and forwards along the
<a data-link-type=dfn href=#motion-path title="motion path">motion path</a> following the sequence indicated by these
points.</p>

<p>Furthermore, the point on the <a data-link-type=dfn href=#motion-path title="motion path">motion path</a> indicated by each
such number forms a handle that may be associated with a <a data-link-type=dfn href=#point-offset title="point offset">point
offset</a> or positioned by the <a data-link-type=dfn href=#motion-path-spacing-mode title="motion path spacing mode">spacing mode</a>.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=point-offset title="point offset">point offsets<a class=self-link href=#point-offset></a></dfn></p>
<dd data-md=""><p>An optional ordered sequence of real numbers in the range [0.0,
1.0] that specifies the <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> when the
corresponding <a data-link-type=dfn href=#spacing-point title="spacing point">spacing point</a>, or, if <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a>
are not provided, <a data-link-type=dfn href=#drawing-path-command title="drawing path command">drawing path command</a>, should be visited.</p>

<p>If specified, the first value in the sequence must be 0.0 and the
last value must be 1.0.
There must be as many items in the sequence of <a data-link-type=dfn href=#point-offset title="point offsets">point
offsets</a> as in the sequence of <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a>, if
provided.
If a sequence of <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> is not provided,
the number of items in <a data-link-type=dfn href=#point-offset title="point offsets">point offsets</a> must equal the number
of <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a> in the <a data-link-type=dfn href=#motion-path title="motion path">motion path</a> plus
one.</p>
<dt data-md=""><p><dfn data-dfn-type=dfn data-noexport="" id=point-easing>point easing<a class=self-link href=#point-easing></a></dfn></p>
<dd data-md=""><p>An optional ordered sequence of <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> that
specify the easing behavior between each pair of <a data-link-type=dfn href=#spacing-point title="spacing points">spacing
points</a>, or, if <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> are not provided, between
each pair of <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a>.</p>

<p>If specified, there must be as many items as in
the sequence of <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> minus one, if provided.
If a sequence of <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> is not provided,
the number of items in <a data-link-type=dfn href=#point-easing title="point easing">point easing</a> must equal the number
of <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a> in the <a data-link-type=dfn href=#motion-path title="motion path">motion path</a>.</p>
</dl>
<p class=note>Note: the above descriptions of the length of each list
    represent the requirements of the model.
    Users of the model such as markup or programming interfaces
    may fulfil these requirements, for example, by defining padding
    behavior or error handling.</p>

<p class=issue id=issue-04948125><a class=self-link href=#issue-04948125></a>Need a diagram here showing how the different combinations work.</p>

<h5 class="heading settled heading" data-level=4.4.2.1 id=applying-spacing-to-motion-paths><span class=secno>4.4.2.1 </span><span class=content>Applying spacing to motion paths</span><a class=self-link href=#applying-spacing-to-motion-paths></a></h5>

<p>The end result of applying spacing is:</p>

<ul><li data-md=""><p>a sequence of <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>,</p>
<li data-md=""><p>a sequence of <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a>, and</p>
<li data-md=""><p>a sequence of <a data-link-type=dfn href=#effective-point-easing title="effective point easing">effective point easing</a>
<a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a>.</p>
</ul>
<p>The sequence of <dfn data-dfn-type=dfn data-noexport="" id=effective-spacing-points>effective spacing points<a class=self-link href=#effective-spacing-points></a></dfn> is determined by
following the steps associated with the first matching condition
from below:</p>

<div class=switch>

<dl><dt data-md=""><p>If there are no <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a>,</p>
<dd data-md=""><p>Let <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> be an empty sequence.</p>
<dt data-md=""><p>If <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> is specified,</p>
<dd data-md=""><p>Let <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> refer to <a data-link-type=dfn href=#spacing-point title="spacing points">spacing
points</a>.</p>
<dt data-md=""><p>Otherwise,</dt><p></p>
<dd data-md=""><p>Perform the following steps:</p>

<ol><li data-md=""><p>Let <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> be a sequence
consisting of the single element 0.</p>
<li data-md=""><p>For each <a data-link-type=dfn href=#drawing-path-command title="drawing path command">drawing path command</a> in <a data-link-type=dfn href=#path-command title="path commands">path
commands</a>, append to <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>
a number equal to the <a data-link-type=dfn href=#distance-along-a-path0 title="distance along a path">distance along a path</a> up to
the point at the end of the given <a data-link-type=dfn href=#path-command title="path command">path command</a>,
divided by the total path length.</p>
</ol></dl>
</div>

<p>Having determined the <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>, the sequence
of <dfn data-dfn-type=dfn data-noexport="" id=effective-point-offsets>effective point offsets<a class=self-link href=#effective-point-offsets></a></dfn> is determined by following the
steps associated with the first matching condition from below:</p>

<div class=switch>

<dl><dt data-md=""><p>If there are no <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a>,</p>
<dd data-md=""><p>Let <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> be an empty sequence.</p>
<dt data-md=""><p>If point offsets is specified,</p>
<dd data-md=""><p>Let <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> refer to <a data-link-type=dfn href=#point-offset title="point offsets">point
offsets</a>.</p>
<dt data-md=""><p>If the <a data-link-type=dfn href=#motion-path-spacing-mode title="motion path spacing mode">spacing mode</a>
is <a data-link-type=dfn title="distribute spacing mode">distribute</a>,</p>
<dd data-md=""><p>Perform the following steps:</p>

<ol><li data-md=""><p>Let <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> be a sequence of
equal length to <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>.</p>
<li data-md=""><p>Let <var>n</var> be the number of elements in
<a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> minus one.</p>
<li data-md=""><p>Let <var>k</var> represent an index in the range [0,
<var>n</var>].</p>
<li data-md=""><p>Set the value of each point in <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point
offsets</a> so that the point at index <var>k</var>
is equal to <var>k</var> / <var>n</var>.</p>
</ol>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Perform the following steps:</p>

<ol><li data-md=""><p>Let <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> be a sequence of
equal length to <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>.</p>
<li data-md=""><p>Let <var>n</var> be the number of elements in
<a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> minus one.</p>
<li data-md=""><p>Let <var>k</var> represent an index in the range [0,
<var>n</var>].</p>
<li data-md=""><p>Let <dfn class=css-code data-dfn-type=function id=giant-error title=pointk>point(<var>k</var>)<a class=self-link href=#giant-error></a></dfn>
represent the value of <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a>
at index <var>k</var>.</p>
<li data-md=""><p>Set the value of each point in <var>effective point
offsets</var> so that the value at index <var>k</var> is
defined by the following formula:</p>

<ul><li data-md=""><p>For <var>k</var> = 0, <var>offset</var> = 0</p>
<li data-md=""><p>For <var>k</var> = 1..<var>n</var>,
<var>offset</var> =
<div aria-describedby=math-pacing-points role=math style="display: inline">
  <math xmlns=http://www.w3.org/1998/Math/MathML>
  <mrow>
    <mfrac>
      <mrow>
        <munderover>
            <mo>Σ</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
              <mi>k</mi>
        </munderover>
        <mfenced close=| open=| separators=,>
          <mrow>
            <mi>point</mi><mo>⁡</mo>
            <mfenced close=) open=( separators=,>
              <mrow>
                <mi>i</mi>
              </mrow>
            </mfenced>
            <mo>-</mo>
            <mi>point</mi><mo>⁡</mo>
            <mfenced close=) open=( separators=,>
              <mrow>
                <mi>i</mi>
                <mo>-</mo>
                <mn>1</mn>
              </mrow>
            </mfenced>
          </mrow>
        </mfenced>
      </mrow> 
      <mrow>
        <munderover>
            <mo>Σ</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
              <mi>n</mi>
        </munderover>
        <mfenced close=| open=| separators=,>
          <mrow>
            <mi>point</mi><mo>⁡</mo>
            <mfenced close=) open=( separators=,>
              <mrow>
                <mi>i</mi>
              </mrow>
            </mfenced>
            <mo>-</mo>
            <mi>point</mi><mo>⁡</mo>
            <mfenced close=) open=( separators=,>
              <mrow>
                <mi>i</mi>
                <mo>-</mo>
                <mn>1</mn>
              </mrow>
            </mfenced>
          </mrow>
        </mfenced>
      </mrow>
    </mfrac>
  </mrow>
  </math>
  <div id=math-pacing-points>
    [ \sum_{i=1}^k | point(i)-point(i-1) | ]
    /
    [ \sum_{i=1}^n | point(i)-point(i-1) | ]
  </div>
</div><p></p>
</ul></ol>
<p class=note>Note: When <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> is a sequence of
    monotonically increasing points beginning with 0 and ending
    with 1 (or, in fact, any time the sum of distances between
    <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> is equal to 1),
    <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> will mirror <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective
    spacing points</a>.</p>
</dl>
</div>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=effective-point-easing>effective point easing<a class=self-link href=#effective-point-easing></a></dfn> is simply the specified
<a data-link-type=dfn href=#point-easing title="point easing">point easing</a>.
If <a data-link-type=dfn href=#point-easing title="point easing">point easing</a> is not set, the <a data-link-type=dfn href=#effective-point-easing title="effective point easing">effective point easing</a>
is a sequence of <a data-link-type=dfn href=#linear-timing-function title="linear timing functions">linear timing functions</a> equal in length to
the number of <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a> in the <a data-link-type=dfn href=#motion-path title="motion path">motion
path</a>.</p>

<h4 class="heading settled heading" data-level=4.4.3 id=determining-the-path-fraction><span class=secno>4.4.3 </span><span class=content>Determining the path fraction</span><a class=self-link href=#determining-the-path-fraction></a></h4>

<p>The <dfn data-dfn-type=dfn data-noexport="" id=path-fraction>path fraction<a class=self-link href=#path-fraction></a></dfn> for a given <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a>,
<var>progress</var>, is determined using the following procedure:</p>

<ol><li data-md=""><p>If <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> is empty, let <a data-link-type=dfn href=#path-fraction title="path fraction">path
fraction</a> equal <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and abort these steps.</p>
<li data-md=""><p>If <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point offsets</a> has only one item, let <a data-link-type=dfn href=#path-fraction title="path fraction">path
fraction</a> equal the value of the one item in <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective
spacing points</a> and abort these steps.</p>

<p class=note>Note: <a data-link-type=dfn href=#effective-point-offsets title="Effective point offsets">Effective point offsets</a> can only have one item if
    <a data-link-type=dfn href=#spacing-point title="spacing points">spacing points</a> has exactly one item. In this case, the
    <a data-link-type=dfn title="effective points offsets">effective points offsets</a> will always be a list containing
    just the value 0.</p>

<li data-md=""><p>If <var>progress</var> ≥ 1, let the <a data-link-type=dfn href=#path-fraction title="path fraction">path fraction</a> equal
the value of the <em>last</em> item in <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point
offsets</a> and abort these steps.</p>
<li data-md=""><p>If <var>progress</var> &lt; 0, let the <a data-link-type=dfn href=#path-fraction title="path fraction">path fraction</a> equal
the value of the <em>first</em> item in <a data-link-type=dfn href=#effective-point-offsets title="effective point offsets">effective point
offsets</a> and abort these steps.</p>
<li data-md=""><p>Let <var>start index</var> and <var>end index</var> represent
the zero-based indices of the <em>last</em> pair of successive
values in <var>effective point offsets</var> such that <var>start
offset</var> ≤ <var>progress</var> ≤ <var>end offset</var>.</p>
<li data-md=""><p>Let <var>interval fraction</var> be the ratio of the difference
between <var>progress</var> and the offset at <var>start
index</var>, and the difference between the offset at <var>end
index</var> and the offset at <var>start index</var>.</p>
<li data-md=""><p>Let <var>scaled interval fraction</var> be the result of applying
the <a data-link-type=dfn href=#timing-function title="timing function">timing function</a> from <a data-link-type=dfn href=#effective-point-easing title="effective point easing">effective point easing</a>
at index <var>start index</var> with <var>interval fraction</var>
as the input.</p>
<li data-md=""><p>Let <var>segment start</var> and <var>segment end</var> be the
values in <a data-link-type=dfn href=#effective-spacing-points title="effective spacing points">effective spacing points</a> at the indicies
<var>start index</var> and <var>end index</var> respectively.</p>
<li data-md=""><p>Let the <a data-link-type=dfn href=#path-fraction title="path fraction">path fraction</a> be the result of evaluating the
following formula:
<code><var>scaled interval fraction</var> *
(<var>segment end</var> - <var>segment start</var>) +
<var>segment start</var></code>.</p>
</ol>
<h4 class="heading settled heading" data-level=4.4.4 id=the-intermediate-animation-value-of-a-motion-path-animation-effect><span class=secno>4.4.4 </span><span class=content>The intermediate animation value of a motion path animation effect</span><a class=self-link href=#the-intermediate-animation-value-of-a-motion-path-animation-effect></a></h4>

<p>The <a data-link-type=dfn href=#intermediate-animation-value title="intermediate animation value">intermediate animation value</a> of a <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path animation
effect</a> for a given <var>time fraction</var>, <var>current
iteration</var>, and <var>underlying value</var> is given by the
following process:</p>

<ol><li data-md=""><p>Let <var>distance</var> be the <a data-link-type=dfn href=#path-fraction title="path fraction">path fraction</a> for the given
<a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a>.</p>
<li data-md=""><p>Let <var>displacement</var> be the point located
<var>distance</var> along the <a data-link-type=dfn href=#motion-path title="motion path">motion path</a> using the
definition for <a data-link-type=dfn href=#distance-along-a-path0 title="distance along a path">distance along a path</a>.</p>

<p>If <var>distance</var> indicates a point on the path that is
coincidental with one or more <a data-link-type=dfn href=#orientation-path-command title="orientation path commands">orientation path
commands</a>, <var>displacement</var> is the point
<em>after</em> all <a data-link-type=dfn href=#orientation-path-command title="orientation path commands">orientation path commands</a> (this will
be the <em>start</em> of the next <a data-link-type=dfn href=#drawing-path-command title="drawing path command">drawing path command</a> if
there is one).</p>
<li data-md=""><p>Let the <var>translation component</var> be the translation
transform required to transform the point at the start of
<a data-link-type=dfn href=#motion-path title="motion path">motion path</a> to <var>displacement</var>.</p>
<li data-md=""><p>Calculate the <var>rotation component</var> according to the
first match condition from the following:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#automatic-rotation-flag title="automatic rotation flag">automatic rotation flag</a> is set,</p>
<dd data-md=""><p>the <var>rotation component</var> is a transform representing
the sum of:</p>

<ul><li data-md=""><p>the angle of the tangent vector at
<var>displacement</var>, and</p>
<li data-md=""><p>the <a data-link-type=dfn href=#rotation-angle title="rotation angle">rotation angle</a>.</p>
</ul>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>the <var>rotation component</var> is a transform representing
the <a data-link-type=dfn href=#rotation-angle title="rotation angle">rotation angle</a>.</p>
</dl>
</div>

<p>When calculating the angle of the tangent vector, if there are
no <a data-link-type=dfn href=#drawing-path-command title="drawing path commands">drawing path commands</a> in the <a data-link-type=dfn href=#motion-path title="motion path">motion path</a>, the
the angle should be taken to be zero.</p>

<div class=issue id=issue-05370760><a class=self-link href=#issue-05370760></a>

<p>The original text for this section contained the following
    qualifications but I’m not sure how meaningful they are:</p>

<ul><li data-md=""><p>For continuous <a data-link-type=dfn href=#path-command title="path commands">path commands</a> (all elements except
moveto), the angle of the tangent vector for the purpose of
these calculations is defined to be an integer multiple of
2π different from the value given by <a href=http://en.wikipedia.org/wiki/Tangential_angle>standard
mathematical formulae for tangents to curves in
2 dimensional space</a>.</p>
<li data-md=""><p>For moveto <a data-link-type=dfn href=#path-command title="path commands">path commands</a>, which are discontinuous, the
angle of the tangent vector for the purpose of these
calculations is always an integer multiple of 2π.</p>
<li data-md=""><p>The initial value of the angle of the tangent vector is
computed using the first element of the curve, and is always
in the range [0, 2π).</p>
<li data-md=""><p>Single continuous path commands must never produce tangent
vector angles that are discontinuous over their defined
region. This implies that a single unique solution is
available for all points on continuous path commands.</p>
<li data-md=""><p>When computing angles after discontinuous or non-smooth
jumps, multiple possible solutions may be available.  These
solutions will differ by integer multiples of 2π.  In
such cases the solution that lies closest to the previous
tangent angle is used.</p>
</ul>
</div>

<li data-md=""><p>Let the <var>transform value</var> be the result of
by constructing a transform list consisting of the
<var>translation component</var> followed by the <var>rotation
component</var>.</p>

<p class=issue id=issue-f599319a><a class=self-link href=#issue-f599319a></a>What’s the value in keeping these separate?
    Shouldn’t we collapse them?</p>

<li data-md=""><p>Let the <var>unaccumulated value</var> be the result of
combining the <var>underlying value</var> (<var>V</var><sub>a</sub>)
with the <var>transform value</var> (<var>V</var><sub>b</sub>)
using the <a data-link-type=dfn href=#composite-operation title="composite operation">composite operation</a> of the effect.</p>
<li data-md=""><p>Let the <var>intermediate animation value</var> be
<var>unaccumulated value</var>.</p>
<li data-md=""><p>If the <a data-link-type=dfn href=#iteration-composite-operation title="iteration composite operation">iteration composite operation</a> of this <a data-link-type=dfn href=#motion-path-animation-effect title="motion path animation effect">motion path
animation effect</a> is <a data-link-type=dfn href=#iteration-composite-operation-accumulate title="iteration composite operation accumulate">accumulate</a>,
perform the following steps:</p>

<ol><li data-md=""><p>Let the <var>final transform value</var> be the value
calculated for the <var>transform value</var> when performing
the first five steps of this procedure using a <var>time
fraction</var> of 1.</p>
<li data-md=""><p>Perform the following step <var>current iteration</var> times:</p>

<ul><li data-md=""><p>Set the <var>intermediate animation value</var> to the
result of combining the current value of
<var>intermediate animation value</var>
(<var>V</var><sub>a</sub>) with
<var>final transform value</var>
(<var>V</var><sub>b</sub>)
using the <a data-link-type=dfn href=#animation-accumulation0 title="animation accumulation">accumulation
procedure</a> defined by the
<a data-link-type=dfn href=#animatable-as-transform-list0 title="animatable as transform list">animatable as transform list</a> <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation
behavior</a>.</p>
</ul></ol>
<li data-md=""><p>Return the <var>intermediate animation value</var>.</p>
</ol>
<p class=issue id=issue-8bfeb5cb><a class=self-link href=#issue-8bfeb5cb></a>Need to describe how <a href=http://www.w3.org/TR/css3-transforms/#transform-origin-property>transform-origin</a>
    is applied.</p>

<h3 class="heading settled heading" data-level=4.5 id=custom-effects><span class=secno>4.5 </span><span class=content>Custom effects</span><a class=self-link href=#custom-effects></a></h3>

<div class=informative-bg><em>This section is non-normative</em>

<p>In some situations the <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a> provided by Web Animations may be insufficient.
For example, the <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a>
defined here are only able to target certain CSS properties.
They are unable, therefore, to modify the <a href=http://www.w3.org/TR/SVG11/struct.html#__svg__SVGSVGElement__currentScale><code>currentScale</code></a>
property of an SVG element to smoothly zoom the viewport without
affecting the document content.</p>

<p>In such cases, where the provided <a data-link-type=dfn href=#animation-effect title="animation effects">animation
effects</a> do not provide needed functionality, an effect defined by
script may be used.
Such <a data-link-type=dfn href=#custom-effect title="custom effects">custom effects</a> receive a <a data-link-type=dfn href=#time-fraction title="time fraction">time
fraction</a> and <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a> from the timing model and
are responsible for producing an effect corresponding to the specified
time.</p>

<p>Using an effect defined in script it is possible to animate not only
otherwise un-animatable attributes and properties, but potentially
anything that is accessible via script, including even producing audio
or creating vibrations.</p>

<p>For example, using a <a data-link-type=dfn href=#custom-effect title="custom effect">custom effect</a> that draws to a <a href=http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element><code>canvas</code></a>
element, it is possible to produce a complex animated effect
featuring patterns that may be difficult to create using CSS or
SVG.
Compared to using <a href=http://www.w3.org/TR/animation-timing/>Timing control for
script-based animations</a>,
this approach ensures the animation is frame-rate
independent and can be paused, reversed, eased with timing effects,
accelerated, synchronized with other animations, and be controlled
in the same manner as any other Web Animations animation without any
additional programming.</p>

</div>

<p>A <dfn data-dfn-type=dfn data-noexport="" id=custom-effect>custom effect<a class=self-link href=#custom-effect></a></dfn> is an author-defined programming callback
that is passed timing information when <a data-link-type=dfn href=#sampling title=sampling>sampling</a> is performed.</p>

<h4 class="heading settled heading" data-level=4.5.1 id=sampling-custom-effects><span class=secno>4.5.1 </span><span class=content>Sampling custom effects</span><a class=self-link href=#sampling-custom-effects></a></h4>

<p><a data-link-type=dfn href=#custom-effect title="Custom effects">Custom effects</a> are called for each referencing <a data-link-type=dfn href=#animation title=animation>animation</a>
when a <a data-link-type=dfn href=#sampling title=sample>sample</a> is performed based on the following criteria.</p>

<ol><li data-md=""><p>If, on the previous sample, the <a data-link-type=dfn href=#animation title=animation>animation</a> referencing the
<a data-link-type=dfn href=#custom-effect title="custom effect">custom effect</a>:</p>

<ul><li data-md=""><p>was <a data-link-type=dfn href=#in-effect title="in effect">in effect</a>, and</p>
<li data-md=""><p>referenced this same <a data-link-type=dfn href=#custom-effect title="custom effect">custom effect</a>, and</p>
<li data-md=""><p>had a different <a data-link-type=dfn href=#animation-target title="animation target">animation target</a></p>
</ul>
<p>Call the callback passing a null <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and the
<a data-link-type=dfn href=#animation-target title="animation target">animation target</a> from the previous sample as parameters to
the callback.</p>
<li data-md=""><p>Call the callback for the current <a data-link-type=dfn href=#animation-target title="animation target">animation target</a> based on
the first matching condition from the following:</p>

<div class=switch>

<dl><dt data-md=""><p>If the <a data-link-type=dfn href=#animation title=animation>animation</a> referencing the custom effect is not
<a data-link-type=dfn href=#in-effect title="in effect">in effect</a> but was <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> in the previous
sample,</p>
<dd data-md=""><p>Call the callback passing a null <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and the
current <a data-link-type=dfn href=#animation-target title="animation target">animation target</a> as parameters to the callback.</p>
<dt data-md=""><p>Otherwise, if the <a data-link-type=dfn href=#animation title=animation>animation</a> referencing the custom
effect:</p>
<dd data-md="">

<ul><li data-md=""><p><strong>is <a data-link-type=dfn href=#in-effect title="in effect">in effect</a>, and</strong></p>
<li data-md=""><p><strong>was not <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> in the previous <a data-link-type=dfn href=#sampling title=sample>sample</a>, or
  was <a data-link-type=dfn href=#in-effect title="in effect">in effect</a> but with a different <a data-link-type=dfn href=#time-fraction title="time fraction">time
  fraction</a> or <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a>,</strong></p>
</ul>
<dd data-md=""><p>Call the callback passing with the referencing
<a data-link-type=dfn href=#animation title=animation>animation</a>’s current <a data-link-type=dfn href=#time-fraction title="time fraction">time fraction</a> and <a data-link-type=dfn href=#animation-target title="animation target">animation
target</a> as parameters to the callback.</p>
</dl>
</div>
</ol>
<div class=issue id=issue-466de4cb><a class=self-link href=#issue-466de4cb></a>
There may be use cases where an action needs to be triggered at
a specific point in an animation tree.
In many cases this can be achieved by inserting a custom effect with
a step-start easing that spans the period during which the action
should be triggered.
However, this can impose additional layout requirements on the
content which might be cumbersome to accomodate.

<p>Some alternatives under consideration:</p>

<ul><li data-md=""><p>Additional calling conditions could be defined to accommodate
zero-width custom effects. For example, it could be required
that the callback be called if (given infinite precision) there
was a time between the previous and current sample times that
aligned with the custom effect.</p>
<li data-md=""><p>Instead of adding special calling conditions to custom effects,
a new type of animation node, Trigger, could be introduced. The
trigger would only ever act as a zero-width custom effect as
described above, its constructor would take a callback function,
but not require a target or timing. It could also specify other
calling conventions, for example whether it should only trigger
in a specific playback direction.</p>
</ul>
</div>

<h4 class="heading settled heading" data-level=4.5.2 id=execution-order-of-custom-effects><span class=secno>4.5.2 </span><span class=content>Execution order of custom effects</span><a class=self-link href=#execution-order-of-custom-effects></a></h4>

<p>Since <a data-link-type=dfn href=#custom-effect title="custom effects">custom effects</a>, unlike <a data-link-type=dfn href=#animation-effect title="animation effect">animation effects</a>, are not limited to
a single <a data-link-type=dfn href=#target-property title="target property">target property</a>, the steps for assessing their
order of execution differs from <a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a>.f</p>

<p><a data-link-type=dfn href=#custom-effect title="Custom effects">Custom effects</a> are executed after all
<a data-link-type=dfn href=#animation-effect title="animation effects">animation effects</a> have completed and
applied their result to their targets (see <a data-section="" href=#applying-the-composited-result>§4.2.4 Applying the composited result</a>).</p>

<p class=issue id=issue-8b46f38c><a class=self-link href=#issue-8b46f38c></a>Need to define this more precisely.
    Are styles flushed?
    Presumably they are.
    Can we suspend reflow for the duration of executing the script-based
    animation effects and just do it once afterwards?</p>

<p>Within the set of <a data-link-type=dfn href=#custom-effect title="custom effects">custom effects</a>, the
order of execution is the same as that defined for <a data-link-type=dfn href=#animation-effect title="animation effect">animation effects</a> in <a data-section="" href=#the-animation-stack>§4.2.1 The animation stack</a>.
Items sorted earlier are executed before those sorted later.</p>



<h2 class="heading settled heading" data-level=5 id=programming-interface><span class=secno>5 </span><span class=content>Programming interface</span><a class=self-link href=#programming-interface></a></h2>

<div class=informative-bg><em>This section is non-normative</em>

<p>In addition to the abstract model described above, Web Animations also
defines a programming interface to the model.
This interface can be used to inspect and extend animations produced
by declarative means or for directly producing animations when
a procedural approach is more suitable.</p>

</div>

<h3 class="heading settled heading" data-level=5.1 id=the-animationtimeline-interface><span class=secno>5.1 </span><span class=content>The <code>AnimationTimeline</code> interface</span><a class=self-link href=#the-animationtimeline-interface></a></h3>

<p><a data-link-type=dfn href=#timeline title=Timelines>Timelines</a>, including the <a data-link-type=dfn href=#document-timeline title="document timeline">document
timeline</a> are represented in the Web Animations API by the
<a data-link-type=dfn title=AnimationTimeline>AnimationTimeline</a> interface.</p>

<pre class=idl>interface <dfn class=idl-code data-dfn-type=interface data-export="" data-global-name="" id=dom-animationtimeline>AnimationTimeline<a class=self-link href=#dom-animationtimeline></a></dfn> {
    readonly attribute double? <a class=idl-code data-global-name="AnimationTimeline<interface>/currenttime<attribute>" data-link-for=AnimationTimeline data-link-type=attribute data-readonly="" data-type="double? " href=#dom-animationtimeline-currenttime title=currentTime>currentTime</a>;
    <a data-link-type=idl href=#dom-animationplayer title=AnimationPlayer>AnimationPlayer</a>           <a class=idl-code data-global-name="AnimationTimeline<interface>/play()<method>" data-link-for=AnimationTimeline data-link-type=method href=#dom-animationtimeline-play title=play()>play</a> (optional <a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>? <dfn class=idl-code data-dfn-for=AnimationTimeline/play() data-dfn-type=argument data-export="" data-global-name="AnimationTimeline<interface>/play()<method>/source<argument>" id=dom-animationtimelineplay-source>source<a class=self-link href=#dom-animationtimelineplay-source></a></dfn> = null);
    sequence&lt;<a data-link-type=idl href=#dom-animationplayer title=AnimationPlayer>AnimationPlayer</a>&gt; <a class=idl-code data-global-name="AnimationTimeline<interface>/getanimationplayers()<method>" data-link-for=AnimationTimeline data-link-type=method href=#dom-animationtimeline-getanimationplayers title=getAnimationPlayers()>getAnimationPlayers</a> ();
};
</pre>

<div class=attributes>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationTimeline data-dfn-type=attribute data-export="" id=dom-animationtimeline-currenttime>currentTime<a class=self-link href=#dom-animationtimeline-currenttime></a></dfn>
<span data-attribute-info="" for=AnimationTimeline/currentTime> of type <a data-link-type=idl-name title=double>double</a>, readonly, nullable</span></p>
<dd data-md=""><p>Returns the <a data-link-type=dfn href=#time-value title="time value">time value</a> for this timeline or <code>null</code>
if this timeline is <a data-link-type=dfn href=#not-started title="not started">not started</a>.</p>
</dl>
</div>

<div class=methods>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationTimeline data-dfn-type=method data-export="" id=dom-animationtimeline-play title=play()>
AnimationPlayer play(optional TimedItem? source = null)<a class=self-link href=#dom-animationtimeline-play></a></dfn></p>
<dd data-md=""><p>Creates a new <a class=idl-code data-link-type=interface href=#dom-animationplayer title=AnimationPlayer>AnimationPlayer</a> object associated with
this <a data-link-type=dfn href=#timeline title=timeline>timeline</a> that is scheduled to start at <code>currentTime</code>.</p>

<p>The <code>timeline</code> attribute of the newly-created
<a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a> object will be set to this object.</p>

<p>Similarly, the <code>startTime</code> attribute will be set to the
value of this object’s <code>currentTime</code> attribute at the
moment the method was called, or, if <code>currentTime</code> is
<code>null</code>, zero.</p>

<p>The <code>currentTime</code> attribute of the
<a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a> object is a calculated value described in
<a data-section="" href=#the-current-time-of-a-player>§3.5.1 The current time of a player</a>.</p>

<p>The <code>playbackRate</code> and <code>paused</code> attributes
take on their default values as described in the definitions of
the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> and
<a data-link-type=dfn title="paused state">paused state</a> properties of <a data-link-type=dfn href=#player title=player>player</a> objects.</p>

<p>The <a data-link-for=AnimationPlayer data-link-type=dfn title=source>source</a>
attribute of the created <a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a>
is set from the <em>source</em> parameter by following the
procedure defined for updating that attribute.
As a result, if <em>source</em> is already associated with
a <code>player</code>, it will be disassociated first before
being associated with the new <a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a>.</p>

<div class=parameters>

<dl><dt data-md=""><p>source</p>
<dd data-md=""><p>the <a data-link-type=dfn href=#source-content title="source content">source content</a> to assign to the newly-created
<a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a> object.</p>
</dl>
</div>

<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationTimeline data-dfn-type=method data-export="" id=dom-animationtimeline-getanimationplayers title=getAnimationPlayers()>
sequence&lt;AnimationPlayer&gt; getAnimationPlayers()<a class=self-link href=#dom-animationtimeline-getanimationplayers></a></dfn></p>
<dd data-md=""><p>Returns the set of <a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a> objects
associated with this <a data-link-type=dfn href=#timeline title=timeline>timeline</a> that have associated
<a data-link-type=dfn href=#source-content title="source content">source content</a> which is <a data-link-type=dfn href=#current title=current>current</a>.</p>

<p>The returned list is sorted in increasing order by <a data-link-type=dfn href=#player-sequence-number title="player sequence number">player
sequence number</a>.</p>
</dl>
<h3 class="heading settled heading" data-level=5.2 id=the-animationplayer-interface><span class=secno>5.2 </span><span class=content>The <code>AnimationPlayer</code> interface</span><a class=self-link href=#the-animationplayer-interface></a></h3>

<p><a data-link-type=dfn href=#player title=Players>Players</a> are represented in the Web Animations
API by the <a data-link-type=dfn title=AnimationPlayer>AnimationPlayer</a> interface.</p>

<pre class=idl>interface <dfn class=idl-code data-dfn-type=interface data-export="" data-global-name="" id=dom-animationplayer>AnimationPlayer<a class=self-link href=#dom-animationplayer></a></dfn> : <a data-link-type=idl href=http://dom.spec.whatwg.org/#eventtarget title=EventTarget>EventTarget</a> {
             attribute <a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>?    <a class=idl-code data-global-name="AnimationPlayer<interface>/source<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-type="AnimationNode?    " href=#dom-animationplayer-source title=source>source</a>;
    readonly attribute <a data-link-type=idl href=#dom-animationtimeline title=AnimationTimeline>AnimationTimeline</a> <a class=idl-code data-global-name="AnimationPlayer<interface>/timeline<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-readonly="" data-type="AnimationTimeline " href=#dom-animationplayer-timeline title=timeline>timeline</a>;
             attribute double            <a class=idl-code data-global-name="AnimationPlayer<interface>/starttime<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-type="double            " href=#dom-animationplayer-starttime title=startTime>startTime</a>;
             attribute double            <a class=idl-code data-global-name="AnimationPlayer<interface>/currenttime<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-type="double            " href=#dom-animationplayer-currenttime title=currentTime>currentTime</a>;
             attribute double            <a class=idl-code data-global-name="AnimationPlayer<interface>/playbackrate<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-type="double            " href=#dom-animationplayer-playbackrate title=playbackRate>playbackRate</a>;
    readonly attribute boolean           <a class=idl-code data-global-name="AnimationPlayer<interface>/paused<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-readonly="" data-type="boolean           " href=#dom-animationplayer-paused title=paused>paused</a>;
    readonly attribute boolean           <a class=idl-code data-global-name="AnimationPlayer<interface>/finished<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-readonly="" data-type="boolean           " href=#dom-animationplayer-finished title=finished>finished</a>;
    void <a class=idl-code data-global-name="AnimationPlayer<interface>/cancel()<method>" data-link-for=AnimationPlayer data-link-type=method href=#dom-animationplayer-cancel title=cancel()>cancel</a> ();
    void <a class=idl-code data-global-name="AnimationPlayer<interface>/finish()<method>" data-link-for=AnimationPlayer data-link-type=method href=#dom-animationplayer-finish title=finish()>finish</a> ();
    void <a class=idl-code data-global-name="AnimationPlayer<interface>/play()<method>" data-link-for=AnimationPlayer data-link-type=method href=#dom-animationplayer-play title=play()>play</a> ();
    void <a class=idl-code data-global-name="AnimationPlayer<interface>/pause()<method>" data-link-for=AnimationPlayer data-link-type=method href=#dom-animationplayer-pause title=pause()>pause</a> ();
    void <a class=idl-code data-global-name="AnimationPlayer<interface>/reverse()<method>" data-link-for=AnimationPlayer data-link-type=method href=#dom-animationplayer-reverse title=reverse()>reverse</a> ();

    // Event callbacks
             attribute <a data-link-type=idl href=http://www.w3.org/html/wg/drafts/html/CR/webappapis.html#eventhandler title=EventHandler>EventHandler</a>      <a class=idl-code data-global-name="AnimationPlayer<interface>/onfinish<attribute>" data-link-for=AnimationPlayer data-link-type=attribute data-type="EventHandler      " href=#dom-animationplayer-onfinish title=onfinish>onfinish</a>;
};
</pre>

<div class=attributes>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-source>source<a class=self-link href=#dom-animationplayer-source></a></dfn>
<span data-attribute-info="" for=source> of type <a data-link-type=idl-name href=#dom-animationnode title=AnimationNode>AnimationNode</a>, nullable</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#source-content title="source content">source content</a> associated with this player.</p>

<p>A <a data-link-type=dfn href=#player title=player>player</a> can only be associated with at most one
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a>, and likewise, an <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> can
only be <a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated</a> with at
most one <a data-link-type=dfn href=#player title=player>player</a>.
In order to maintain these invariants, on setting this value, the
following procedure is performed:</p>

<ol><li data-md=""><p>Let <var>old value</var> be the current value of the
<code>source</code> attribute.</p>
<li data-md=""><p>Let <var>new value</var> be the value to set.</p>
<li data-md=""><p>If <var>new value</var> is the same object as <var>old
value</var>, return.</p>
<li data-md=""><p>If <var>old value</var> is not <code>null</code>,
disassociate <var>old value</var> from this player.</p>
<li data-md=""><p>If <var>new value</var> is not <code>null</code>,
perform the steps associated with the first matching condition
of the following:</p>

<div class=switch>

<dl><dt data-md=""><p>If <var>new value</var> has no parent group and is
associated with a player,</p>
<dd data-md=""><p>disassociate <var>new value</var> from its player.</p>
<dt data-md=""><p>If <var>new value</var> has a parent group,</p>
<dd data-md=""><p>remove <var>new value</var> from its parent group by
calling <code><var>new value</var>.remove()</code>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>do nothing.</p>
</dl>
</div>

<li data-md=""><p>Associate <var>new value</var> with this player.</p>
<li data-md=""><p>Set the <code>source</code> attribute to <var>new
value</var>.</p>
</ol>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-timeline>timeline<a class=self-link href=#dom-animationplayer-timeline></a></dfn>
<span data-attribute-info="" for=timeline> of type <a data-link-type=idl-name href=#dom-animationtimeline title=AnimationTimeline>AnimationTimeline</a>, readonly</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#timeline title=timeline>timeline</a> associated with this player.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-starttime>startTime<a class=self-link href=#dom-animationplayer-starttime></a></dfn>
<span data-attribute-info="" for=startTime> of type <a data-link-type=idl-name title=double>double</a></span></p>
<dd data-md=""><p>Returns the <a data-link-type=dfn href=#player-start-time title="player start time">start time</a> of this
player.
Setting this attribute updates the <a data-link-type=dfn href=#player-start-time title="player start time">player start time</a> using
the procedure defined in <a data-section="" href=#updating-the-player-start-time>§3.5.2.6 Updating the player start time</a></p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-currenttime>currentTime<a class=self-link href=#dom-animationplayer-currenttime></a></dfn>
<span data-attribute-info="" for=AnimationPlayer/currentTime> of type <a data-link-type=idl-name title=double>double</a></span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#effective-current-time title="effective current time">effective current time</a> of this player.
Setting this attribute follows the procedure defined in 
<a data-section="" href=#performing-a-seek>§3.5.2.9 Performing a seek</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-playbackrate>playbackRate<a class=self-link href=#dom-animationplayer-playbackrate></a></dfn>
<span data-attribute-info="" for=playbackRate> of type <a data-link-type=idl-name title=double>double</a></span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> of this
player.
Setting this attribute follows the procedure defined in <a data-section="" href=#updating-the-playback-rate>§3.5.3.1 Updating the playback rate</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-paused>paused<a class=self-link href=#dom-animationplayer-paused></a></dfn>
<span data-attribute-info="" for=paused> of type <a data-link-type=idl-name title=boolean>boolean</a>, readonly</span></p>
<dd data-md=""><p>The <a data-link-type=dfn title="paused state">paused state</a> of this player.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-finished>finished<a class=self-link href=#dom-animationplayer-finished></a></dfn>
<span data-attribute-info="" for=finished> of type <a data-link-type=idl-name title=boolean>boolean</a>, readonly</span></p>
<dd data-md=""><p>Returns true if this <a data-link-type=dfn href=#player title=player>player</a> has reached or passed the end of
its <a data-link-type=dfn href=#source-content title="source content">source content</a> in its current <a data-link-type=dfn href=#playback-direction title="playback direction">playback direction</a>.
This corresponds to when the player is <a data-link-type=dfn href=#limited title=limited>limited</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=attribute data-export="" id=dom-animationplayer-onfinish>onfinish<a class=self-link href=#dom-animationplayer-onfinish></a></dfn>
<span data-attribute-info="" for=onfinish> of type <a data-link-type=idl-name title=EventHandler>EventHandler</a></span></p>
<dd data-md=""><p>The event handler for the <a data-link-type=dfn href=#finish-player-event title="finish player event">finish</a> event.</p>

<p class=note>Note: the <a href=http://www.w3.org/TR/html5/webappapis.html#eventhandler>EventHandler</a>
    callback interface type is defined in <a data-biblio-type=normative data-link-type=biblio href=#biblio-html5 title=biblio-HTML5>[HTML5]</a>.</p>
</dl>
</div>

<div class=methods>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=method data-export="" id=dom-animationplayer-cancel title=cancel()>void cancel()<a class=self-link href=#dom-animationplayer-cancel></a></dfn></p>
<dd data-md=""><p>Sets <code>source</code> to null and clears all effects associated
with the previous <a data-link-type=dfn href=#source-content title="source content">source content</a>.</p>

<p class=issue id=issue-020f7327><a class=self-link href=#issue-020f7327></a>We need to make sure, for example, that any custom effects get
	called with a null sample time so they can remove their effects.
    This applies to manually setting <code>source</code> to null as
    well so we should define this behavior there.</p>

<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=method data-export="" id=dom-animationplayer-finish title=finish()>void finish()<a class=self-link href=#dom-animationplayer-finish></a></dfn></p>
<dd data-md=""><p>Seeks the player to the end of the <a data-link-type=dfn href=#source-content title="source content">source content</a> in the
current direction as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; zero,</p>
<dd data-md=""><p><a href=#performing-a-seek>Seek</a> the player so its
<a data-link-type=dfn href=#current-time title="current time">current time</a> is zero.</p>
<dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> equals zero,</p>
<dd data-md=""><p>Do nothing.</p>
<dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; zero,</p>
<dd data-md=""><p><a href=#performing-a-seek>Seek</a> the player so its
<a data-link-type=dfn href=#current-time title="current time">current time</a> is equal to the <a data-link-type=dfn href=#end-time title="end time">end time</a> of the
<a data-link-type=dfn href=#source-content title="source content">source content</a> or zero if there is no <a data-link-type=dfn href=#source-content title="source content">source
content</a> associated with this player..</p>
</dl>
</div>

<div class=exceptions>

<dl><dt data-md=""><p>DOMException of type <code>InvalidStateError</code></p>
<dd data-md=""><p>Raised if the <a data-link-type=dfn href=#end-time title="end time">end time</a> of this player’s <a data-link-type=dfn href=#source-content title="source content">source
content</a> is infinity and the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is
&gt; zero.</p>
</dl>
</div>

<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=method data-export="" id=dom-animationplayer-play title=play()>void play()<a class=self-link href=#dom-animationplayer-play></a></dfn></p>
<dd data-md=""><p>Unpauses the player and rewinds if it has finished playing using
the following procedure:</p>

<ol><li data-md=""><p>Set the <a data-link-type=dfn title="paused state">paused state</a> of the player to false using the
procedure defined in <a data-section="" href=#updating-the-paused-state>§3.5.2.8 Updating the paused state</a></p>
<li data-md=""><p>If <a data-link-type=dfn href=#source-content title="source content">source content</a> is associated with the player,
<a href=#performing-a-seek>adjust the current time</a> of
the player as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; 0; and
either <a data-link-type=dfn href=#current-time title="current time">current time</a> &lt; zero or
<a data-link-type=dfn href=#current-time title="current time">current time</a> ≥ <a data-link-type=dfn href=#source-content title="source content">source
content</a>’s <a data-link-type=dfn href=#end-time title="end time">end time</a>,</p>
<dd data-md=""><p>Seek to time zero.</p>
<dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; 0; and
either <a data-link-type=dfn href=#current-time title="current time">current time</a> ≤ zero or
<a data-link-type=dfn href=#current-time title="current time">current time</a> &gt; <a data-link-type=dfn href=#source-content title="source content">source
content</a>’s <a data-link-type=dfn href=#end-time title="end time">end time</a>,</p>
<dd data-md=""><p>Seek to the <a data-link-type=dfn href=#source-content title="source content">source content</a>’s <a data-link-type=dfn href=#end-time title="end time">end
time</a>.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Do nothing.</p>
</dl>
</div>

<li data-md=""><p>Set the player’s <a data-link-type=dfn href=#finished-flag title="finished flag">finished flag</a> to false.</p>
</ol>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=method data-export="" id=dom-animationplayer-pause title=pause()>void pause()<a class=self-link href=#dom-animationplayer-pause></a></dfn></p>
<dd data-md=""><p>Set the <a data-link-type=dfn title="paused state">paused state</a> of this player to true using the
procedure defined in <a data-section="" href=#updating-the-paused-state>§3.5.2.8 Updating the paused state</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationPlayer data-dfn-type=method data-export="" id=dom-animationplayer-reverse title=reverse()>void reverse()<a class=self-link href=#dom-animationplayer-reverse></a></dfn></p>
<dd data-md=""><p>Inverts the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">playback rate</a> of
this player and seeks to the start of the source media if it has
finished playing in the reversed direction using the following
procedure.</p>

<ol><li data-md=""><p>If the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> is zero, abort these steps.</p>
<li data-md=""><p>If <a data-link-type=dfn href=#source-content title="source content">source content</a> is associated with the player,
<a href=#performing-a-seek>adjust the current time</a> of
the player as follows:</p>

<div class=switch>

<dl><dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &gt; zero and
<a data-link-type=dfn href=#effective-current-time title="effective current time">effective current time</a> &gt; <a data-link-type=dfn href=#source-content title="source content">source
content</a>’s <a data-link-type=dfn href=#end-time title="end time">end time</a>,</p>
<dd data-md=""><p>Seek to the <a data-link-type=dfn href=#source-content title="source content">source content</a>’s <a data-link-type=dfn href=#end-time title="end time">end time</a>.</p>
<dt data-md=""><p>If <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> &lt; zero and
<a data-link-type=dfn href=#effective-current-time title="effective current time">effective current time</a> &lt; zero,</p>
<dd data-md=""><p>Seek to time zero.</p>
<dt data-md=""><p>Otherwise,</p>
<dd data-md=""><p>Do nothing.</p>
</dl>
</div>

<li data-md=""><p>Set the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback rate</a> to <code>-<a data-link-type=dfn href=#player-playback-rate title="player playback rate">player
    playback rate</a></code> following the steps in <a data-section="" href=#updating-the-playback-rate>§3.5.3.1 Updating the playback rate</a>.</p>
<li data-md=""><p>Set the <a data-link-type=dfn title="paused state">paused state</a> of the <a data-link-type=dfn href=#player title=player>player</a> to false.</p>

<p class=issue id=issue-1c8c4848><a class=self-link href=#issue-1c8c4848></a>Is this unpausing behavior correct?</p>

<p class=note>Note: unlike <code>play()</code>, the player’s <a data-link-type=dfn href=#finished-flag title="finished flag">finished
    flag</a> is not explicitly reset here since that behavior is
    performed by the procedure for updating the <a data-link-type=dfn href=#player-playback-rate title="player playback rate">player playback
    rate</a> defined in <a data-section="" href=#updating-the-playback-rate>§3.5.3.1 Updating the playback rate</a>.</p>
</ol></dl>
</div>

<h3 class="heading settled heading" data-level=5.3 id=the-animationnode-interface><span class=secno>5.3 </span><span class=content>The <code>AnimationNode</code> interface</span><a class=self-link href=#the-animationnode-interface></a></h3>

<p><a data-link-type=dfn href=#animation-node title="Animation nodes">Animation nodes</a> are represented in the Web
Animations API by the <a data-link-type=dfn title=AnimationNode>AnimationNode</a> interface.</p>

<pre class=idl>interface <dfn class=idl-code data-dfn-type=interface data-export="" data-global-name="" id=dom-animationnode>AnimationNode<a class=self-link href=#dom-animationnode></a></dfn> {
    // Timing
    readonly attribute <a data-link-type=idl title=AnimationTiming>AnimationTiming</a>         <a class=idl-code data-global-name="AnimationNode<interface>/timing<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="AnimationTiming         " href=#dom-animationnode-timing title=timing>timing</a>;
    readonly attribute <a data-link-type=idl title=ComputedAnimationTiming>ComputedAnimationTiming</a> <a class=idl-code data-global-name="AnimationNode<interface>/computedtiming<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="ComputedAnimationTiming " href=#dom-animationnode-computedtiming title=computedTiming>computedTiming</a>;

    // Timing hierarchy
    readonly attribute <a data-link-type=idl title=AnimationGroup>AnimationGroup</a>?         <a class=idl-code data-global-name="AnimationNode<interface>/parent<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="AnimationGroup?         " href=#dom-animationnode-parent title=parent>parent</a>;
    readonly attribute <a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>?          <a class=idl-code data-global-name="AnimationNode<interface>/previoussibling<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="AnimationNode?          " href=#dom-animationnode-previoussibling title=previousSibling>previousSibling</a>;
    readonly attribute <a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>?          <a class=idl-code data-global-name="AnimationNode<interface>/nextsibling<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="AnimationNode?          " href=#dom-animationnode-nextsibling title=nextSibling>nextSibling</a>;
    void <a class=idl-code data-global-name="AnimationNode<interface>/before()<method>" data-link-for=AnimationNode data-link-type=method href=#dom-animationnode-before title=before()>before</a> (<a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>... <dfn class=idl-code data-dfn-for=AnimationNode/before() data-dfn-type=argument data-export="" data-global-name="AnimationNode<interface>/before()<method>/nodes<argument>" id=dom-animationnodebefore-nodes>nodes<a class=self-link href=#dom-animationnodebefore-nodes></a></dfn>);
    void <a class=idl-code data-global-name="AnimationNode<interface>/after()<method>" data-link-for=AnimationNode data-link-type=method href=#dom-animationnode-after title=after()>after</a> (<a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>... <dfn class=idl-code data-dfn-for=AnimationNode/after() data-dfn-type=argument data-export="" data-global-name="AnimationNode<interface>/after()<method>/nodes<argument>" id=dom-animationnodeafter-nodes>nodes<a class=self-link href=#dom-animationnodeafter-nodes></a></dfn>);
    void <a class=idl-code data-global-name="AnimationNode<interface>/replace()<method>" data-link-for=AnimationNode data-link-type=method href=#dom-animationnode-replace title=replace()>replace</a> (<a data-link-type=idl href=#dom-animationnode title=AnimationNode>AnimationNode</a>... <dfn class=idl-code data-dfn-for=AnimationNode/replace() data-dfn-type=argument data-export="" data-global-name="AnimationNode<interface>/replace()<method>/nodes<argument>" id=dom-animationnodereplace-nodes>nodes<a class=self-link href=#dom-animationnodereplace-nodes></a></dfn>);
    void <a class=idl-code data-global-name="AnimationNode<interface>/remove()<method>" data-link-for=AnimationNode data-link-type=method href=#dom-animationnode-remove title=remove()>remove</a> ();

    // Associated player
    readonly attribute <a data-link-type=idl href=#dom-animationplayer title=AnimationPlayer>AnimationPlayer</a>?        <a class=idl-code data-global-name="AnimationNode<interface>/player<attribute>" data-link-for=AnimationNode data-link-type=attribute data-readonly="" data-type="AnimationPlayer?        " href=#dom-animationnode-player title=player>player</a>;
};
</pre>

<div class=attributes>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-timing>timing<a class=self-link href=#dom-animationnode-timing></a></dfn>
<span data-attribute-info="" for=timing> of type <a data-link-type=idl-name title=AnimationTiming>AnimationTiming</a>, readonly</span></p>
<dd data-md=""><p>Returns the input timing properties specified for this
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.
This is comparable to the specified style on an Element,
<code>elem.style</code>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-computedtiming>computedTiming<a class=self-link href=#dom-animationnode-computedtiming></a></dfn>
<span data-attribute-info="" for=computedTiming> of type <a data-link-type=idl-name title=ComputedAnimationTiming>ComputedAnimationTiming</a>, readonly</span></p>
<dd data-md=""><p>Returns the calculated timing properties for this <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a>.
This is comparable to the computed style of an Element,
<code>window.getComputedStyle(elem)</code>.</p>

<p>Although several of the attributes of the this object are common
to the <code>timing</code> <a data-link-type=dfn title=AnimationTiming>AnimationTiming</a> object they
have the following differences:</p>

<ul><li data-md=""><p><code>duration</code> – returns the calculated value of
the <a data-link-type=dfn href=#iteration-duration title="iteration duration">iteration duration</a>. If <code>timing.duration</code>
is the string <code>auto</code> or any unsupported value, this
attribute will return the current calculated value of the
<a data-link-type=dfn href=#intrinsic-iteration-duration title="intrinsic iteration duration">intrinsic iteration duration</a>.</p>
<li data-md=""><p><code>fill</code> – the <code>auto</code> value is
replaced with the specific <a data-link-type=dfn title=FillMode>FillMode</a> depending on the type
of <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> (see <a data-section="" href=#the-fillmode-enumeration></a>).</p>
<li data-md=""><p><code>easing</code> – unrecognised or unsupported values
are replaced with the string <code>linear</code>.</p>
</ul>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-parent>parent<a class=self-link href=#dom-animationnode-parent></a></dfn>
<span data-attribute-info="" for=parent> of type <a data-link-type=idl-name title=AnimationGroup>AnimationGroup</a>, readonly, nullable</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> of this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> or
<code>null</code> if this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> does not have
a <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>.</p>

<p class=issue id=issue-894adfa6><a class=self-link href=#issue-894adfa6></a>Should this be <code>parentGroup</code>?</p>

<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-previoussibling>previousSibling<a class=self-link href=#dom-animationnode-previoussibling></a></dfn>
<span data-attribute-info="" for=previousSibling> of type <a data-link-type=idl-name href=#dom-animationnode title=AnimationNode>AnimationNode</a>, readonly, nullable</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#previous-sibling title="previous sibling">previous sibling</a> of this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-nextsibling>nextSibling<a class=self-link href=#dom-animationnode-nextsibling></a></dfn>
<span data-attribute-info="" for=nextSibling> of type <a data-link-type=idl-name href=#dom-animationnode title=AnimationNode>AnimationNode</a>, readonly, nullable</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#next-sibling title="next sibling">next sibling</a> of this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=attribute data-export="" id=dom-animationnode-player>player<a class=self-link href=#dom-animationnode-player></a></dfn>
<span data-attribute-info="" for=player> of type <a data-link-type=idl-name href=#dom-animationplayer title=AnimationPlayer>AnimationPlayer</a>, readonly, nullable</span></p>
<dd data-md=""><p>The <a data-link-type=dfn href=#player title=player>player</a> with which this animation node is <a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated</a>, if any.
This object can be used to perform play control such as pausing or
rewinding on this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> <em>and all other
animation nodes in the same hierarchy</em>.</p>

<p>This will be <code>null</code> if this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a> is
not <a data-link-type=dfn href=#associated-with-a-player title="associated with a player">associated with a player</a>.</p>

<p class=issue id=issue-dae71733><a class=self-link href=#issue-dae71733></a>Feedback has been provided that suggests this reference causes the
    relationship between AnimationPlayers and AnimationNodes to be
    circular, which confuses the model. The player attribute should be
    considered <strong>at risk</strong> unless a strong use case for the
    reference arises.</p>
</dl>
</div>

<div class=methods>

<dl><dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=method data-export="" id=dom-animationnode-before title=before()>
void before (AnimationNode... nodes)<a class=self-link href=#dom-animationnode-before></a></dfn></p>
<dd data-md=""><p>Inserts <var>nodes</var> before this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>

<ol><li data-md=""><p>If there is no <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>, terminate these
steps.</p>
<li data-md=""><p>If any of the <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> in <var>nodes</var> is an
<a data-link-type=dfn href=#inclusive-ancestor title="inclusive ancestor">inclusive ancestor</a> of this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>
throw a <code>HierarchyRequestError</code> exception and
terminate these steps.</p>
<li data-md=""><p><a data-link-type=dfn title="insert children">Insert</a> <var>nodes</var> before
this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>
</ol>
<div class=note>
    Note that this definition precludes the following usage since
    <code>node</code> is an <a data-link-type=dfn href=#inclusive-ancestor title="inclusive ancestor">inclusive ancestor</a> of itself:

<p>FIXME: pre needs to work in lists.</p>

    <div class="example sh_javascript">
        node.before(node); // throws HierarchyRequestError
    </div>
</div>

<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=method data-export="" id=dom-animationnode-after title=after()>
void after(AnimationNode... nodes)<a class=self-link href=#dom-animationnode-after></a></dfn></p>
<dd data-md=""><p>Inserts <var>nodes</var> after this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>.</p>

<ol><li data-md=""><p>If there is no <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>, terminate these
steps.</p>
<li data-md=""><p>If any of the <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> in <var>nodes</var> is an
<a data-link-type=dfn href=#inclusive-ancestor title="inclusive ancestor">inclusive ancestor</a> of this <a data-link-type=dfn href=#animation-node title="animation node">animation node</a>
throw a <code>HierarchyRequestError</code> exception and
terminate these steps.</p>
<li data-md=""><p>Let <var>reference child</var> be the <a data-link-type=dfn title="next sibling not included">next sibling of
this animation node not in <var>nodes</var></a>.</p>
<li data-md=""><p><a data-link-type=dfn title="insert children">Insert</a> <var>nodes</var> before
<var>reference child</var>.</p>
</ol>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=method data-export="" id=dom-animationnode-replace title=replace()>
void replace(AnimationNode... nodes)<a class=self-link href=#dom-animationnode-replace></a></dfn></p>
<dd data-md=""><p>Replaces this <a data-link-type=dfn title=AnimationNode>AnimationNode</a> with the passed in
<var>nodes</var>.</p>

<ol><li data-md=""><p>If there is no <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>, terminate these
steps.</p>
<li data-md=""><p>If any of the <a data-link-type=dfn href=#animation-node title="animation nodes">animation nodes</a> in <var>nodes</var> is an
<a data-link-type=dfn href=#inclusive-ancestor title="inclusive ancestor">inclusive ancestor</a> of the <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>
throw a <code>HierarchyRequestError</code> exception and
terminate these steps.</p>
<li data-md=""><p>Let <var>reference child</var> be the <a data-link-type=dfn title="next sibling not included">next sibling of
this animation node not in <var>nodes</var></a>.</p>
<li data-md=""><p><a data-link-type=dfn title="remove an animation node">Remove</a> this
<a data-link-type=dfn href=#animation-node title="animation node">animation node</a> from its <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a>.</p>
<li data-md=""><p><a data-link-type=dfn title="insert children">Insert</a> <var>nodes</var> before
<var>reference child</var>.</p>
</ol>
<dt data-md=""><p><dfn class=idl-code data-dfn-for=AnimationNode data-dfn-type=method data-export="" id=dom-animationnode-remove title=remove()>void remove()<a class=self-link href=#dom-animationnode-remove></a></dfn></p>
<dd data-md=""><p><a data-link-type=dfn title="remove an animation node">Removes</a> this <a data-link-type=dfn href=#animation-node title="animation node">animation
node</a> from its <a data-link-type=dfn href=#parent-animation-group title="parent animation group">parent animation group</a> or <a data-link-type=dfn href=#player title=player>player</a>.</p>
</dl>
</div>
<h2 class="no-ref no-num heading settled heading" id=conformance><span class=content>
Conformance</span><a class=self-link href=#conformance></a></h2>

<h3 class="no-ref heading settled heading" id=conventions><span class=content>
Document conventions</span><a class=self-link href=#conventions></a></h3>

    <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc2119 title=biblio-RFC2119>[RFC2119]</a></p>

    <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    <div class=example>
        <p>This is an example of an informative example.</p>
    </div>

    <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    <p class=note>Note, this is an informative note.</p>

    <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"&gt;</code>, like
    this:

    <strong class=advisement>
        UAs MUST provide an accessible alternative.
    </strong>

<h3 class="no-ref heading settled heading" id=conformance-classes><span class=content>
Conformance classes</span><a class=self-link href=#conformance-classes></a></h3>

    <p>Conformance to this specification
    is defined for three conformance classes:
    <dl>
        <dt>style sheet
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#style-sheet>CSS
            style sheet</a>.
        <dt>renderer
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that interprets the semantics of a style sheet and renders
            documents that use them.
        <dt>authoring tool
            <dd>A <a href=http://www.w3.org/TR/CSS21/conform.html#user-agent>UA</a>
            that writes a style sheet.
    </dl>

    <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module.

    <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.)

    <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module.

<h3 class="no-ref heading settled heading" id=partial><span class=content>
Partial implementations</span><a class=self-link href=#partial></a></h3>

    <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong>
    treat as invalid (and <a href=http://www.w3.org/TR/CSS21/conform.html#ignore>ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>

<h3 class="no-ref heading settled heading" id=experimental><span class=content>
Experimental implementations</span><a class=self-link href=#experimental></a></h3>

    <p>To avoid clashes with future CSS features, the CSS2.1 specification
    reserves a <a href=http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords>prefixed
    syntax</a> for proprietary and experimental extensions to CSS.

    <p>Prior to a specification reaching the Candidate Recommendation stage
    in the W3C process, all implementations of a CSS feature are considered
    experimental. The CSS Working Group recommends that implementations
    use a vendor-prefixed syntax for such features, including those in
    W3C Working Drafts. This avoids incompatibilities with future changes
    in the draft.
    </p>

<h3 class="no-ref heading settled heading" id=testing><span class=content>
Non-experimental implementations</span><a class=self-link href=#testing></a></h3>

    <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec.

    <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group.

    <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at
    <a href=http://www.w3.org/Style/CSS/Test/>http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the
    <a href=http://lists.w3.org/Archives/Public/public-css-testsuite>public-css-testsuite@w3.org</a>
    mailing list.

<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl>
<dt id=biblio-css21 title=CSS21><a class=self-link href=#biblio-css21></a>[CSS21]<dd>Bert Bos; et al. <a href=http://www.w3.org/TR/2011/REC-CSS2-20110607>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</a>. 7 June 2011. W3C Recommendation. URL: <a href=http://www.w3.org/TR/2011/REC-CSS2-20110607>http://www.w3.org/TR/2011/REC-CSS2-20110607</a></dd>
<dt id=biblio-html5 title=HTML5><a class=self-link href=#biblio-html5></a>[HTML5]<dd>Robin Berjon; et al. <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>HTML5</a>. 6 August 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>http://www.w3.org/TR/2013/CR-html5-20130806/</a></dd>
<dt id=biblio-navigation-timing title=NAVIGATION-TIMING><a class=self-link href=#biblio-navigation-timing></a>[NAVIGATION-TIMING]<dd>Zhiheng Wang. <a href=http://www.w3.org/TR/2012/REC-navigation-timing-20121217/>Navigation Timing</a>. 17 December 2012. W3C Recommendation. URL: <a href=http://www.w3.org/TR/2012/REC-navigation-timing-20121217/>http://www.w3.org/TR/2012/REC-navigation-timing-20121217/</a></dd>
<dt id=biblio-rfc2119 title=RFC2119><a class=self-link href=#biblio-rfc2119></a>[RFC2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a></dd>
<dt id=biblio-select title=SELECT><a class=self-link href=#biblio-select></a>[SELECT]<dd>Tantek Çelik; et al. <a href=http://www.w3.org/TR/2011/REC-css3-selectors-20110929/>Selectors Level 3</a>. 29 September 2011. W3C Recommendation. URL: <a href=http://www.w3.org/TR/2011/REC-css3-selectors-20110929/>http://www.w3.org/TR/2011/REC-css3-selectors-20110929/</a></dd>
<dt id=biblio-svg2 title=SVG2><a class=self-link href=#biblio-svg2></a>[SVG2]<dd>Nikos Andronikos; et al. <a href=http://www.w3.org/TR/2013/WD-SVG2-20130618/>Scalable Vector Graphics (SVG) 2</a>. 18 June 2013. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/WD-SVG2-20130618/>http://www.w3.org/TR/2013/WD-SVG2-20130618/</a></dd>
</dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl>
<dt id=biblio-css3-transforms title=CSS3-TRANSFORMS><a class=self-link href=#biblio-css3-transforms></a>[CSS3-TRANSFORMS]<dd>Simon Fraser; et al. <a href=http://www.w3.org/TR/2012/WD-css3-transforms-20120911/>CSS Transforms</a>. 11 September 2012. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/WD-css3-transforms-20120911/>http://www.w3.org/TR/2012/WD-css3-transforms-20120911/</a></dd>
<dt id=biblio-css3-transitions title=CSS3-TRANSITIONS><a class=self-link href=#biblio-css3-transitions></a>[CSS3-TRANSITIONS]<dd>Dean Jackson; et al. <a href=http://www.w3.org/TR/2013/WD-css3-transitions-20130212/>CSS Transitions</a>. 12 February 2013. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/WD-css3-transitions-20130212/>http://www.w3.org/TR/2013/WD-css3-transitions-20130212/</a></dd>
<dt id=biblio-css4-images title=CSS4-IMAGES><a class=self-link href=#biblio-css4-images></a>[CSS4-IMAGES]<dd>Elika J. Etemad; Tab Atkins Jr.. <a href=http://www.w3.org/TR/2012/WD-css4-images-20120911/>CSS Image Values and Replaced Content Module Level 4</a>. 11 September 2012. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/WD-css4-images-20120911/>http://www.w3.org/TR/2012/WD-css4-images-20120911/</a></dd>
<dt id=biblio-hr-time title=HR-TIME><a class=self-link href=#biblio-hr-time></a>[HR-TIME]<dd>Jatinder Mann. <a href=http://www.w3.org/TR/2012/REC-hr-time-20121217/>High Resolution Time</a>. 17 December 2012. W3C Recommendation. URL: <a href=http://www.w3.org/TR/2012/REC-hr-time-20121217/>http://www.w3.org/TR/2012/REC-hr-time-20121217/</a></dd>
</dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>active
duration, <a href=#active-duration title="section 3.6.3">3.6.3</a>
<li>active interval, <a href=#active-interval title="section 3.6.3">3.6.3</a>
<li>active phase, <a href=#active-phase title="section 3.6.5">3.6.5</a>
<li>active time, <a href=#active-time title="section 3.10.3.1">3.10.3.1</a>
<li>after(), <a href=#dom-animationnode-after title="section 5.3">5.3</a>
<li>after phase, <a href=#after-phase title="section 3.6.5">3.6.5</a>
<li>ancestor, <a href=#ancestor title="section 3.13">3.13</a>
<li>animatable as color, <a href=#animatable-as-color0 title="section 4.1.3.5">4.1.3.5</a>
<li>animatable as length,
percentage, or calc, <a href=#animatable-as-length-percentage-or-calc0 title="section 4.1.3.4">4.1.3.4</a>
<li>animatable as real
number, <a href=#animatable-as-real-number0 title="section 4.1.3.3">4.1.3.3</a>
<li>animatable as string, <a href=#animatable-as-string0 title="section 4.1.3.2">4.1.3.2</a>
<li>animatable as transform
list, <a href=#animatable-as-transform-list0 title="section 4.1.3.6">4.1.3.6</a>
<li>animated
attribute value, <a href=#animated-attribute-value title="section 4.2.4.2">4.2.4.2</a>
<li>animation, <a href=#animation title="section 3.14">3.14</a>
<li>animation accumulation, <a href=#animation-accumulation0 title="section 4.1.2">4.1.2</a>
<li>animation addition, <a href=#animation-addition title="section 4.1.2">4.1.2</a>
<li>animation
behavior, <a href=#animation-behavior title="section 4.1.3">4.1.3</a>
<li>animation effect, <a href=#animation-effect title="section 4.1">4.1</a>
<li>animation group, <a href=#animation-group title="section 3.13">3.13</a>
<li>animation interpolation, <a href=#animation-interpolation title="section 4.1.2">4.1.2</a>
<li>animation node, <a href=#animation-node title="section 3.6">3.6</a>
<li>AnimationNode, <a href=#dom-animationnode title="section 5.3">5.3</a>
<li>animation node playback rate, <a href=#animation-node-playback-rate title="section 3.9">3.9</a>
<li>animation node start time, <a href=#animation-node-start-time title="section 3.6.3">3.6.3</a>
<li>AnimationPlayer, <a href=#dom-animationplayer title="section 5.2">5.2</a>
<li>animation sequence, <a href=#animation-sequence title="section 3.13.4">3.13.4</a>
<li>animation
stack, <a href=#animation-stack title="section 4.2.1">4.2.1</a>
<li>animation stylesheet, <a href=#animation-stylesheet title="section 4.2.4.1">4.2.4.1</a>
<li>animation
target, <a href=#animation-target title="section 3.14">3.14</a>
<li>AnimationTimeline, <a href=#dom-animationtimeline title="section 5.1">5.1</a>
<li>associated player of an animation effect, <a href=#associated-player-of-an-animation-effect title="section 4.2.1">4.2.1</a>
<li>associated with a player, <a href=#associated-with-a-player title="section 3.6.1">3.6.1</a>
<li>associated with
a timeline, <a href=#associated-with-a-timeline title="section 3.6.1">3.6.1</a>
<li>automatic rotation flag, <a href=#automatic-rotation-flag title="section 4.4">4.4</a>
<li>before(), <a href=#dom-animationnode-before title="section 5.3">5.3</a>
<li>before flag, <a href=#before-flag title="section 3.12.4">3.12.4</a>
<li>before phase, <a href=#before-phase title="section 3.6.5">3.6.5</a>
<li>cancel(), <a href=#dom-animationplayer-cancel title="section 5.2">5.2</a>
<li>child animation node, <a href=#child-animation-node title="section 3.13">3.13</a>
<li>composited value, <a href=#composited-value title="section 4.2.2">4.2.2</a>
<li>composite operation, <a href=#composite-operation title="section 4.2.3">4.2.3</a>
<li>composite operation accumulate, <a href=#composite-operation-accumulate title="section 4.2.3">4.2.3</a>
<li>composite operation add, <a href=#composite-operation-add title="section 4.2.3">4.2.3</a>
<li>composite operation replace, <a href=#composite-operation-replace title="section 4.2.3">4.2.3</a>
<li>computedTiming, <a href=#dom-animationnode-computedtiming title="section 5.3">5.3</a>
<li>&lt;cubic-bezier-timing-function&gt;, <a href=#typedef-cubic-bezier-timing-function title="section 3.12.3">3.12.3</a>
<li>cubic BXXXzier timing function, <a href=#cubic-bxxxzier-timing-function title="section 3.12.3">3.12.3</a>
<li>current, <a href=#current title="section 3.6.5">3.6.5</a>
<li>current iteration, <a href=#current-iteration title="section 3.10.4">3.10.4</a>
<li>current time, <a href=#current-time title="section 3.5.1">3.5.1</a>
<li>currentTime<ul><li>attribute for AnimationTimeline, <a href=#dom-animationtimeline-currenttime title="section 5.1">5.1</a>
<li>attribute for AnimationPlayer, <a href=#dom-animationplayer-currenttime title="section 5.2">5.2</a>
</ul><li>custom effect, <a href=#custom-effect title="section 4.5">4.5</a>
<li>custom player
priority, <a href=#custom-player-priority title="section 4.2.1.1">4.2.1.1</a>
<li>descendant, <a href=#descendant title="section 3.13">3.13</a>
<li>directed time, <a href=#directed-time title="section 3.11.1">3.11.1</a>
<li>directly associated with a player, <a href=#directly-associated-with-a-player title="section 3.6.1">3.6.1</a>
<li>distance
along a path, <a href=#distance-along-a-path0 title="section 4.4.1">4.4.1</a>
<li>distance computation, <a href=#distance-computation title="section 4.1.2">4.1.2</a>
<li>distk, <a href=#distk title="section 4.3.1.1">4.3.1.1</a>
<li>distribute keyframe spacing mode, <a href=#distribute-keyframe-spacing-mode title="section 4.3.1">4.3.1</a>
<li>document
timeline, <a href=#document-timeline title="section 3.4.1">3.4.1</a>
<li>drawing path command, <a href=#drawing-path-command title="section 4.4">4.4</a>
<li>effective current time, <a href=#effective-current-time title="section 3.5.1">3.5.1</a>
<li>effective point easing, <a href=#effective-point-easing title="section 4.4.2.1">4.4.2.1</a>
<li>effective point offsets, <a href=#effective-point-offsets title="section 4.4.2.1">4.4.2.1</a>
<li>effective spacing points, <a href=#effective-spacing-points title="section 4.4.2.1">4.4.2.1</a>
<li>effective timeline time, <a href=#effective-timeline-time title="section 3.5.1">3.5.1</a>
<li>end delay, <a href=#end-delay title="section 3.6.3">3.6.3</a>
<li>end time, <a href=#end-time title="section 3.13.3">3.13.3</a>
<li>evenly distributing
a keyframe, <a href=#evenly-distributing-a-keyframe title="section 4.3.1.1">4.3.1.1</a>
<li>event current time, <a href=#event-current-time title="section 3.5.4.2">3.5.4.2</a>
<li>Events are queued, <a href=#events-are-queued title="section 3.5.4.5">3.5.4.5</a>
<li>event timeline time, <a href=#event-timeline-time title="section 3.5.4.2">3.5.4.2</a>
<li>fill mode, <a href=#fill-mode title="section 3.7">3.7</a>
<li>finish(), <a href=#dom-animationplayer-finish title="section 5.2">5.2</a>
<li>finished, <a href=#dom-animationplayer-finished title="section 5.2">5.2</a>
<li>finished flag, <a href=#finished-flag title="section 3.5.4.1">3.5.4.1</a>
<li>finish player event, <a href=#finish-player-event title="section 3.5.4.1">3.5.4.1</a>
<li>first child, <a href=#first-child title="section 3.13">3.13</a>
<li>getAnimationPlayers(), <a href=#dom-animationtimeline-getanimationplayers title="section 5.1">5.1</a>
<li>global clock, <a href=#global-clock title="section 3.3">3.3</a>
<li>inclusive ancestor, <a href=#inclusive-ancestor title="section 3.13">3.13</a>
<li>inclusive descendant, <a href=#inclusive-descendant title="section 3.13">3.13</a>
<li>in effect, <a href=#in-effect title="section 3.6.5">3.6.5</a>
<li>inherited time, <a href=#inherited-time title="section 3.6.4">3.6.4</a>
<li>in play, <a href=#in-play title="section 3.6.5">3.6.5</a>
<li>intermediate animation value, <a href=#intermediate-animation-value title="section 4.1.4">4.1.4</a>
<li>intrinsic iteration duration, <a href=#intrinsic-iteration-duration title="section 3.8.1">3.8.1</a>
<li>iteration composite operation, <a href=#iteration-composite-operation title="section 4.2.5">4.2.5</a>
<li>iteration composite operation accumulate, <a href=#iteration-composite-operation-accumulate title="section 4.2.5">4.2.5</a>
<li>iteration composite operation replace, <a href=#iteration-composite-operation-replace title="section 4.2.5">4.2.5</a>
<li>iteration count, <a href=#iteration-count title="section 3.8.2">3.8.2</a>
<li>iteration
duration, <a href=#iteration-duration title="section 3.8.1">3.8.1</a>
<li>iteration interval, <a href=#iteration-interval title="section 3.8.1">3.8.1</a>
<li>iteration start, <a href=#iteration-start title="section 3.8.2">3.8.2</a>
<li>iteration time, <a href=#iteration-time title="section 3.10.3.3">3.10.3.3</a>
<li>keyframe, <a href=#keyframe title="section 4.3">4.3</a>
<li>keyframe animation effect, <a href=#keyframe-animation-effect title="section 4.3">4.3</a>
<li>keyframe offset, <a href=#keyframe-offset title="section 4.3">4.3</a>
<li>keyframe spacing mode, <a href=#keyframe-spacing-mode title="section 4.3.1">4.3.1</a>
<li>lacuna value, <a href=#lacuna-value title="section 4.2.4.2">4.2.4.2</a>
<li>last child, <a href=#last-child title="section 3.13">3.13</a>
<li>limited, <a href=#limited title="section 3.5.2.10">3.5.2.10</a>
<li>linear timing
function, <a href=#linear-timing-function title="section 3.12.2">3.12.2</a>
<li>local time, <a href=#local-time title="section 3.6.4">3.6.4</a>
<li>loosely sorted by offset, <a href=#loosely-sorted-by-offset title="section 4.3">4.3</a>
<li>motion path, <a href=#motion-path title="section 4.4">4.4</a>
<li>motion path animation effect, <a href=#motion-path-animation-effect title="section 4.4">4.4</a>
<li>motion path spacing mode, <a href=#motion-path-spacing-mode title="section 4.4.2">4.4.2</a>
<li>neutral value for composition, <a href=#neutral-value-for-composition title="section 4.3.2">4.3.2</a>
<li>next sibling, <a href=#next-sibling title="section 3.13">3.13</a>
<li>nextSibling, <a href=#dom-animationnode-nextsibling title="section 5.3">5.3</a>
<li>nodes<ul><li>argument for AnimationNode/before(), <a href=#dom-animationnodebefore-nodes title="section 5.3">5.3</a>
<li>argument for AnimationNode/after(), <a href=#dom-animationnodeafter-nodes title="section 5.3">5.3</a>
<li>argument for AnimationNode/replace(), <a href=#dom-animationnodereplace-nodes title="section 5.3">5.3</a>
</ul><li>not additive, <a href=#not-additive title="section 4.1.3">4.1.3</a>
<li>not
animatable, <a href=#not-animatable0 title="section 4.1.3.1">4.1.3.1</a>
<li>not
paceable, <a href=#not-paceable title="section 4.1.3">4.1.3</a>
<li>not started, <a href=#not-started title="section 3.4">3.4</a>
<li>offsetk, <a href=#offsetk title="section 4.3.1.1">4.3.1.1</a>
<li>onfinish, <a href=#dom-animationplayer-onfinish title="section 5.2">5.2</a>
<li>orientation path command, <a href=#orientation-path-command title="section 4.4">4.4</a>
<li>paceable, <a href=#paceable title="section 4.3.1.1">4.3.1.1</a>
<li>paced keyframe spacing mode, <a href=#paced-keyframe-spacing-mode title="section 4.3.1">4.3.1</a>
<li>paced property, <a href=#paced-property title="section 4.3.1">4.3.1</a>
<li>parent, <a href=#dom-animationnode-parent title="section 5.3">5.3</a>
<li>parent
animation group, <a href=#parent-animation-group title="section 3.13">3.13</a>
<li>path command, <a href=#path-command title="section 4.4">4.4</a>
<li>path fraction, <a href=#path-fraction title="section 4.4.3">4.4.3</a>
<li>pause(), <a href=#dom-animationplayer-pause title="section 5.2">5.2</a>
<li>paused, <a href=#dom-animationplayer-paused title="section 5.2">5.2</a>
<li>play()<ul><li>method for AnimationTimeline, <a href=#dom-animationtimeline-play title="section 5.1">5.1</a>
<li>method for AnimationPlayer, <a href=#dom-animationplayer-play title="section 5.2">5.2</a>
</ul><li>playback
direction, <a href=#playback-direction title="section 3.11">3.11</a>
<li>playbackRate, <a href=#dom-animationplayer-playbackrate title="section 5.2">5.2</a>
<li>player<ul><li>definition of, <a href=#player title="section 3.5">3.5</a>
<li>attribute for AnimationNode, <a href=#dom-animationnode-player title="section 5.3">5.3</a>
</ul><li>player event, <a href=#player-event title="section 3.5.4">3.5.4</a>
<li>player playback
rate, <a href=#player-playback-rate title="section 3.5.3">3.5.3</a>
<li>player sequence number, <a href=#player-sequence-number title="section 3.5">3.5</a>
<li>player start time, <a href=#player-start-time title="section 3.5">3.5</a>
<li>point easing, <a href=#point-easing title="section 4.4.2">4.4.2</a>
<li>pointk, <a href=#giant-error title="section 4.4.2.1">4.4.2.1</a>
<li>point offset, <a href=#point-offset title="section 4.4.2">4.4.2</a>
<li>previousSibling, <a href=#dom-animationnode-previoussibling title="section 5.3">5.3</a>
<li>previous sibling, <a href=#previous-sibling title="section 3.13">3.13</a>
<li>remove(), <a href=#dom-animationnode-remove title="section 5.3">5.3</a>
<li>repeated duration, <a href=#repeated-duration title="section 3.10.2">3.10.2</a>
<li>replace(), <a href=#dom-animationnode-replace title="section 5.3">5.3</a>
<li>reverse(), <a href=#dom-animationplayer-reverse title="section 5.2">5.2</a>
<li>root, <a href=#root title="section 3.13">3.13</a>
<li>rotation angle, <a href=#rotation-angle title="section 4.4">4.4</a>
<li>sample, <a href=#sample title="section 3.2">3.2</a>
<li>sampling, <a href=#sampling title="section 3.2">3.2</a>
<li>scaled active time, <a href=#scaled-active-time title="section 3.10.3.2">3.10.3.2</a>
<li>Seeking, <a href=#seeking title="section 3.5.2.9">3.5.2.9</a>
<li>source<ul><li>argument for AnimationTimeline/play(), <a href=#dom-animationtimelineplay-source title="section 5.1">5.1</a>
<li>attribute for AnimationPlayer, <a href=#dom-animationplayer-source title="section 5.2">5.2</a>
</ul><li>source content, <a href=#source-content title="section 3.5">3.5</a>
<li>source content end, <a href=#source-content-end title="section 3.5.2.7">3.5.2.7</a>
<li>spacing point, <a href=#spacing-point title="section 4.4.2">4.4.2</a>
<li>start delay, <a href=#start-delay title="section 3.6.3">3.6.3</a>
<li>start offset, <a href=#start-offset title="section 3.10.3.2">3.10.3.2</a>
<li>startTime, <a href=#dom-animationplayer-starttime title="section 5.2">5.2</a>
<li>&lt;step-timing-function&gt;, <a href=#typedef-step-timing-function title="section 3.12.4">3.12.4</a>
<li>step timing function, <a href=#step-timing-function title="section 3.12.4">3.12.4</a>
<li>target property, <a href=#target-property title="section 4.1.1">4.1.1</a>
<li>time fraction, <a href=#time-fraction title="section 3.14.1">3.14.1</a>
<li>timeline<ul><li>definition of, <a href=#timeline title="section 3.4">3.4</a>
<li>attribute for AnimationPlayer, <a href=#dom-animationplayer-timeline title="section 5.2">5.2</a>
</ul><li>time value, <a href=#time-value title="section 3.2">3.2</a>
<li>timing, <a href=#dom-animationnode-timing title="section 5.3">5.3</a>
<li>timing function, <a href=#timing-function title="section 3.12.2">3.12.2</a>
<li>transformed time, <a href=#transformed-time title="section 3.12.5">3.12.5</a>
<li>tree order, <a href=#tree-order title="section 3.13">3.13</a>
<li>underlying value, <a href=#underlying-value title="section 4.2.2">4.2.2</a>
<li>unlimited current time, <a href=#unlimited-current-time title="section 3.5.2.7">3.5.2.7</a>
<li>zero time, <a href=#zero-time title="section 3.4">3.4</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


</div><h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><div class=issue>Should this be renamed to something like “inactive” so we
    can accommodate possible future timelines that may, after starting,
    become unable to return a meaningful <a data-link-type=dfn href=#time-value title="time value">time value</a>?<a href=#issue-855f2d0f> ↵ </a></div>

<div class=issue>
Currently <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> that generate results outside the
range [0, 1] will behave unexpectedly when applied to animation
groups, as children will increase iterations or enter into fill mode
rather than continuing to extrapolate along their defined behavior
(which is what they would do if the timing function applied to them
directly).

<p>To fix this it is possible we will wish to introduce <a class=property data-link-type=propdesc href=http://dev.w3.org/csswg/css-overflow-3/#overflow0 title=overflow>overflow</a> fill
modes that respond to time values larger than or smaller than the
active time range by extrapolating rather than filling.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html>section
15 (Overflowing fill) of minuted discussion from Tokyo 2013 F2F</a>.
</p><a href=#issue-e084f67b> ↵ </a></div><div class=issue>There used to be a step here which seemed to be adding
  special handling for filling when the node ends on
  a repeat boundary but it seems like that is taken care
  of by the calcuation of <a data-link-type=dfn href=#iteration-time title="iteration time">iteration time</a> and
  <a data-link-type=dfn href=#current-iteration title="current iteration">current iteration</a>.
  Is anything actually needed here?<a href=#issue-eb1151df> ↵ </a></div>

<div class=issue>
Currently, the set of <a data-link-type=dfn href=#timing-function title="timing functions">timing functions</a> allowed on
an <a data-link-type=dfn href=#animation-group title="animation group">animation group</a> is not restricted.
This has raised concern about complexity of implementation and also
complexity of behavior with regards to fill modes.
As a result, allowing the full set of timing functions on animation
groups is considered <strong>at risk</strong>.

<p>Alternatives are to either restrict timing functions on animation
groups to the <a data-link-type=dfn href=#linear-timing-function title="linear timing function">linear timing function</a> or to a set of
“simple” timing functions that have properties that
alleviate some of the concerns with the more complex timing
functions.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013JulSep/0076.html>section
2 of the discussion from August 2013</a>.
</p><a href=#issue-058d14db> ↵ </a></div><div class=issue>
It has been proposed to extend <code>cubic-bezier</code> to allow
multiple segments, using syntax such as the following:

<pre><code>cubic-bezier( [ &lt;number&gt;{6} ; ]* &lt;number&gt;{4} )</code>
</pre>

<p>(i.e. the curve starts at (0, 0); each segment is defined by six
numbers where the start point is the end of the previous segment and
the numbers define the two control points and the end point. The
last segment is defined by four numbers since the end point is fixed
at (1, 1).)</p>

<p>This would provide a simple and compact syntax for tools trying to
map arbitrary curves (e.g. bounce functions) to timing functions.
</p><a href=#issue-63ea6fd5> ↵ </a></div><div class=issue>The default <a data-link-type=dfn href=#animation-behavior title="animation behavior">animation behavior</a> for CSS properties is "as
       string".  Should this be defined here or in CSS Animations Level 4?<a href=#issue-48287af4> ↵ </a></div>

<div class=issue>Should we call this “animatable as premultiplied RGBA additive
color in sRGB color space” instead?<a href=#issue-63f8b8b1> ↵ </a></div>

<div class=issue>
  We should probably expand 2d functions to their 3d
  equivalents before matching?
<a href=#issue-3540bd4c> ↵ </a></div><div class=issue>
  This needs to be more specific, e.g. when combining
  <code>translate(20px)</code> and <code>translate(30px
  10px)</code> we have to expand the first function to
  <code>translate(20px 0px)</code> first.
  Probably need to define unit conversion too.
<a href=#issue-7c98bbea> ↵ </a></div><div class=issue>

<p>For <a data-link-type=dfn href=#distance-computation title="distance computation">distance computation</a> we previously defined it as follows:</p>

<ol><li data-md=""><p>Look only at the first component of the two lists</p>
<li data-md=""><p>If both are translate → euclidean distance</p>
<li data-md=""><p>If both are scale → absolute difference</p>
<li data-md=""><p>If both are rotate → absolute difference</p>
<li data-md=""><p>If both match but are something else → use linear</p>
<li data-md=""><p>If they don’t match → use matrix decomposition and
euclidean distance between translate components</p>
</ol>
<p>This seems really arbitrary, especially part 5.</p>

<p>Also, looking at only the first component seems odd.
    Going through each component, working out the distance and then
    getting the square of the distance also seems much more consistent
    with what we do elsewhere.</p>

<a href=#issue-b82dbcbe> ↵ </a></div>

<div class=issue>

<p>There are a bunch of CSS properties for which distance (and in
    some cases addition) is not defined or which need special
    handling.</p>

<p>For example,</p>

<ul><li data-md=""><p>font-stretch (an enum but handled like an integer)</p>
<li data-md=""><p>visibility (0 or 1 depending on if endpoints match or not)</p>
<li data-md=""><p>flex-grow and flex-shrink which allow animation only if one of
the endpoints is 0)</p>
<li data-md=""><p>value pairs, triples (use square distance)</p>
<li data-md=""><p>rects (use square distance)</p>
<li data-md=""><p>dash arrays (square distance but a bit weird due to
percentages)</p>
<li data-md=""><p>shadows (square distance of components)</p>
<li data-md=""><p>filters (undefined)</p>
<li data-md=""><p>background-position (special list handling needed)</p>
<li data-md=""><p>pair lists</p>
</ul>
<p>Should we define these here or in the CSS Animation 4 spec?</p>

<a href=#issue-2b25d150> ↵ </a></div>

<div class=issue>The above algorithm is quite complex.
    It attempts to cover all possible combinations of input where
    keyframe offsets and or paced property values may be missing.
    Furthermore, it attempts to do this in a way that degenerates
    consistently and also allows the author to combine fixed offsets
    with either pacing or distribute spacing.
    We await implementation experience to determine if the complexity
    is justified.<a href=#issue-867fbc9b> ↵ </a></div>

<div class=issue>It seems like this could be done as a separate step at the end
    and applied to all types of animation effects consistently.<a href=#issue-8b7cca9f> ↵ </a></div>
<div class=issue>
    In the presence of certain timing functions, the input time
    fraction to an animation effect is not limited to the range [0, 1].
    Currently, however, keyframe offsets <em>are</em> limited to the
    range [0, 1] and property values are simply extrapolated for input
    time fractions outside this range.

<p>We have considered removing this restriction since some cases exist
    where it is useful to be able to specify non-linear
    changes in property values at time fractions outside the range
    [0, 1].
    One example is an animation that interpolates from green to yellow
    but has an overshoot timing function that makes it temporarily
    interpolate ‘beyond’ yellow to red before settling back
    to yellow.</p>

<p>While this effect could be achieved by modification of the keyframes
    and timing function, this approach seems to break the model’s
    separation of timing concerns from animation effects.</p>

<p>It is not clear how this effect should be achieved but we note that
    allowing keyframe offsets outside [0, 1] may make the currently
    specified behavior where keyframes at offset 0 and 1 are synthesized
    as necessary, inconsistent.</p>

<p>See <a href=http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html>section
    4 (Keyframe offsets outside [0, 1]) of minuted discussion from Tokyo
      2013 F2F</a>.</p>
<a href=#issue-73bc0c24> ↵ </a></div>

<div class=issue>Need a diagram here showing how the different combinations work.<a href=#issue-04948125> ↵ </a></div>

<div class=issue>

<p>The original text for this section contained the following
    qualifications but I’m not sure how meaningful they are:</p>

<ul><li data-md=""><p>For continuous <a data-link-type=dfn href=#path-command title="path commands">path commands</a> (all elements except
moveto), the angle of the tangent vector for the purpose of
these calculations is defined to be an integer multiple of
2π different from the value given by <a href=http://en.wikipedia.org/wiki/Tangential_angle>standard
mathematical formulae for tangents to curves in
2 dimensional space</a>.</p>
<li data-md=""><p>For moveto <a data-link-type=dfn href=#path-command title="path commands">path commands</a>, which are discontinuous, the
angle of the tangent vector for the purpose of these
calculations is always an integer multiple of 2π.</p>
<li data-md=""><p>The initial value of the angle of the tangent vector is
computed using the first element of the curve, and is always
in the range [0, 2π).</p>
<li data-md=""><p>Single continuous path commands must never produce tangent
vector angles that are discontinuous over their defined
region. This implies that a single unique solution is
available for all points on continuous path commands.</p>
<li data-md=""><p>When computing angles after discontinuous or non-smooth
jumps, multiple possible solutions may be available.  These
solutions will differ by integer multiples of 2π.  In
such cases the solution that lies closest to the previous
tangent angle is used.</p>
</ul>
<a href=#issue-05370760> ↵ </a></div>

<div class=issue>What’s the value in keeping these separate?
    Shouldn’t we collapse them?<a href=#issue-f599319a> ↵ </a></div>

<div class=issue>Need to describe how <a href=http://www.w3.org/TR/css3-transforms/#transform-origin-property>transform-origin</a>
    is applied.<a href=#issue-8bfeb5cb> ↵ </a></div>

<div class=issue>
There may be use cases where an action needs to be triggered at
a specific point in an animation tree.
In many cases this can be achieved by inserting a custom effect with
a step-start easing that spans the period during which the action
should be triggered.
However, this can impose additional layout requirements on the
content which might be cumbersome to accomodate.

<p>Some alternatives under consideration:</p>

<ul><li data-md=""><p>Additional calling conditions could be defined to accommodate
zero-width custom effects. For example, it could be required
that the callback be called if (given infinite precision) there
was a time between the previous and current sample times that
aligned with the custom effect.</p>
<li data-md=""><p>Instead of adding special calling conditions to custom effects,
a new type of animation node, Trigger, could be introduced. The
trigger would only ever act as a zero-width custom effect as
described above, its constructor would take a callback function,
but not require a target or timing. It could also specify other
calling conventions, for example whether it should only trigger
in a specific playback direction.</p>
</ul>
<a href=#issue-466de4cb> ↵ </a></div>

<div class=issue>Need to define this more precisely.
    Are styles flushed?
    Presumably they are.
    Can we suspend reflow for the duration of executing the script-based
    animation effects and just do it once afterwards?<a href=#issue-8b46f38c> ↵ </a></div>

<div class=issue>We need to make sure, for example, that any custom effects get
	called with a null sample time so they can remove their effects.
    This applies to manually setting <code>source</code> to null as
    well so we should define this behavior there.<a href=#issue-020f7327> ↵ </a></div>

<div class=issue>Is this unpausing behavior correct?<a href=#issue-1c8c4848> ↵ </a></div>

<div class=issue>Should this be <code>parentGroup</code>?<a href=#issue-894adfa6> ↵ </a></div>

<div class=issue>Feedback has been provided that suggests this reference causes the
    relationship between AnimationPlayers and AnimationNodes to be
    circular, which confuses the model. The player attribute should be
    considered <strong>at risk</strong> unless a strong use case for the
    reference arises.<a href=#issue-dae71733> ↵ </a></div>
</div>